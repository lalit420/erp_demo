<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Planning & Billing Module - Construction ERP</title>
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <div class="app-container">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <div class="logo">üèóÔ∏è</div>
        <div class="company-name">BuildPro ERP</div>
      </div>
      <nav>
        <ul class="nav-menu">
          <li class="nav-item">
            <a href="admin.html" class="nav-link">
              <span class="nav-icon">‚öôÔ∏è</span>
              <span>Admin</span>
            </a>
          </li>
          <li class="nav-item">
            <a href="store.html" class="nav-link">
              <span class="nav-icon">üì¶</span>
              <span>Store</span>
            </a>
          </li>
          <li class="nav-item">
            <a href="scm.html" class="nav-link">
              <span class="nav-icon">üîó</span>
              <span>SCM</span>
            </a>
          </li>
          <li class="nav-item">
            <a href="planning-billing.html" class="nav-link active">
              <span class="nav-icon">üìã</span>
              <span>Planning & Billing</span>
            </a>
            <ul class="nav-submenu">
                            <!--
                            -->
              <li>
                <button class="nav-sublink" type="button" onclick="switchPlanningTab(event, 'clients')">Clients</button>
              </li>
              <li>
                <button class="nav-sublink active" type="button" onclick="switchPlanningTab(event, 'projects')">Projects</button>
              </li>
              <li>
                <button class="nav-sublink" type="button" onclick="switchPlanningTab(event, 'siteManagement')">Site Management</button>
              </li>
              <li>
                <button class="nav-sublink" type="button" onclick="switchPlanningTab(event, 'labour')">Labour</button>
              </li>
              <li>
                <button class="nav-sublink" type="button" onclick="switchPlanningTab(event, 'equipment')">Equipment</button>
              </li>
              <li>
                <button class="nav-sublink" type="button" onclick="switchPlanningTab(event, 'qualityControl')">Quality Control</button>
              </li>
              <li>
                <button class="nav-sublink" type="button" onclick="switchPlanningTab(event, 'costEstimation')">Cost Estimation & BOQ</button>
              </li>
              <li>
                <button class="nav-sublink" type="button" onclick="switchPlanningTab(event, 'contractManagement')">Contract Management</button>
              </li>
              <li>
                <button class="nav-sublink" type="button" onclick="switchPlanningTab(event, 'subcontractorBilling')">Subcontractor Billing</button>
              </li>
              <li>
                <button class="nav-sublink" type="button" onclick="switchPlanningTab(event, 'cashFlow')">Cash Flow Planning</button>
              </li>
              <!-- Hidden: WBS & Work Packages, Scheduling / Gantt, Progress Billing / RA Bills, Change Orders, Time & Attendance, Project Forecasting, Retention & Mobilization, Certification & Approvals -->
            </ul>
          </li>
          <li class="nav-item">
            <a href="accounts-banking.html" class="nav-link">
              <span class="nav-icon">üí∞</span>
              <span>Accounts & Banking</span>
            </a>
          </li>
        </ul>
      </nav>
      <div style="padding: 20px; margin-top: auto; border-top: 1px solid var(--border-color);">
        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
          <div class="avatar" style="width: 40px; height: 40px;">JS</div>
          <div>
            <div style="font-weight: 600; font-size: 14px;">Jane Smith</div>
            <div style="font-size: 12px; color: var(--text-secondary);">Project Manager</div>
          </div>
        </div>
        <button class="btn btn-secondary" style="width: 100%; font-size: 13px;" onclick="window.location.href='login.html'">
          Logout
        </button>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Header -->
      <header class="header">
        <div class="header-left">
          <h1>Planning & Billing Management</h1>
          <div class="breadcrumb">
            <span>Home</span> / <span>Planning & Billing</span>
          </div>
        </div>
        <div class="header-right">
          <div class="search-box">
            <span class="search-icon">üîç</span>
            <input type="text" placeholder="Search projects, clients...">
          </div>
          <button class="notification-btn">
            <span>üîî</span>
            <span class="notification-badge">15</span>
          </button>
          <button class="profile-btn">
            <div class="user-avatar">JS</div>
          </button>
        </div>
      </header>

      <!-- Content Area -->
      <div class="content-area">
        <!-- Stats -->
        <div class="grid grid-4">
          <div class="stat-card">
            <div class="stat-header">
              <div>
                <div class="stat-label">Active Projects</div>
                <div class="stat-value">18</div>
                <div class="stat-change positive">3 new this month</div>
              </div>
              <div class="stat-icon blue">üìÅ</div>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-header">
              <div>
                <div class="stat-label">Total Clients</div>
                <div class="stat-value">45</div>
                <div class="stat-change positive">‚Üë 8% growth</div>
              </div>
              <div class="stat-icon green">üë•</div>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-header">
              <div>
                <div class="stat-label">Labour Force</div>
                <div class="stat-value">342</div>
                <div class="stat-change positive">Across all sites</div>
              </div>
              <div class="stat-icon orange">üë∑</div>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-header">
              <div>
                <div class="stat-label">Equipment Active</div>
                <div class="stat-value">112</div>
                <div class="stat-change positive">76% utilization</div>
              </div>
              <div class="stat-icon red">üöú</div>
            </div>
          </div>
        </div>

        <!-- Charts -->
        <div class="grid grid-2 mt-3">
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">Project Progress Overview</h3>
              <select class="form-select" style="width: auto;">
                <option>All Projects</option>
                <option>This Quarter</option>
                <option>This Year</option>
              </select>
            </div>
            <div style="position: relative; height: 350px; padding: 20px;">
              <canvas id="projectProgressChart" style="max-height: 310px;"></canvas>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h3 class="card-title">Resource Utilization</h3>
            </div>
            <div style="position: relative; height: 350px; padding: 20px; display: flex; justify-content: center; align-items: center;">
              <canvas id="resourceUtilizationChart" style="max-height: 310px; max-width: 310px;"></canvas>
            </div>
          </div>
        </div>

        <!-- Planning & Billing Sections -->
        <div class="card mt-3">
          <!-- Projects Tab -->
          <div id="projects" class="tab-content active">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-top: 20px;">
              <div style="display: flex; gap: 12px;">
                <select class="form-select" style="width: auto;">
                  <option>All Status</option>
                  <option>Planning</option>
                  <option>In Progress</option>
                  <option>On Hold</option>
                  <option>Completed</option>
                </select>
                <select class="form-select" style="width: auto;">
                  <option>All Types</option>
                  <option>Residential</option>
                  <option>Commercial</option>
                  <option>Infrastructure</option>
                </select>
              </div>
              <button class="btn btn-primary" onclick="openNewProjectModal()">+ New Project</button>
            </div>

            <div class="table-container">
              <table>
                <thead>
                  <tr>
                    <th>Project ID</th>
                    <th>Project Name</th>
                    <th>Client</th>
                    <th>Location</th>
                    <th>Start Date</th>
                    <th>End Date</th>
                    <th>Budget</th>
                    <th>Progress</th>
                    <th>Status</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td><strong>PRJ-001</strong></td>
                    <td><strong>Apollo Towers</strong></td>
                    <td>Tech Corp Ltd</td>
                    <td>Sector 62, Noida</td>
                    <td>Jan 15, 2024</td>
                    <td>Mar 30, 2026</td>
                    <td><strong>‚Çπ12.5 Cr</strong></td>
                    <td>
                      <div style="display: flex; align-items: center; gap: 8px;">
                        <div class="progress-bar" style="width: 80px;">
                          <div class="progress-fill success" style="width: 75%;"></div>
                        </div>
                        <span style="font-weight: 600;">75%</span>
                      </div>
                    </td>
                    <td><span class="badge badge-success">In Progress</span></td>
                    <td>
                      <button class="btn btn-secondary btn-icon" style="padding: 6px;" onclick="viewProjectRow(this)">üëÅÔ∏è</button>
                      <button class="btn btn-secondary btn-icon" style="padding: 6px;" onclick="editProjectRow(this)">üìù</button>
                    </td>
                  </tr>
                  <tr>
                    <td><strong>PRJ-002</strong></td>
                    <td><strong>Metro Plaza</strong></td>
                    <td>Metro Developers</td>
                    <td>Golf Course Rd, Gurgaon</td>
                    <td>Mar 01, 2024</td>
                    <td>Aug 31, 2026</td>
                    <td><strong>‚Çπ18.2 Cr</strong></td>
                    <td>
                      <div style="display: flex; align-items: center; gap: 8px;">
                        <div class="progress-bar" style="width: 80px;">
                          <div class="progress-fill warning" style="width: 45%;"></div>
                        </div>
                        <span style="font-weight: 600;">45%</span>
                      </div>
                    </td>
                    <td><span class="badge badge-success">In Progress</span></td>
                    <td>
                      <button class="btn btn-secondary btn-icon" style="padding: 6px;" onclick="viewProjectRow(this)">üëÅÔ∏è</button>
                      <button class="btn btn-secondary btn-icon" style="padding: 6px;" onclick="editProjectRow(this)">üìù</button>
                    </td>
                  </tr>
                  <tr>
                    <td><strong>PRJ-003</strong></td>
                    <td><strong>Green Valley Resort</strong></td>
                    <td>Valley Resorts Pvt Ltd</td>
                    <td>Manesar, Haryana</td>
                    <td>Jun 01, 2024</td>
                    <td>Dec 31, 2026</td>
                    <td><strong>‚Çπ25.5 Cr</strong></td>
                    <td>
                      <div style="display: flex; align-items: center; gap: 8px;">
                        <div class="progress-bar" style="width: 80px;">
                          <div class="progress-fill" style="width: 15%;"></div>
                        </div>
                        <span style="font-weight: 600;">15%</span>
                      </div>
                    </td>
                    <td><span class="badge badge-warning">Planning</span></td>
                    <td>
                      <button class="btn btn-secondary btn-icon" style="padding: 6px;" onclick="viewProjectRow(this)">üëÅÔ∏è</button>
                      <button class="btn btn-secondary btn-icon" style="padding: 6px;" onclick="editProjectRow(this)">üìù</button>
                    </td>
                  </tr>
                  <tr>
                    <td><strong>PRJ-004</strong></td>
                    <td><strong>Smart City Complex</strong></td>
                    <td>Smart City Corp</td>
                    <td>Greater Noida West</td>
                    <td>Feb 15, 2024</td>
                    <td>Sep 30, 2026</td>
                    <td><strong>‚Çπ35.8 Cr</strong></td>
                    <td>
                      <div style="display: flex; align-items: center; gap: 8px;">
                        <div class="progress-bar" style="width: 80px;">
                          <div class="progress-fill warning" style="width: 58%;"></div>
                        </div>
                        <span style="font-weight: 600;">58%</span>
                      </div>
                    </td>
                    <td><span class="badge badge-success">In Progress</span></td>
                    <td>
                      <button class="btn btn-secondary btn-icon" style="padding: 6px;" onclick="viewProjectRow(this)">üëÅÔ∏è</button>
                      <button class="btn btn-secondary btn-icon" style="padding: 6px;" onclick="editProjectRow(this)">üìù</button>
                    </td>
                  </tr>
                  <tr>
                    <td><strong>PRJ-005</strong></td>
                    <td><strong>Sky Heights Apartments</strong></td>
                    <td>Urban Homes Ltd</td>
                    <td>Sector 137, Noida</td>
                    <td>Aug 01, 2023</td>
                    <td>Jan 31, 2026</td>
                    <td><strong>‚Çπ22.3 Cr</strong></td>
                    <td>
                      <div style="display: flex; align-items: center; gap: 8px;">
                        <div class="progress-bar" style="width: 80px;">
                          <div class="progress-fill success" style="width: 92%;"></div>
                        </div>
                        <span style="font-weight: 600;">92%</span>
                      </div>
                    </td>
                    <td><span class="badge badge-success">In Progress</span></td>
                    <td>
                      <button class="btn btn-secondary btn-icon" style="padding: 6px;" onclick="viewProjectRow(this)">üëÅÔ∏è</button>
                      <button class="btn btn-secondary btn-icon" style="padding: 6px;" onclick="editProjectRow(this)">üìù</button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Clients Tab -->
          <div id="clients" class="tab-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-top: 20px;">
              <div style="display: flex; gap: 12px;">
                <select class="form-select" style="width: auto;">
                  <option>All Types</option>
                  <option>Corporate</option>
                  <option>Individual</option>
                  <option>Government</option>
                </select>
                <select class="form-select" style="width: auto;">
                  <option>All Status</option>
                  <option>Active</option>
                  <option>Inactive</option>
                </select>
              </div>
              <button class="btn btn-primary" onclick="openAddClientModal()">+ Add Client</button>
            </div>

            <div class="table-container">
              <table>
                <thead>
                  <tr>
                    <th>Client ID</th>
                    <th>Client Name</th>
                    <th>Type</th>
                    <th>Contact Person</th>
                    <th>Phone</th>
                    <th>Email</th>
                    <th>Active Projects</th>
                    <th>Total Value</th>
                    <th>Status</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td><strong>CLI-001</strong></td>
                    <td>
                      <div style="display: flex; align-items: center; gap: 8px;">
                        <div class="avatar" style="background: #3b82f6; width: 32px; height: 32px; font-size: 12px;">TC</div>
                        <strong>Tech Corp Ltd</strong>
                      </div>
                    </td>
                    <td><span class="badge badge-info">Corporate</span></td>
                    <td>Amit Sharma</td>
                    <td>+91 9876543210</td>
                    <td>amit@techcorp.com</td>
              
                      <button class="btn btn-secondary btn-icon" style="padding: 6px;" onclick="viewClientRow(this)">üëÅÔ∏è</button>
                      <button class="btn btn-secondary btn-icon" style="padding: 6px;" onclick="editClientRow(this)">üìù</button>
                    </td>
                  </tr>
                  <tr>
                    <td><strong>CLI-003</strong></td>
                    <td>
                      <div style="display: flex; align-items: center; gap: 8px;">
                        <div class="avatar" style="background: #f59e0b; width: 32px; height: 32px; font-size: 12px;">VR</div>
                        <strong>Valley Resorts Pvt Ltd</strong>
                      </div>
                    </td>
                    <td><span class="badge badge-info">Corporate</span></td>
                    <td>Vikram Singh</td>
                    <td>+91 9876543212</td>
                    <td>vikram@valleyresorts.com</td>
              
                      <button class="btn btn-secondary btn-icon" style="padding: 6px;" onclick="viewClientRow(this)">üëÅÔ∏è</button>
                      <button class="btn btn-secondary btn-icon" style="padding: 6px;" onclick="editClientRow(this)">üìù</button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Site Management Tab -->
          <div id="siteManagement" class="tab-content">
            <div style="padding-top: 20px;">
              <h3 style="margin-bottom: 20px;">Active Construction Sites</h3>

              <div class="grid grid-2" style="gap: 20px;">
                <!-- Site Card 1 -->
                <div class="card" style="margin: 0;">
                  <div style="display: flex; justify-content: space-between; margin-bottom: 16px;">
                    <div>
                      <h3 style="font-size: 18px; margin-bottom: 4px;">Apollo Towers - Site A</h3>
                      <div style="font-size: 13px; color: var(--text-secondary);">Sector 62, Noida</div>
                    </div>
                    <span class="badge badge-success">Active</span>
                  </div>

                  <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px;">
                    <div>
                      <div style="font-size: 12px; color: var(--text-secondary);">Site Manager</div>
                      <div style="font-weight: 500;">Rajesh Singh</div>
                    </div>
                    <div>
                      <div style="font-size: 12px; color: var(--text-secondary);">Workers Today</div>
                      <div style="font-weight: 500;">142 / 160</div>
                    </div>
                    <div>
                      <div style="font-size: 12px; color: var(--text-secondary);">Progress</div>
                      <div style="font-weight: 500; color: var(--success-color);">75%</div>
                    </div>
                    <div>
                      <div style="font-size: 12px; color: var(--text-secondary);">Last Updated</div>
                      <div style="font-weight: 500;">2 hours ago</div>
                    </div>
                  </div>

                  <div style="margin-bottom: 16px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                      <span style="font-size: 13px;">Overall Progress</span>
                      <span style="font-size: 13px; font-weight: 600;">75%</span>
                    </div>
                    <div class="progress-bar">
                      <div class="progress-fill success" style="width: 75%;"></div>
                    </div>
                  </div>

                  <div style="display: flex; gap: 8px;">
                    <button class="btn btn-primary" style="flex: 1;" onclick="viewSiteDetails(this)">View Details</button>
                    <button class="btn btn-secondary" onclick="openSiteDailyReport(this)">Daily Report</button>
                  </div>
                </div>

                <!-- Site Card 2 -->
                <div class="card" style="margin: 0;">
                  <div style="display: flex; justify-content: space-between; margin-bottom: 16px;">
                    <div>
                      <h3 style="font-size: 18px; margin-bottom: 4px;">Metro Plaza - Site B</h3>
                      <div style="font-size: 13px; color: var(--text-secondary);">Golf Course Road, Gurgaon</div>
                    </div>
                    <span class="badge badge-success">Active</span>
                  </div>

                  <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px;">
                    <div>
                      <div style="font-size: 12px; color: var(--text-secondary);">Site Manager</div>
                      <div style="font-weight: 500;">Amit Kumar</div>
                    </div>
                    <div>
                      <div style="font-size: 12px; color: var(--text-secondary);">Workers Today</div>
                      <div style="font-weight: 500;">98 / 120</div>
                    </div>
                    <div>
                      <div style="font-size: 12px; color: var(--text-secondary);">Progress</div>
                      <div style="font-weight: 500; color: var(--warning-color);">45%</div>
                    </div>
                    <div>
                      <div style="font-size: 12px; color: var(--text-secondary);">Last Updated</div>
                      <div style="font-weight: 500;">1 hour ago</div>
                    </div>
                  </div>

                  <div style="margin-bottom: 16px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                      <span style="font-size: 13px;">Overall Progress</span>
                      <span style="font-size: 13px; font-weight: 600;">45%</span>
                    </div>
                    <div class="progress-bar">
                      <div class="progress-fill warning" style="width: 45%;"></div>
                    </div>
                  </div>

                  <div style="display: flex; gap: 8px;">
                    <button class="btn btn-primary" style="flex: 1;" onclick="viewSiteDetails(this)">View Details</button>
                    <button class="btn btn-secondary" onclick="openSiteDailyReport(this)">Daily Report</button>
                  </div>
                </div>

                <!-- Site Card 3 -->
                <div class="card" style="margin: 0;">
                  <div style="display: flex; justify-content: space-between; margin-bottom: 16px;">
                    <div>
                      <h3 style="font-size: 18px; margin-bottom: 4px;">Green Valley Resort</h3>
                      <div style="font-size: 13px; color: var(--text-secondary);">Manesar, Haryana</div>
                    </div>
                    <span class="badge badge-warning">Planning</span>
                  </div>

                  <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px;">
                    <div>
                      <div style="font-size: 12px; color: var(--text-secondary);">Site Manager</div>
                      <div style="font-weight: 500;">Suresh Verma</div>
                    </div>
                    <div>
                      <div style="font-size: 12px; color: var(--text-secondary);">Workers Today</div>
                      <div style="font-weight: 500;">45 / 80</div>
                    </div>
                    <div>
                      <div style="font-size: 12px; color: var(--text-secondary);">Progress</div>
                      <div style="font-weight: 500; color: var(--text-secondary);">15%</div>
                    </div>
                    <div>
                      <div style="font-size: 12px; color: var(--text-secondary);">Last Updated</div>
                      <div style="font-weight: 500;">3 hours ago</div>
                    </div>
                  </div>

                  <div style="margin-bottom: 16px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                      <span style="font-size: 13px;">Overall Progress</span>
                      <span style="font-size: 13px; font-weight: 600;">15%</span>
                    </div>
                    <div class="progress-bar">
                      <div class="progress-fill" style="width: 15%;"></div>
                    </div>
                  </div>

                  <div style="display: flex; gap: 8px;">
                    <button class="btn btn-primary" style="flex: 1;" onclick="viewSiteDetails(this)">View Details</button>
                    <button class="btn btn-secondary" onclick="openSiteDailyReport(this)">Daily Report</button>
                  </div>
                </div>

                <!-- Site Card 4 -->
                <div class="card" style="margin: 0;">
                  <div style="display: flex; justify-content: space-between; margin-bottom: 16px;">
                    <div>
                      <h3 style="font-size: 18px; margin-bottom: 4px;">Smart City Complex</h3>
                      <div style="font-size: 13px; color: var(--text-secondary);">Greater Noida West</div>
                    </div>
                    <span class="badge badge-success">Active</span>
                  </div>

                  <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px;">
                    <div>
                      <div style="font-size: 12px; color: var(--text-secondary);">Site Manager</div>
                      <div style="font-weight: 500;">Vikram Joshi</div>
                    </div>
                    <div>
                      <div style="font-size: 12px; color: var(--text-secondary);">Workers Today</div>
                      <div style="font-weight: 500;">57 / 65</div>
                    </div>
                    <div>
                      <div style="font-size: 12px; color: var(--text-secondary);">Progress</div>
                      <div style="font-weight: 500; color: var(--warning-color);">58%</div>
                    </div>
                    <div>
                      <div style="font-size: 12px; color: var(--text-secondary);">Last Updated</div>
                      <div style="font-weight: 500;">30 mins ago</div>
                    </div>
                  </div>

                  <div style="margin-bottom: 16px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                      <span style="font-size: 13px;">Overall Progress</span>
                      <span style="font-size: 13px; font-weight: 600;">58%</span>
                    </div>
                    <div class="progress-bar">
                      <div class="progress-fill warning" style="width: 58%;"></div>
                    </div>
                  </div>

                  <div style="display: flex; gap: 8px;">
                    <button class="btn btn-primary" style="flex: 1;" onclick="viewSiteDetails(this)">View Details</button>
                    <button class="btn btn-secondary" onclick="openSiteDailyReport(this)">Daily Report</button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Labour Tab -->
          <div id="labour" class="tab-content">
            <div style="padding-top: 20px;">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3>Labour Management</h3>
                <button class="btn btn-primary" onclick="openAddWorkerModal()">+ Add Worker</button>
              </div>

              <!-- Labour Stats -->
              <div class="grid grid-4" style="margin-bottom: 24px;">
                <div style="padding: 16px; background: var(--bg-primary); border-radius: 8px;">
                  <div style="font-size: 13px; color: var(--text-secondary);">Total Workers</div>
                  <div style="font-size: 24px; font-weight: 700; color: var(--primary-color);">342</div>
                </div>
                <div style="padding: 16px; background: var(--bg-primary); border-radius: 8px;">
                  <div style="font-size: 13px; color: var(--text-secondary);">Present Today</div>
                  <div style="font-size: 24px; font-weight: 700; color: var(--success-color);">302</div>
                </div>
                <div style="padding: 16px; background: var(--bg-primary); border-radius: 8px;">
                  <div style="font-size: 13px; color: var(--text-secondary);">Absent</div>
                  <div style="font-size: 24px; font-weight: 700; color: var(--danger-color);">40</div>
                </div>
                <div style="padding: 16px; background: var(--bg-primary); border-radius: 8px;">
                  <div style="font-size: 13px; color: var(--text-secondary);">Attendance Rate</div>
                  <div style="font-size: 24px; font-weight: 700; color: var(--success-color);">88%</div>
                </div>
              </div>

              <div class="table-container">
                <table>
                  <thead>
                    <tr>
                      <th>Worker ID</th>
                      <th>Name</th>
                      <th>Category</th>
                      <th>Site</th>
                      <th>Phone</th>
                      <th>Daily Rate</th>
                      <th>Attendance %</th>
                      <th>Status</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td><strong>WKR-001</strong></td>
                      <td>Ramesh Kumar</td>
                      <td><span class="badge badge-info">Mason</span></td>
                      <td>Apollo Towers</td>
                      <td>9876543210</td>
                      <td>‚Çπ850</td>
                      <td>95%</td>
                      <td><span class="badge badge-success">Active</span></td>
                      <td>
                        <button class="btn btn-secondary btn-icon" style="padding: 6px;" onclick="viewWorkerRow(this)">üëÅÔ∏è</button>
                        <button class="btn btn-secondary btn-icon" style="padding: 6px;" onclick="editWorkerRow(this)">üìù</button>
                      </td>
                    </tr>
                    <tr>
                      <td><strong>WKR-002</strong></td>
                      <td>Suresh Yadav</td>
                      <td><span class="badge badge-info">Carpenter</span></td>
                      <td>Metro Plaza</td>
                      <td>9876543211</td>
                      <td>‚Çπ900</td>
                      <td>92%</td>
                      <td><span class="badge badge-success">Active</span></td>
                      <td>
                        <button class="btn btn-secondary btn-icon" style="padding: 6px;" onclick="viewWorkerRow(this)">üëÅÔ∏è</button>
                        <button class="btn btn-secondary btn-icon" style="padding: 6px;" onclick="editWorkerRow(this)">üìù</button>
                      </td>
                    </tr>
                    <tr>
                      <td><strong>WKR-003</strong></td>
                      <td>Mukesh Sharma</td>
                      <td><span class="badge badge-warning">Electrician</span></td>
                      <td>Apollo Towers</td>
                      <td>9876543212</td>
                      <td>‚Çπ1,100</td>
                      <td>88%</td>
                      <td><span class="badge badge-success">Active</span></td>
                      <td>
                        <button class="btn btn-secondary btn-icon" style="padding: 6px;" onclick="viewWorkerRow(this)">üëÅÔ∏è</button>
                        <button class="btn btn-secondary btn-icon" style="padding: 6px;" onclick="editWorkerRow(this)">üìù</button>
                      </td>
                    </tr>
                    <tr>
                      <td><strong>WKR-004</strong></td>
                      <td>Vijay Singh</td>
                      <td><span class="badge badge-warning">Plumber</span></td>
                      <td>Smart City</td>
                      <td>9876543213</td>
                      <td>‚Çπ1,050</td>
                      <td>90%</td>
                      <td><span class="badge badge-success">Active</span></td>
                      <td>
                        <button class="btn btn-secondary btn-icon" style="padding: 6px;" onclick="viewWorkerRow(this)">üëÅÔ∏è</button>
                        <button class="btn btn-secondary btn-icon" style="padding: 6px;" onclick="editWorkerRow(this)">üìù</button>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- Equipment Tab -->
          <div id="equipment" class="tab-content">
            <div style="padding-top: 20px;">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3>Equipment Management</h3>
                <button class="btn btn-primary" onclick="openAddEquipmentModal()">+ Add Equipment</button>
              </div>

              <!-- Equipment Stats -->
              <div class="grid grid-4" style="margin-bottom: 24px;">
                <div style="padding: 16px; background: var(--bg-primary); border-radius: 8px;">
                  <div style="font-size: 13px; color: var(--text-secondary);">Total Equipment</div>
                  <div style="font-size: 24px; font-weight: 700; color: var(--primary-color);">148</div>
                </div>
                <div style="padding: 16px; background: var(--bg-primary); border-radius: 8px;">
                  <div style="font-size: 13px; color: var(--text-secondary);">In Operation</div>
                  <div style="font-size: 24px; font-weight: 700; color: var(--success-color);">112</div>
                </div>
                <div style="padding: 16px; background: var(--bg-primary); border-radius: 8px;">
                  <div style="font-size: 13px; color: var(--text-secondary);">Maintenance Due</div>
                  <div style="font-size: 24px; font-weight: 700; color: var(--warning-color);">8</div>
                </div>
                <div style="padding: 16px; background: var(--bg-primary); border-radius: 8px;">
                  <div style="font-size: 13px; color: var(--text-secondary);">Utilization Rate</div>
                  <div style="font-size: 24px; font-weight: 700; color: var(--success-color);">76%</div>
                </div>
              </div>

              <div class="table-container">
                <table>
                  <thead>
                    <tr>
                      <th>Equipment ID</th>
                      <th>Name</th>
                      <th>Type</th>
                      <th>Model</th>
                      <th>Location</th>
                      <th>Status</th>
                      <th>Last Maintenance</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td><strong>EQP-001</strong></td>
                      <td>Excavator - Komatsu</td>
                      <td><span class="badge badge-info">Heavy Machinery</span></td>
                      <td>PC200-8</td>
                      <td>Apollo Towers</td>
                      <td><span class="badge badge-success">In Use</span></td>
                      <td>Jan 15, 2026</td>
                      <td>
                        <button class="btn btn-secondary btn-icon" style="padding: 6px;" onclick="viewEquipmentRow(this)">üëÅÔ∏è</button>
                        <button class="btn btn-secondary btn-icon" style="padding: 6px;" onclick="editEquipmentRow(this)">üìù</button>
                      </td>
                    </tr>
                    <tr>
                      <td><strong>EQP-002</strong></td>
                      <td>Tower Crane</td>
                      <td><span class="badge badge-info">Heavy Machinery</span></td>
                      <td>Potain MCT 85</td>
                      <td>Metro Plaza</td>
                      <td><span class="badge badge-success">In Use</span></td>
                      <td>Jan 10, 2026</td>
                      <td>
                        <button class="btn btn-secondary btn-icon" style="padding: 6px;" onclick="viewEquipmentRow(this)">üëÅÔ∏è</button>
                        <button class="btn btn-secondary btn-icon" style="padding: 6px;" onclick="editEquipmentRow(this)">üìù</button>
                      </td>
                    </tr>
                    <tr style="background: rgba(245, 158, 11, 0.05);">
                      <td><strong>EQP-003</strong></td>
                      <td>Bulldozer - Caterpillar</td>
                      <td><span class="badge badge-info">Heavy Machinery</span></td>
                      <td>D6T</td>
                      <td>Workshop</td>
                      <td><span class="badge badge-warning">Maintenance</span></td>
                      <td>Dec 28, 2025</td>
                      <td>
                        <button class="btn btn-warning" style="padding: 6px 12px; font-size: 12px;" onclick="scheduleEquipmentMaintenance(this)">Schedule</button>
                      </td>
                    </tr>
                    <tr>
                      <td><strong>EQP-004</strong></td>
                      <td>Generator - 100 KVA</td>
                      <td><span class="badge badge-secondary">Power Equipment</span></td>
                      <td>Kirloskar</td>
                      <td>Apollo Towers</td>
                      <td><span class="badge badge-success">In Use</span></td>
                      <td>Jan 18, 2026</td>
                      <td>
                        <button class="btn btn-secondary btn-icon" style="padding: 6px;" onclick="viewEquipmentRow(this)">üëÅÔ∏è</button>
                        <button class="btn btn-secondary btn-icon" style="padding: 6px;" onclick="editEquipmentRow(this)">üìù</button>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- Quality Control Tab -->
          <div id="qualityControl" class="tab-content">
            <div style="padding-top: 20px;">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3>Quality Control & Inspections</h3>
                <button class="btn btn-primary" onclick="openNewInspectionModal()">+ New Inspection</button>
              </div>

              <!-- Quality Stats -->
              <div class="grid grid-4" style="margin-bottom: 24px;">
                <div style="padding: 16px; background: var(--bg-primary); border-radius: 8px;">
                  <div style="font-size: 13px; color: var(--text-secondary);">Total Inspections</div>
                  <div style="font-size: 24px; font-weight: 700; color: var(--primary-color);">245</div>
                </div>
                <div style="padding: 16px; background: var(--bg-primary); border-radius: 8px;">
                  <div style="font-size: 13px; color: var(--text-secondary);">Pass Rate</div>
                  <div style="font-size: 24px; font-weight: 700; color: var(--success-color);">94%</div>
                </div>
                <div style="padding: 16px; background: var(--bg-primary); border-radius: 8px;">
                  <div style="font-size: 13px; color: var(--text-secondary);">Non-Conformances</div>
                  <div style="font-size: 24px; font-weight: 700; color: var(--danger-color);">15</div>
                </div>
                <div style="padding: 16px; background: var(--bg-primary); border-radius: 8px;">
                  <div style="font-size: 13px; color: var(--text-secondary);">Quality Score</div>
                  <div style="font-size: 24px; font-weight: 700; color: var(--success-color);">8.9/10</div>
                </div>
              </div>

              <div class="table-container">
                <table>
                  <thead>
                    <tr>
                      <th>Inspection ID</th>
                      <th>Type</th>
                      <th>Project</th>
                      <th>Date</th>
                      <th>Inspector</th>
                      <th>Result</th>
                      <th>Score</th>
                      <th>Status</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td><strong>INS-2026-0245</strong></td>
                      <td>Foundation</td>
                      <td>Apollo Towers</td>
                      <td>Jan 30, 2026</td>
                      <td>Rajesh Singh</td>
                      <td>Apollo Towers</td>
                      <td>Jan 28, 2026</td>
                      <td>Mukesh Prasad</td>
                      <td><span class="badge badge-danger">Failed</span></td>
                      <td><strong>6.5/10</strong></td>
                      <td><span class="badge badge-success">Completed</span></td>
                      <td>
                        <button class="btn btn-danger" style="padding: 6px 12px; font-size: 12px;" onclick="actionRequiredInspection(this)">Action Required</button>
                      </td>
                    </tr>
                    <tr>
                      <td><strong>INS-2026-0242</strong></td>
                      <td>Concrete Quality</td>
                      <td>Green Valley</td>
                      <td>Jan 27, 2026</td>
                      <td>Suresh Verma</td>
                      <td><span class="badge badge-success">Passed</span></td>
                      <td><strong>8.8/10</strong></td>
                      <td><span class="badge badge-success">Completed</span></td>
                      <td>
                        <button class="btn btn-secondary btn-icon" style="padding: 6px;" onclick="viewInspectionRow(this)">üëÅÔ∏è</button>
                        <button class="btn btn-secondary btn-icon" style="padding: 6px;" onclick="openInspectionReport(this)">üìÑ</button>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- WBS & Work Packages Tab -->
          <div id="wbs" class="tab-content">
            <div style="padding-top: 20px;">
              <h3 style="margin-bottom: 16px;">WBS & Work Packages</h3>
              <p style="font-size: 13px; color: var(--text-secondary);">Structure projects into WBS, allocate budgets, and track scope.</p>
              <div class="grid grid-2 mt-3" style="gap: 20px;">
                <div class="card" style="margin: 0;">
                  <div class="card-header">
                    <h4 class="card-title">WBS Builder</h4>
                    <button class="btn btn-secondary" id="wbs-add-new" type="button">+ New</button>
                  </div>

                  <form id="wbs-form" class="form-grid" style="margin-bottom: 16px;">
                    <input type="hidden" id="wbs-edit-index" value="">
                    <div class="form-group">
                      <label for="wbs-code">WBS Code</label>
                      <input type="text" id="wbs-code" required placeholder="WBS-01.02">
                    </div>
                    <div class="form-group">
                      <label for="wbs-name">Deliverable</label>
                      <input type="text" id="wbs-name" required placeholder="Foundation Works">
                    </div>
                    <div class="form-group">
                      <label for="wbs-level">Level</label>
                      <select id="wbs-level" class="form-select" required>
                        <option value="L1">L1</option>
                        <option value="L2">L2</option>
                        <option value="L3">L3</option>
                      </select>
                    </div>
                    <div class="form-group">
                      <label for="wbs-budget">Budget (‚Çπ)</label>
                      <input type="number" id="wbs-budget" required min="0" step="0.01" placeholder="1200000">
                    </div>
                    <div class="form-group">
                      <label for="wbs-owner">Owner</label>
                      <input type="text" id="wbs-owner" required placeholder="Planning Lead">
                    </div>
                    <div class="form-group">
                      <label for="wbs-status">Status</label>
                      <select id="wbs-status" class="form-select" required>
                        <option value="Planned">Planned</option>
                        <option value="Active">Active</option>
                        <option value="Closed">Closed</option>
                      </select>
                    </div>
                    <div style="display: flex; gap: 8px; align-items: flex-end;">
                      <button class="btn btn-primary" type="submit">Save</button>
                      <button class="btn btn-secondary" type="button" id="wbs-cancel" style="display: none;">Cancel</button>
                    </div>
                  </form>

                  <div class="table-container">
                    <table>
                      <thead>
                        <tr>
                          <th>WBS Code</th>
                          <th>Deliverable</th>
                          <th>Level</th>
                          <th>Budget</th>
                          <th>Owner</th>
                          <th>Status</th>
                          <th>Actions</th>
                        </tr>
                      </thead>
                      <tbody id="wbs-table-body"></tbody>
                    </table>
                  </div>

                  <div style="margin-top: 12px; display: flex; justify-content: space-between; align-items: center;">
                    <div style="display: flex; gap: 12px; font-size: 12px; color: var(--text-secondary);">
                      <span>Active: <strong id="wbs-active-count">0</strong></span>
                      <span>Planned: <strong id="wbs-planned-count">0</strong></span>
                      <span>Closed: <strong id="wbs-closed-count">0</strong></span>
                    </div>
                    <button class="btn btn-secondary" id="wbs-export" type="button">Export WBS</button>
                  </div>
                </div>

                <div class="card" style="margin: 0;">
                  <div class="card-header">
                    <h4 class="card-title">Work Packages</h4>
                    <button class="btn btn-secondary" id="wp-add-new" type="button">+ New</button>
                  </div>

                  <form id="wp-form" class="form-grid" style="margin-bottom: 16px;">
                    <input type="hidden" id="wp-edit-index" value="">
                    <div class="form-group">
                      <label for="wp-id">Package ID</label>
                      <input type="text" id="wp-id" required placeholder="WP-2026-031">
                    </div>
                    <div class="form-group">
                      <label for="wp-wbs">WBS Code</label>
                      <select id="wp-wbs" class="form-select" required>
                        <option value="WBS-01.01">WBS-01.01</option>
                        <option value="WBS-01.02">WBS-01.02</option>
                        <option value="WBS-02.01">WBS-02.01</option>
                        <option value="WBS-02.02">WBS-02.02</option>
                        <option value="WBS-03.01">WBS-03.01</option>
                      </select>
                    </div>
                    <div class="form-group">
                      <label for="wp-scope">Scope</label>
                      <input type="text" id="wp-scope" required placeholder="Pile cap excavation">
                    </div>
                    <div class="form-group">
                      <label for="wp-qty">Quantity</label>
                      <input type="number" id="wp-qty" required min="0" step="0.01" placeholder="120">
                    </div>
                    <div class="form-group">
                      <label for="wp-unit">Unit</label>
                      <select id="wp-unit" class="form-select" required>
                        <option value="Cum">Cum</option>
                        <option value="Sqm">Sqm</option>
                        <option value="Nos">Nos</option>
                        <option value="Meter">Meter</option>
                        <option value="Kg">Kg</option>
                        <option value="Ton">Ton</option>
                      </select>
                    </div>
                    <div class="form-group">
                      <label for="wp-budget">Budget (‚Çπ)</label>
                      <input type="number" id="wp-budget" required min="0" step="0.01" placeholder="350000">
                    </div>
                    <div class="form-group">
                      <label for="wp-start">Start</label>
                      <input type="text" id="wp-start" required placeholder="Feb 06, 2026">
                    </div>
                    <div class="form-group">
                      <label for="wp-end">End</label>
                      <input type="text" id="wp-end" required placeholder="Feb 18, 2026">
                    </div>
                    <div class="form-group">
                      <label for="wp-status">Status</label>
                      <select id="wp-status" class="form-select" required>
                        <option value="Planned">Planned</option>
                        <option value="Active">Active</option>
                        <option value="Completed">Completed</option>
                      </select>
                    </div>
                    <div style="display: flex; gap: 8px; align-items: flex-end;">
                      <button class="btn btn-primary" type="submit">Save</button>
                      <button class="btn btn-secondary" type="button" id="wp-cancel" style="display: none;">Cancel</button>
                    </div>
                  </form>

                  <div class="table-container">
                    <table>
                      <thead>
                        <tr>
                          <th>Package</th>
                          <th>WBS</th>
                          <th>Scope</th>
                          <th>Qty</th>
                          <th>Unit</th>
                          <th>Budget</th>
                          <th>Status</th>
                          <th>Actions</th>
                        </tr>
                      </thead>
                      <tbody id="wp-table-body"></tbody>
                    </table>
                  </div>

                  <div style="margin-top: 12px; display: flex; justify-content: space-between; align-items: center;">
                    <div style="display: flex; gap: 12px; font-size: 12px; color: var(--text-secondary);">
                      <span>Active: <strong id="wp-active-count">0</strong></span>
                      <span>Planned: <strong id="wp-planned-count">0</strong></span>
                      <span>Completed: <strong id="wp-completed-count">0</strong></span>
                    </div>
                    <button class="btn btn-secondary" id="wp-export" type="button">Export Packages</button>
                  </div>

                  <div style="margin-top: 12px;" class="table-container">
                    <table>
                      <thead>
                        <tr>
                          <th>Package</th>
                          <th>Status</th>
                          <th>Budget</th>
                        </tr>
                      </thead>
                      <tbody id="wp-summary-body"></tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Scheduling / Gantt Tab -->
          <div id="scheduling" class="tab-content">
            <div style="padding-top: 20px;">
              <h3 style="margin-bottom: 16px;">Scheduling / Gantt</h3>
              <p style="font-size: 13px; color: var(--text-secondary);">Build schedules, dependencies, and critical path.</p>
              <div class="grid grid-2 mt-3" style="gap: 20px;">
                <div class="card" style="margin: 0;">
                  <div class="card-header">
                    <h4 class="card-title">Schedule Register</h4>
                    <button class="btn btn-secondary" id="schedule-add-new" type="button">+ New</button>
                  </div>

                  <form id="schedule-form" class="form-grid" style="margin-bottom: 16px;">
                    <input type="hidden" id="schedule-edit-index" value="">
                    <div class="form-group">
                      <label for="schedule-id">Activity ID</label>
                      <input type="text" id="schedule-id" required placeholder="ACT-2026-041">
                    </div>
                    <div class="form-group">
                      <label for="schedule-task">Task</label>
                      <input type="text" id="schedule-task" required placeholder="Foundation Excavation">
                    </div>
                    <div class="form-group">
                      <label for="schedule-wbs">WBS</label>
                      <select id="schedule-wbs" class="form-select" required>
                        <option value="WBS-01.01">WBS-01.01</option>
                        <option value="WBS-01.02">WBS-01.02</option>
                        <option value="WBS-02.01">WBS-02.01</option>
                        <option value="WBS-02.02">WBS-02.02</option>
                        <option value="WBS-03.01">WBS-03.01</option>
                      </select>
                    </div>
                    <div class="form-group">
                      <label for="schedule-start">Start</label>
                      <input type="text" id="schedule-start" required placeholder="Feb 06, 2026">
                    </div>
                    <div class="form-group">
                      <label for="schedule-end">End</label>
                      <input type="text" id="schedule-end" required placeholder="Feb 18, 2026">
                    </div>
                    <div class="form-group">
                      <label for="schedule-duration">Duration (days)</label>
                      <input type="number" id="schedule-duration" required min="1" step="1" placeholder="12">
                    </div>
                    <div class="form-group">
                      <label for="schedule-dependency">Dependency</label>
                      <input type="text" id="schedule-dependency" required placeholder="ACT-2026-040">
                    </div>
                    <div class="form-group">
                      <label for="schedule-owner">Owner</label>
                      <input type="text" id="schedule-owner" required placeholder="Planning Lead">
                    </div>
                    <div class="form-group">
                      <label for="schedule-progress">Progress (%)</label>
                      <input type="number" id="schedule-progress" required min="0" max="100" step="1" placeholder="35">
                    </div>
                    <div class="form-group">
                      <label for="schedule-status">Status</label>
                      <select id="schedule-status" class="form-select" required>
                        <option value="Planned">Planned</option>
                        <option value="In Progress">In Progress</option>
                        <option value="Completed">Completed</option>
                        <option value="Delayed">Delayed</option>
                      </select>
                    </div>
                    <div style="display: flex; gap: 8px; align-items: flex-end;">
                      <button class="btn btn-primary" type="submit">Save</button>
                      <button class="btn btn-secondary" type="button" id="schedule-cancel" style="display: none;">Cancel</button>
                    </div>
                  </form>

                  <div class="table-container">
                    <table>
                      <thead>
                        <tr>
                          <th>Activity</th>
                          <th>Task</th>
                          <th>WBS</th>
                          <th>Start</th>
                          <th>End</th>
                          <th>Duration</th>
                          <th>Dependency</th>
                          <th>Progress</th>
                          <th>Status</th>
                          <th>Actions</th>
                        </tr>
                      </thead>
                      <tbody id="schedule-table-body"></tbody>
                    </table>
                  </div>

                  <div style="margin-top: 12px;">
                    <button class="btn btn-secondary" id="schedule-export" type="button">Export Schedule</button>
                  </div>
                </div>

                <div class="card" style="margin: 0;">
                  <h4 style="margin-bottom: 12px;">Schedule Summary</h4>
                  <div style="display: grid; gap: 12px;">
                    <div style="display: flex; justify-content: space-between;">
                      <span style="color: var(--text-secondary); font-size: 13px;">Planned</span>
                      <strong id="schedule-planned-count">0</strong>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                      <span style="color: var(--text-secondary); font-size: 13px;">In Progress</span>
                      <strong id="schedule-progress-count">0</strong>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                      <span style="color: var(--text-secondary); font-size: 13px;">Delayed</span>
                      <strong id="schedule-delayed-count">0</strong>
                    </div>
                  </div>

                  <div style="margin-top: 16px;" class="table-container">
                    <table>
                      <thead>
                        <tr>
                          <th>Activity</th>
                          <th>Owner</th>
                          <th>Status</th>
                        </tr>
                      </thead>
                      <tbody id="schedule-summary-body"></tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Cost Estimation & BOQ Tab -->
          <div id="costEstimation" class="tab-content">
            <div style="padding-top: 20px;">
              <h3 style="margin-bottom: 16px;">Cost Estimation & BOQ</h3>
              <p style="font-size: 13px; color: var(--text-secondary);">Prepare BOQ, rate analysis, and project estimates.</p>
              <div class="grid grid-2 mt-3" style="gap: 20px;">
                <div class="card" style="margin: 0;">
                  <div class="card-header">
                    <h4 class="card-title">BOQ Builder</h4>
                    <button class="btn btn-secondary" id="boq-add-new" type="button">+ New</button>
                  </div>

                  <form id="boq-form" class="form-grid" style="margin-bottom: 16px;">
                    <input type="hidden" id="boq-edit-index" value="">
                    <div class="form-group">
                      <label for="boq-item">BOQ Item</label>
                      <input type="text" id="boq-item" required placeholder="Cement (OPC 53)">
                    </div>
                    <div class="form-group">
                      <label for="boq-category">Category</label>
                      <select id="boq-category" class="form-select" required>
                        <option value="Raw Materials">Raw Materials</option>
                        <option value="Finishes">Finishes</option>
                        <option value="MEP">MEP</option>
                        <option value="Equipment">Equipment</option>
                        <option value="Subcontract">Subcontract</option>
                      </select>
                    </div>
                    <div class="form-group">
                      <label for="boq-qty">Quantity</label>
                      <input type="number" id="boq-qty" required min="0" step="0.01" placeholder="250">
                    </div>
                    <div class="form-group">
                      <label for="boq-uom">UOM</label>
                      <select id="boq-uom" class="form-select" required>
                        <option value="Bags">Bags</option>
                        <option value="Nos">Nos</option>
                        <option value="Kg">Kg</option>
                        <option value="Ton">Ton</option>
                        <option value="Cum">Cum</option>
                        <option value="Sqm">Sqm</option>
                        <option value="Meter">Meter</option>
                        <option value="Liter">Liter</option>
                      </select>
                    </div>
                    <div class="form-group">
                      <label for="boq-rate">Rate (‚Çπ)</label>
                      <input type="number" id="boq-rate" required min="0" step="0.01" placeholder="450">
                    </div>
                    <div class="form-group">
                      <label for="boq-waste">Waste (%)</label>
                      <input type="number" id="boq-waste" required min="0" step="0.1" placeholder="2">
                    </div>
                    <div class="form-group">
                      <label for="boq-status">Status</label>
                      <select id="boq-status" class="form-select" required>
                        <option value="Draft">Draft</option>
                        <option value="Reviewed">Reviewed</option>
                        <option value="Approved">Approved</option>
                      </select>
                    </div>
                    <div style="display: flex; gap: 8px; align-items: flex-end;">
                      <button class="btn btn-primary" type="submit">Save</button>
                      <button class="btn btn-secondary" type="button" id="boq-cancel" style="display: none;">Cancel</button>
                    </div>
                  </form>

                  <div class="table-container">
                    <table>
                      <thead>
                        <tr>
                          <th>Item</th>
                          <th>Category</th>
                          <th>Qty</th>
                          <th>UOM</th>
                          <th>Rate</th>
                          <th>Waste</th>
                          <th>Total</th>
                          <th>Status</th>
                          <th>Actions</th>
                        </tr>
                      </thead>
                      <tbody id="boq-table-body"></tbody>
                    </table>
                  </div>

                  <div style="margin-top: 12px; display: flex; justify-content: space-between; align-items: center;">
                    <div style="display: flex; gap: 12px; font-size: 12px; color: var(--text-secondary);">
                      <span>Items: <strong id="boq-item-count">0</strong></span>
                      <span>Total: <strong id="boq-total-cost">‚Çπ0</strong></span>
                      <span>Approved: <strong id="boq-approved-count">0</strong></span>
                    </div>
                    <button class="btn btn-secondary" id="boq-export" type="button">Export BOQ</button>
                  </div>
                </div>

                <div class="card" style="margin: 0;">
                  <div class="card-header">
                    <h4 class="card-title">Estimate Versions</h4>
                    <button class="btn btn-secondary" id="est-add-new" type="button">+ New</button>
                  </div>

                  <form id="est-form" class="form-grid" style="margin-bottom: 16px;">
                    <input type="hidden" id="est-edit-index" value="">
                    <div class="form-group">
                      <label for="est-version">Version</label>
                      <input type="text" id="est-version" required placeholder="EST-2026-V3">
                    </div>
                    <div class="form-group">
                      <label for="est-project">Project</label>
                      <select id="est-project" class="form-select" required>
                        <option value="Apollo Towers">Apollo Towers</option>
                        <option value="Metro Plaza">Metro Plaza</option>
                        <option value="Riverfront Mall">Riverfront Mall</option>
                        <option value="Skyline Residency">Skyline Residency</option>
                      </select>
                    </div>
                    <div class="form-group">
                      <label for="est-prepared">Prepared By</label>
                      <input type="text" id="est-prepared" required placeholder="QS Lead">
                    </div>
                    <div class="form-group">
                      <label for="est-date">Date</label>
                      <input type="text" id="est-date" required placeholder="Feb 03, 2026">
                    </div>
                    <div class="form-group">
                      <label for="est-base">Base Cost (‚Çπ)</label>
                      <input type="number" id="est-base" required min="0" step="0.01" placeholder="6200000">
                    </div>
                    <div class="form-group">
                      <label for="est-contingency">Contingency (%)</label>
                      <input type="number" id="est-contingency" required min="0" step="0.1" placeholder="5">
                    </div>
                    <div class="form-group">
                      <label for="est-status">Status</label>
                      <select id="est-status" class="form-select" required>
                        <option value="Draft">Draft</option>
                        <option value="Submitted">Submitted</option>
                        <option value="Approved">Approved</option>
                      </select>
                    </div>
                    <div style="display: flex; gap: 8px; align-items: flex-end;">
                      <button class="btn btn-primary" type="submit">Save</button>
                      <button class="btn btn-secondary" type="button" id="est-cancel" style="display: none;">Cancel</button>
                    </div>
                  </form>

                  <div class="table-container">
                    <table>
                      <thead>
                        <tr>
                          <th>Version</th>
                          <th>Project</th>
                          <th>Prepared</th>
                          <th>Date</th>
                          <th>Base</th>
                          <th>Contingency</th>
                          <th>Total</th>
                          <th>Status</th>
                          <th>Actions</th>
                        </tr>
                      </thead>
                      <tbody id="est-table-body"></tbody>
                    </table>
                  </div>

                  <div style="margin-top: 12px; display: flex; justify-content: space-between; align-items: center;">
                    <div style="display: flex; gap: 12px; font-size: 12px; color: var(--text-secondary);">
                      <span>Draft: <strong id="est-draft-count">0</strong></span>
                      <span>Submitted: <strong id="est-submitted-count">0</strong></span>
                      <span>Approved: <strong id="est-approved-count">0</strong></span>
                    </div>
                    <button class="btn btn-secondary" id="est-export" type="button">Export Estimates</button>
                  </div>

                  <div style="margin-top: 16px;" class="table-container">
                    <table>
                      <thead>
                        <tr>
                          <th>Category</th>
                          <th>Avg Rate</th>
                          <th>Items</th>
                          <th>Updated</th>
                        </tr>
                      </thead>
                      <tbody id="cost-lib-body"></tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Progress Billing Tab -->
          <div id="progressBilling" class="tab-content">
            <div style="padding-top: 20px;">
              <h3 style="margin-bottom: 16px;">Progress Billing / RA Bills</h3>
              <p style="font-size: 13px; color: var(--text-secondary);">Generate RA bills based on measured work and approvals.</p>
              <div class="grid grid-2 mt-3" style="gap: 20px;">
                <div class="card" style="margin: 0;">
                  <div class="card-header">
                    <h4 class="card-title">Measurement Sheets</h4>
                    <button class="btn btn-secondary" id="ms-add-new" type="button">+ New</button>
                  </div>

                  <form id="ms-form" class="form-grid" style="margin-bottom: 16px;">
                    <input type="hidden" id="ms-edit-index" value="">
                    <div class="form-group">
                      <label for="ms-no">Sheet No</label>
                      <input type="text" id="ms-no" required placeholder="MS-2026-018">
                    </div>
                    <div class="form-group">
                      <label for="ms-project">Project</label>
                      <select id="ms-project" class="form-select" required>
                        <option value="Apollo Towers">Apollo Towers</option>
                        <option value="Metro Plaza">Metro Plaza</option>
                        <option value="Riverfront Mall">Riverfront Mall</option>
                        <option value="Skyline Residency">Skyline Residency</option>
                      </select>
                    </div>
                    <div class="form-group">
                      <label for="ms-work">Work Item</label>
                      <input type="text" id="ms-work" required placeholder="Rebar Fixing">
                    </div>
                    <div class="form-group">
                      <label for="ms-qty">Quantity</label>
                      <input type="number" id="ms-qty" required min="0" step="0.01" placeholder="75">
                    </div>
                    <div class="form-group">
                      <label for="ms-uom">UOM</label>
                      <select id="ms-uom" class="form-select" required>
                        <option value="Ton">Ton</option>
                        <option value="Kg">Kg</option>
                        <option value="Nos">Nos</option>
                        <option value="Cum">Cum</option>
                        <option value="Sqm">Sqm</option>
                        <option value="Meter">Meter</option>
                      </select>
                    </div>
                    <div class="form-group">
                      <label for="ms-rate">Rate (‚Çπ)</label>
                      <input type="number" id="ms-rate" required min="0" step="0.01" placeholder="48500">
                    </div>
                    <div class="form-group">
                      <label for="ms-date">Measured Date</label>
                      <input type="text" id="ms-date" required placeholder="Feb 03, 2026">
                    </div>
                    <div class="form-group">
                      <label for="ms-status">Status</label>
                      <select id="ms-status" class="form-select" required>
                        <option value="Draft">Draft</option>
                        <option value="Submitted">Submitted</option>
                        <option value="Certified">Certified</option>
                      </select>
                    </div>
                    <div style="display: flex; gap: 8px; align-items: flex-end;">
                      <button class="btn btn-primary" type="submit">Save</button>
                      <button class="btn btn-secondary" type="button" id="ms-cancel" style="display: none;">Cancel</button>
                    </div>
                  </form>

                  <div class="table-container">
                    <table>
                      <thead>
                        <tr>
                          <th>Sheet</th>
                          <th>Project</th>
                          <th>Work Item</th>
                          <th>Qty</th>
                          <th>UOM</th>
                          <th>Amount</th>
                          <th>Date</th>
                          <th>Status</th>
                          <th>Actions</th>
                        </tr>
                      </thead>
                      <tbody id="ms-table-body"></tbody>
                    </table>
                  </div>

                  <div style="margin-top: 12px; display: flex; justify-content: space-between; align-items: center;">
                    <div style="display: flex; gap: 12px; font-size: 12px; color: var(--text-secondary);">
                      <span>Draft: <strong id="ms-draft-count">0</strong></span>
                      <span>Submitted: <strong id="ms-submitted-count">0</strong></span>
                      <span>Certified: <strong id="ms-certified-count">0</strong></span>
                    </div>
                    <button class="btn btn-secondary" id="ms-export" type="button">Export Sheets</button>
                  </div>
                </div>

                <div class="card" style="margin: 0;">
                  <div class="card-header">
                    <h4 class="card-title">Bill Certification</h4>
                    <button class="btn btn-secondary" id="ra-add-new" type="button">+ New</button>
                  </div>

                  <form id="ra-form" class="form-grid" style="margin-bottom: 16px;">
                    <input type="hidden" id="ra-edit-index" value="">
                    <div class="form-group">
                      <label for="ra-no">RA Bill No</label>
                      <input type="text" id="ra-no" required placeholder="RA-2026-011">
                    </div>
                    <div class="form-group">
                      <label for="ra-project">Project</label>
                      <select id="ra-project" class="form-select" required>
                        <option value="Apollo Towers">Apollo Towers</option>
                        <option value="Metro Plaza">Metro Plaza</option>
                        <option value="Riverfront Mall">Riverfront Mall</option>
                        <option value="Skyline Residency">Skyline Residency</option>
                      </select>
                    </div>
                    <div class="form-group">
                      <label for="ra-period">Period</label>
                      <input type="text" id="ra-period" required placeholder="Jan 2026">
                    </div>
                    <div class="form-group">
                      <label for="ra-gross">Gross Value (‚Çπ)</label>
                      <input type="number" id="ra-gross" required min="0" step="0.01" placeholder="1850000">
                    </div>
                    <div class="form-group">
                      <label for="ra-deductions">Deductions (‚Çπ)</label>
                      <input type="number" id="ra-deductions" required min="0" step="0.01" placeholder="120000">
                    </div>
                    <div class="form-group">
                      <label for="ra-retention">Retention (%)</label>
                      <input type="number" id="ra-retention" required min="0" step="0.1" placeholder="5">
                    </div>
                    <div class="form-group">
                      <label for="ra-status">Status</label>
                      <select id="ra-status" class="form-select" required>
                        <option value="Submitted">Submitted</option>
                        <option value="Under Review">Under Review</option>
                        <option value="Approved">Approved</option>
                        <option value="Paid">Paid</option>
                      </select>
                    </div>
                    <div style="display: flex; gap: 8px; align-items: flex-end;">
                      <button class="btn btn-primary" type="submit">Save</button>
                      <button class="btn btn-secondary" type="button" id="ra-cancel" style="display: none;">Cancel</button>
                    </div>
                  </form>

                  <div class="table-container">
                    <table>
                      <thead>
                        <tr>
                          <th>RA Bill</th>
                          <th>Project</th>
                          <th>Period</th>
                          <th>Gross</th>
                          <th>Deductions</th>
                          <th>Net</th>
                          <th>Status</th>
                          <th>Actions</th>
                        </tr>
                      </thead>
                      <tbody id="ra-table-body"></tbody>
                    </table>
                  </div>

                  <div style="margin-top: 12px; display: flex; justify-content: space-between; align-items: center;">
                    <div style="display: flex; gap: 12px; font-size: 12px; color: var(--text-secondary);">
                      <span>Submitted: <strong id="ra-submitted-count">0</strong></span>
                      <span>Approved: <strong id="ra-approved-count">0</strong></span>
                      <span>Paid: <strong id="ra-paid-count">0</strong></span>
                    </div>
                    <button class="btn btn-secondary" id="ra-export" type="button">Export Bills</button>
                  </div>

                  <div style="margin-top: 16px;" class="table-container">
                    <table>
                      <thead>
                        <tr>
                          <th>RA Bill</th>
                          <th>Status</th>
                          <th>Net</th>
                        </tr>
                      </thead>
                      <tbody id="ra-summary-body"></tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Change Orders Tab -->
          <div id="changeOrders" class="tab-content">
            <div style="padding-top: 20px;">
              <h3 style="margin-bottom: 16px;">Change Orders</h3>
              <p style="font-size: 13px; color: var(--text-secondary);">Track variations, impact on cost and schedule.</p>
              <div class="grid grid-2 mt-3" style="gap: 20px;">
                <div class="card" style="margin: 0;">
                  <div class="card-header">
                    <h4 class="card-title">Variation Register</h4>
                    <button class="btn btn-secondary" id="co-add-new" type="button">+ New</button>
                  </div>

                  <form id="co-form" class="form-grid" style="margin-bottom: 16px;">
                    <input type="hidden" id="co-edit-index" value="">
                    <div class="form-group">
                      <label for="co-no">Change Order No</label>
                      <input type="text" id="co-no" required placeholder="CO-2026-014">
                    </div>
                    <div class="form-group">
                      <label for="co-project">Project</label>
                      <select id="co-project" class="form-select" required>
                        <option value="Apollo Towers">Apollo Towers</option>
                        <option value="Metro Plaza">Metro Plaza</option>
                        <option value="Riverfront Mall">Riverfront Mall</option>
                        <option value="Skyline Residency">Skyline Residency</option>
                      </select>
                    </div>
                    <div class="form-group">
                      <label for="co-category">Category</label>
                      <select id="co-category" class="form-select" required>
                        <option value="Scope Change">Scope Change</option>
                        <option value="Rate Revision">Rate Revision</option>
                        <option value="Time Extension">Time Extension</option>
                        <option value="Design Change">Design Change</option>
                      </select>
                    </div>
                    <div class="form-group">
                      <label for="co-description">Description</label>
                      <input type="text" id="co-description" required placeholder="Add basement waterproofing">
                    </div>
                    <div class="form-group">
                      <label for="co-cost">Cost Impact (‚Çπ)</label>
                      <input type="number" id="co-cost" required step="0.01" placeholder="275000">
                    </div>
                    <div class="form-group">
                      <label for="co-days">Schedule Impact (days)</label>
                      <input type="number" id="co-days" required step="1" placeholder="5">
                    </div>
                    <div class="form-group">
                      <label for="co-raised">Raised On</label>
                      <input type="text" id="co-raised" required placeholder="Feb 02, 2026">
                    </div>
                    <div class="form-group">
                      <label for="co-owner">Owner</label>
                      <input type="text" id="co-owner" required placeholder="Planning Lead">
                    </div>
                    <div class="form-group">
                      <label for="co-status">Status</label>
                      <select id="co-status" class="form-select" required>
                        <option value="Draft">Draft</option>
                        <option value="Submitted">Submitted</option>
                        <option value="Approved">Approved</option>
                        <option value="Rejected">Rejected</option>
                      </select>
                    </div>
                    <div style="display: flex; gap: 8px; align-items: flex-end;">
                      <button class="btn btn-primary" type="submit">Save</button>
                      <button class="btn btn-secondary" type="button" id="co-cancel" style="display: none;">Cancel</button>
                    </div>
                  </form>

                  <div class="table-container">
                    <table>
                      <thead>
                        <tr>
                          <th>Change Order</th>
                          <th>Project</th>
                          <th>Category</th>
                          <th>Cost Impact</th>
                          <th>Schedule</th>
                          <th>Status</th>
                          <th>Actions</th>
                        </tr>
                      </thead>
                      <tbody id="co-table-body"></tbody>
                    </table>
                  </div>

                  <div style="margin-top: 12px; display: flex; justify-content: space-between; align-items: center;">
                    <div style="display: flex; gap: 12px; font-size: 12px; color: var(--text-secondary);">
                      <span>Draft: <strong id="co-draft-count">0</strong></span>
                      <span>Submitted: <strong id="co-submitted-count">0</strong></span>
                      <span>Approved: <strong id="co-approved-count">0</strong></span>
                    </div>
                    <button class="btn btn-secondary" id="co-export" type="button">Export Change Orders</button>
                  </div>
                </div>

                <div class="card" style="margin: 0;">
                  <h4 style="margin-bottom: 12px;">Impact Summary</h4>
                  <div style="display: grid; gap: 12px;">
                    <div style="display: flex; justify-content: space-between;">
                      <span style="color: var(--text-secondary); font-size: 13px;">Total Cost Impact</span>
                      <strong id="co-total-cost">‚Çπ0</strong>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                      <span style="color: var(--text-secondary); font-size: 13px;">Total Days Impact</span>
                      <strong id="co-total-days">0</strong>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                      <span style="color: var(--text-secondary); font-size: 13px;">Approved Value</span>
                      <strong id="co-approved-value">‚Çπ0</strong>
                    </div>
                  </div>

                  <div style="margin-top: 16px;" class="table-container">
                    <table>
                      <thead>
                        <tr>
                          <th>Change Order</th>
                          <th>Owner</th>
                          <th>Status</th>
                        </tr>
                      </thead>
                      <tbody id="co-summary-body"></tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Contract Management Tab -->
          <div id="contractManagement" class="tab-content">
            <div style="padding-top: 20px;">
              <h3 style="margin-bottom: 16px;">Contract Management</h3>
              <p style="font-size: 13px; color: var(--text-secondary);">Manage client contracts, terms, and deliverables.</p>
              <div class="grid grid-2 mt-3" style="gap: 20px;">
                <div class="card" style="margin: 0;">
                  <div class="card-header">
                    <h4 class="card-title">Contract Repository</h4>
                    <button class="btn btn-secondary" id="contract-add-new" type="button">+ New</button>
                  </div>

                  <form id="contract-mgmt-form" class="form-grid" style="margin-bottom: 16px;">
                    <input type="hidden" id="contract-mgmt-edit-index" value="">
                    <div class="form-group">
                      <label for="contract-no">Contract No</label>
                      <input type="text" id="contract-no" required placeholder="CN-2026-041">
                    </div>
                    <div class="form-group">
                      <label for="contract-client">Client</label>
                      <select id="contract-client" class="form-select" required>
                        <option value="Apollo Infra">Apollo Infra</option>
                        <option value="Metro Holdings">Metro Holdings</option>
                        <option value="Zenith Realty">Zenith Realty</option>
                        <option value="Skyline Developers">Skyline Developers</option>
                      </select>
                    </div>
                    <div class="form-group">
                      <label for="contract-project">Project</label>
                      <select id="contract-project" class="form-select" required>
                        <option value="Apollo Towers">Apollo Towers</option>
                        <option value="Metro Plaza">Metro Plaza</option>
                        <option value="Riverfront Mall">Riverfront Mall</option>
                        <option value="Skyline Residency">Skyline Residency</option>
                      </select>
                    </div>
                    <div class="form-group">
                      <label for="contract-value">Contract Value (‚Çπ)</label>
                      <input type="number" id="contract-value" required min="0" step="0.01" placeholder="18500000">
                    </div>
                    <div class="form-group">
                      <label for="contract-start">Start Date</label>
                      <input type="text" id="contract-start" required placeholder="Jan 01, 2026">
                    </div>
                    <div class="form-group">
                      <label for="contract-end">End Date</label>
                      <input type="text" id="contract-end" required placeholder="Dec 31, 2026">
                    </div>
                    <div class="form-group">
                      <label for="contract-retention">Retention (%)</label>
                      <input type="number" id="contract-retention" required min="0" step="0.1" placeholder="5">
                    </div>
                    <div class="form-group">
                      <label for="contract-ld">LD (%)</label>
                      <input type="number" id="contract-ld" required min="0" step="0.1" placeholder="1">
                    </div>
                    <div class="form-group">
                      <label for="contract-owner">Owner</label>
                      <input type="text" id="contract-owner" required placeholder="Contracts Lead">
                    </div>
                    <div class="form-group">
                      <label for="contract-status">Status</label>
                      <select id="contract-status" class="form-select" required>
                        <option value="Active">Active</option>
                        <option value="Pending">Pending</option>
                        <option value="Closed">Closed</option>
                      </select>
                    </div>
                    <div style="display: flex; gap: 8px; align-items: flex-end;">
                      <button class="btn btn-primary" type="submit">Save</button>
                      <button class="btn btn-secondary" type="button" id="contract-cancel" style="display: none;">Cancel</button>
                    </div>
                  </form>

                  <div class="table-container">
                    <table>
                      <thead>
                        <tr>
                          <th>Contract</th>
                          <th>Client</th>
                          <th>Project</th>
                          <th>Value</th>
                          <th>Start</th>
                          <th>End</th>
                          <th>Status</th>
                          <th>Actions</th>
                        </tr>
                      </thead>
                      <tbody id="contract-mgmt-body"></tbody>
                    </table>
                  </div>

                  <div style="margin-top: 12px; display: flex; justify-content: space-between; align-items: center;">
                    <div style="display: flex; gap: 12px; font-size: 12px; color: var(--text-secondary);">
                      <span>Active: <strong id="contract-active-count">0</strong></span>
                      <span>Pending: <strong id="contract-pending-count">0</strong></span>
                      <span>Closed: <strong id="contract-closed-count">0</strong></span>
                    </div>
                    <button class="btn btn-secondary" id="contract-export" type="button">Export Contracts</button>
                  </div>
                </div>

                <div class="card" style="margin: 0;">
                  <h4 style="margin-bottom: 12px;">Key Terms</h4>
                  <div style="display: grid; gap: 12px;">
                    <div style="display: flex; justify-content: space-between;">
                      <span style="color: var(--text-secondary); font-size: 13px;">Avg Retention</span>
                      <strong id="contract-retention-avg">0%</strong>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                      <span style="color: var(--text-secondary); font-size: 13px;">Avg LD</span>
                      <strong id="contract-ld-avg">0%</strong>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                      <span style="color: var(--text-secondary); font-size: 13px;">Total Value</span>
                      <strong id="contract-total-value">‚Çπ0</strong>
                    </div>
                  </div>

                  <div style="margin-top: 16px;" class="table-container">
                    <table>
                      <thead>
                        <tr>
                          <th>Contract</th>
                          <th>Retention</th>
                          <th>LD</th>
                          <th>Owner</th>
                        </tr>
                      </thead>
                      <tbody id="contract-terms-body"></tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Time & Attendance Tab -->
          <div id="timeAttendance" class="tab-content">
            <div style="padding-top: 20px;">
              <h3 style="margin-bottom: 16px;">Time & Attendance</h3>
              <p style="font-size: 13px; color: var(--text-secondary);">Capture worker attendance and link to billing.</p>
              <div class="grid grid-2 mt-3" style="gap: 20px;">
                <div class="card" style="margin: 0;">
                  <div class="card-header">
                    <h4 class="card-title">Muster Roll</h4>
                    <button class="btn btn-secondary" id="att-add-new" type="button">+ New</button>
                  </div>

                  <form id="att-form" class="form-grid" style="margin-bottom: 16px;">
                    <input type="hidden" id="att-edit-index" value="">
                    <div class="form-group">
                      <label for="att-date">Date</label>
                      <input type="text" id="att-date" required placeholder="Feb 03, 2026">
                    </div>
                    <div class="form-group">
                      <label for="att-site">Site</label>
                      <select id="att-site" class="form-select" required>
                        <option value="Apollo Towers">Apollo Towers</option>
                        <option value="Metro Plaza">Metro Plaza</option>
                        <option value="Riverfront Mall">Riverfront Mall</option>
                        <option value="Skyline Residency">Skyline Residency</option>
                      </select>
                    </div>
                    <div class="form-group">
                      <label for="att-worker">Worker</label>
                      <select id="att-worker" class="form-select" required>
                        <option value="Ravi Kumar">Ravi Kumar</option>
                        <option value="Sandeep Yadav">Sandeep Yadav</option>
                        <option value="Vijay Singh">Vijay Singh</option>
                        <option value="Amit Sharma">Amit Sharma</option>
                        <option value="Priya Singh">Priya Singh</option>
                      </select>
                    </div>
                    <div class="form-group">
                      <label for="att-role">Role</label>
                      <input type="text" id="att-role" required placeholder="Mason">
                    </div>
                    <div class="form-group">
                      <label for="att-hours">Hours</label>
                      <input type="number" id="att-hours" required min="0" step="0.5" placeholder="8">
                    </div>
                    <div class="form-group">
                      <label for="att-overtime">Overtime (hrs)</label>
                      <input type="number" id="att-overtime" required min="0" step="0.5" placeholder="2">
                    </div>
                    <div class="form-group">
                      <label for="att-status">Status</label>
                      <select id="att-status" class="form-select" required>
                        <option value="Present">Present</option>
                        <option value="Absent">Absent</option>
                        <option value="On Leave">On Leave</option>
                      </select>
                    </div>
                    <div style="display: flex; gap: 8px; align-items: flex-end;">
                      <button class="btn btn-primary" type="submit">Save</button>
                      <button class="btn btn-secondary" type="button" id="att-cancel" style="display: none;">Cancel</button>
                    </div>
                  </form>

                  <div class="table-container">
                    <table>
                      <thead>
                        <tr>
                          <th>Date</th>
                          <th>Site</th>
                          <th>Worker</th>
                          <th>Role</th>
                          <th>Hours</th>
                          <th>OT</th>
                          <th>Status</th>
                          <th>Actions</th>
                        </tr>
                      </thead>
                      <tbody id="att-table-body"></tbody>
                    </table>
                  </div>

                  <div style="margin-top: 12px; display: flex; justify-content: space-between; align-items: center;">
                    <div style="display: flex; gap: 12px; font-size: 12px; color: var(--text-secondary);">
                      <span>Present: <strong id="att-present-count">0</strong></span>
                      <span>Absent: <strong id="att-absent-count">0</strong></span>
                      <span>Leave: <strong id="att-leave-count">0</strong></span>
                    </div>
                    <button class="btn btn-secondary" id="att-export" type="button">Export Attendance</button>
                  </div>
                </div>

                <div class="card" style="margin: 0;">
                  <div class="card-header">
                    <h4 class="card-title">Overtime Approvals</h4>
                    <button class="btn btn-secondary" id="ot-add-new" type="button">+ New</button>
                  </div>

                  <form id="ot-form" class="form-grid" style="margin-bottom: 16px;">
                    <input type="hidden" id="ot-edit-index" value="">
                    <div class="form-group">
                      <label for="ot-worker">Worker</label>
                      <select id="ot-worker" class="form-select" required>
                        <option value="Ravi Kumar">Ravi Kumar</option>
                        <option value="Sandeep Yadav">Sandeep Yadav</option>
                        <option value="Vijay Singh">Vijay Singh</option>
                        <option value="Amit Sharma">Amit Sharma</option>
                        <option value="Priya Singh">Priya Singh</option>
                      </select>
                    </div>
                    <div class="form-group">
                      <label for="ot-site">Site</label>
                      <select id="ot-site" class="form-select" required>
                        <option value="Apollo Towers">Apollo Towers</option>
                        <option value="Metro Plaza">Metro Plaza</option>
                        <option value="Riverfront Mall">Riverfront Mall</option>
                        <option value="Skyline Residency">Skyline Residency</option>
                      </select>
                    </div>
                    <div class="form-group">
                      <label for="ot-date">Date</label>
                      <input type="text" id="ot-date" required placeholder="Feb 03, 2026">
                    </div>
                    <div class="form-group">
                      <label for="ot-hours">OT Hours</label>
                      <input type="number" id="ot-hours" required min="0" step="0.5" placeholder="2">
                    </div>
                    <div class="form-group">
                      <label for="ot-rate">OT Rate (‚Çπ/hr)</label>
                      <input type="number" id="ot-rate" required min="0" step="0.01" placeholder="120">
                    </div>
                    <div class="form-group">
                      <label for="ot-approver">Approver</label>
                      <select id="ot-approver" class="form-select" required>
                        <option value="Site Manager">Site Manager</option>
                        <option value="Site Engineer">Site Engineer</option>
                        <option value="Supervisor">Supervisor</option>
                        <option value="Planning Lead">Planning Lead</option>
                      </select>
                    </div>
                    <div class="form-group">
                      <label for="ot-status">Status</label>
                      <select id="ot-status" class="form-select" required>
                        <option value="Pending">Pending</option>
                        <option value="Approved">Approved</option>
                        <option value="Rejected">Rejected</option>
                      </select>
                    </div>
                    <div style="display: flex; gap: 8px; align-items: flex-end;">
                      <button class="btn btn-primary" type="submit">Save</button>
                      <button class="btn btn-secondary" type="button" id="ot-cancel" style="display: none;">Cancel</button>
                    </div>
                  </form>

                  <div class="table-container">
                    <table>
                      <thead>
                        <tr>
                          <th>Worker</th>
                          <th>Site</th>
                          <th>Date</th>
                          <th>Hours</th>
                          <th>Amount</th>
                          <th>Status</th>
                          <th>Actions</th>
                        </tr>
                      </thead>
                      <tbody id="ot-table-body"></tbody>
                    </table>
                  </div>

                  <div style="margin-top: 12px; display: flex; justify-content: space-between; align-items: center;">
                    <div style="display: flex; gap: 12px; font-size: 12px; color: var(--text-secondary);">
                      <span>Pending: <strong id="ot-pending-count">0</strong></span>
                      <span>Approved: <strong id="ot-approved-count">0</strong></span>
                      <span>Rejected: <strong id="ot-rejected-count">0</strong></span>
                    </div>
                    <button class="btn btn-secondary" id="ot-export" type="button">Export OT</button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Subcontractor Billing Tab -->
          <div id="subcontractorBilling" class="tab-content">
            <div style="padding-top: 20px;">
              <h3 style="margin-bottom: 16px;">Subcontractor Billing</h3>
              <p style="font-size: 13px; color: var(--text-secondary);">Create bills against work orders and certify progress.</p>
              <div class="grid grid-2 mt-3" style="gap: 20px;">
                <div class="card" style="margin: 0;">
                  <div class="card-header">
                    <h4 class="card-title">WO Billing</h4>
                    <button class="btn btn-secondary" id="subc-add-new" type="button">+ New</button>
                  </div>

                  <form id="subc-form" class="form-grid" style="margin-bottom: 16px;">
                    <input type="hidden" id="subc-edit-index" value="">
                    <div class="form-group">
                      <label for="subc-bill-no">Bill No</label>
                      <input type="text" id="subc-bill-no" required placeholder="SB-2026-015">
                    </div>
                    <div class="form-group">
                      <label for="subc-wo">WO No</label>
                      <input type="text" id="subc-wo" required placeholder="WO-2026-042">
                    </div>
                    <div class="form-group">
                      <label for="subc-name">Subcontractor</label>
                      <input type="text" id="subc-name" required placeholder="BuildMate Services">
                    </div>
                    <div class="form-group">
                      <label for="subc-scope">Work Scope</label>
                      <input type="text" id="subc-scope" required placeholder="Masonry Works">
                    </div>
                    <div class="form-group">
                      <label for="subc-qty">Quantity</label>
                      <input type="number" id="subc-qty" required min="0" step="0.01" placeholder="120">
                    </div>
                    <div class="form-group">
                      <label for="subc-rate">Rate (‚Çπ)</label>
                      <input type="number" id="subc-rate" required min="0" step="0.01" placeholder="850">
                    </div>
                    <div class="form-group">
                      <label for="subc-retention">Retention (%)</label>
                      <input type="number" id="subc-retention" required min="0" step="0.1" placeholder="5">
                    </div>
                    <div class="form-group">
                      <label for="subc-deduction">Deductions (‚Çπ)</label>
                      <input type="number" id="subc-deduction" required min="0" step="0.01" placeholder="25000">
                    </div>
                    <div class="form-group">
                      <label for="subc-status">Status</label>
                      <select id="subc-status" class="form-select" required>
                        <option value="Submitted">Submitted</option>
                        <option value="Certified">Certified</option>
                        <option value="Paid">Paid</option>
                      </select>
                    </div>
                    <div style="display: flex; gap: 8px; align-items: flex-end;">
                      <button class="btn btn-primary" type="submit">Save</button>
                      <button class="btn btn-secondary" type="button" id="subc-cancel" style="display: none;">Cancel</button>
                    </div>
                  </form>

                  <div class="table-container">
                    <table>
                      <thead>
                        <tr>
                          <th>Bill</th>
                          <th>WO</th>
                          <th>Subcontractor</th>
                          <th>Scope</th>
                          <th>Amount</th>
                          <th>Net</th>
                          <th>Status</th>
                          <th>Actions</th>
                        </tr>
                      </thead>
                      <tbody id="subc-table-body"></tbody>
                    </table>
                  </div>

                  <div style="margin-top: 12px; display: flex; justify-content: space-between; align-items: center;">
                    <div style="display: flex; gap: 12px; font-size: 12px; color: var(--text-secondary);">
                      <span>Submitted: <strong id="subc-submitted-count">0</strong></span>
                      <span>Certified: <strong id="subc-certified-count">0</strong></span>
                      <span>Paid: <strong id="subc-paid-count">0</strong></span>
                    </div>
                    <button class="btn btn-secondary" id="subc-export" type="button">Export Bills</button>
                  </div>
                </div>

                <div class="card" style="margin: 0;">
                  <h4 style="margin-bottom: 12px;">Retention & Deductions</h4>
                  <div style="display: grid; gap: 12px;">
                    <div style="display: flex; justify-content: space-between;">
                      <span style="color: var(--text-secondary); font-size: 13px;">Total Gross</span>
                      <strong id="subc-total-gross">‚Çπ0</strong>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                      <span style="color: var(--text-secondary); font-size: 13px;">Total Retention</span>
                      <strong id="subc-total-retention">‚Çπ0</strong>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                      <span style="color: var(--text-secondary); font-size: 13px;">Total Net</span>
                      <strong id="subc-total-net">‚Çπ0</strong>
                    </div>
                  </div>

                  <div style="margin-top: 16px;" class="table-container">
                    <table>
                      <thead>
                        <tr>
                          <th>Bill</th>
                          <th>Retention</th>
                          <th>Deductions</th>
                          <th>Net</th>
                        </tr>
                      </thead>
                      <tbody id="subc-summary-body"></tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Project Forecasting Tab -->
          <div id="forecasting" class="tab-content">
            <div style="padding-top: 20px;">
              <h3 style="margin-bottom: 16px;">Project Forecasting</h3>
              <p style="font-size: 13px; color: var(--text-secondary);">Forecast cost-to-complete and timeline impact.</p>
              <div class="grid grid-2 mt-3" style="gap: 20px;">
                <div class="card" style="margin: 0;">
                  <div class="card-header">
                    <h4 class="card-title">EAC Register</h4>
                    <button class="btn btn-secondary" id="eac-add-new" type="button">+ New</button>
                  </div>

                  <form id="eac-form" class="form-grid" style="margin-bottom: 16px;">
                    <input type="hidden" id="eac-edit-index" value="">
                    <div class="form-group">
                      <label for="eac-project">Project</label>
                      <select id="eac-project" class="form-select" required>
                        <option value="Apollo Towers">Apollo Towers</option>
                        <option value="Metro Plaza">Metro Plaza</option>
                        <option value="Riverfront Mall">Riverfront Mall</option>
                        <option value="Skyline Residency">Skyline Residency</option>
                      </select>
                    </div>
                    <div class="form-group">
                      <label for="eac-budget">Budget (‚Çπ)</label>
                      <input type="number" id="eac-budget" required min="0" step="0.01" placeholder="18500000">
                    </div>
                    <div class="form-group">
                      <label for="eac-actual">Actual to Date (‚Çπ)</label>
                      <input type="number" id="eac-actual" required min="0" step="0.01" placeholder="6200000">
                    </div>
                    <div class="form-group">
                      <label for="eac-etc">ETC (‚Çπ)</label>
                      <input type="number" id="eac-etc" required min="0" step="0.01" placeholder="9800000">
                    </div>
                    <div class="form-group">
                      <label for="eac-period">Period</label>
                      <input type="text" id="eac-period" required placeholder="Feb 2026">
                    </div>
                    <div class="form-group">
                      <label for="eac-status">Status</label>
                      <select id="eac-status" class="form-select" required>
                        <option value="On Track">On Track</option>
                        <option value="At Risk">At Risk</option>
                        <option value="Over Budget">Over Budget</option>
                      </select>
                    </div>
                    <div style="display: flex; gap: 8px; align-items: flex-end;">
                      <button class="btn btn-primary" type="submit">Save</button>
                      <button class="btn btn-secondary" type="button" id="eac-cancel" style="display: none;">Cancel</button>
                    </div>
                  </form>

                  <div class="table-container">
                    <table>
                      <thead>
                        <tr>
                          <th>Project</th>
                          <th>Budget</th>
                          <th>Actual</th>
                          <th>ETC</th>
                          <th>EAC</th>
                          <th>Variance</th>
                          <th>Status</th>
                          <th>Actions</th>
                        </tr>
                      </thead>
                      <tbody id="eac-table-body"></tbody>
                    </table>
                  </div>

                  <div style="margin-top: 12px; display: flex; justify-content: space-between; align-items: center;">
                    <div style="display: flex; gap: 12px; font-size: 12px; color: var(--text-secondary);">
                      <span>On Track: <strong id="eac-ontrack-count">0</strong></span>
                      <span>At Risk: <strong id="eac-atrisk-count">0</strong></span>
                      <span>Over Budget: <strong id="eac-over-count">0</strong></span>
                    </div>
                    <button class="btn btn-secondary" id="eac-export" type="button">Export EAC</button>
                  </div>
                </div>

                <div class="card" style="margin: 0;">
                  <div class="card-header">
                    <h4 class="card-title">Cash Forecast</h4>
                    <button class="btn btn-secondary" id="cash-add-new" type="button">+ New</button>
                  </div>

                  <form id="cash-form" class="form-grid" style="margin-bottom: 16px;">
                    <input type="hidden" id="cash-edit-index" value="">
                    <div class="form-group">
                      <label for="cash-project">Project</label>
                      <select id="cash-project" class="form-select" required>
                        <option value="Apollo Towers">Apollo Towers</option>
                        <option value="Metro Plaza">Metro Plaza</option>
                        <option value="Riverfront Mall">Riverfront Mall</option>
                        <option value="Skyline Residency">Skyline Residency</option>
                      </select>
                    </div>
                    <div class="form-group">
                      <label for="cash-month">Month</label>
                      <input type="text" id="cash-month" required placeholder="Feb 2026">
                    </div>
                    <div class="form-group">
                      <label for="cash-inflow">Inflow (‚Çπ)</label>
                      <input type="number" id="cash-inflow" required min="0" step="0.01" placeholder="4200000">
                    </div>
                    <div class="form-group">
                      <label for="cash-outflow">Outflow (‚Çπ)</label>
                      <input type="number" id="cash-outflow" required min="0" step="0.01" placeholder="3800000">
                    </div>
                    <div class="form-group">
                      <label for="cash-owner">Owner</label>
                      <input type="text" id="cash-owner" required placeholder="Finance Lead">
                    </div>
                    <div class="form-group">
                      <label for="cash-status">Status</label>
                      <select id="cash-status" class="form-select" required>
                        <option value="Balanced">Balanced</option>
                        <option value="Surplus">Surplus</option>
                        <option value="Deficit">Deficit</option>
                      </select>
                    </div>
                    <div style="display: flex; gap: 8px; align-items: flex-end;">
                      <button class="btn btn-primary" type="submit">Save</button>
                      <button class="btn btn-secondary" type="button" id="cash-cancel" style="display: none;">Cancel</button>
                    </div>
                  </form>

                  <div class="table-container">
                    <table>
                      <thead>
                        <tr>
                          <th>Project</th>
                          <th>Month</th>
                          <th>Inflow</th>
                          <th>Outflow</th>
                          <th>Net</th>
                          <th>Status</th>
                          <th>Actions</th>
                        </tr>
                      </thead>
                      <tbody id="cash-table-body"></tbody>
                    </table>
                  </div>

                  <div style="margin-top: 12px; display: flex; justify-content: space-between; align-items: center;">
                    <div style="display: flex; gap: 12px; font-size: 12px; color: var(--text-secondary);">
                      <span>Surplus: <strong id="cash-surplus-count">0</strong></span>
                      <span>Balanced: <strong id="cash-balanced-count">0</strong></span>
                      <span>Deficit: <strong id="cash-deficit-count">0</strong></span>
                    </div>
                    <button class="btn btn-secondary" id="cash-export" type="button">Export Cash Forecast</button>
                  </div>

                  <div style="margin-top: 16px;" class="table-container">
                    <table>
                      <thead>
                        <tr>
                          <th>Project</th>
                          <th>Owner</th>
                          <th>Status</th>
                        </tr>
                      </thead>
                      <tbody id="cash-summary-body"></tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Cash Flow Planning Tab -->
          <div id="cashFlow" class="tab-content">
            <div style="padding-top: 20px;">
              <h3 style="margin-bottom: 16px;">Cash Flow Planning</h3>
              <p style="font-size: 13px; color: var(--text-secondary);">Plan monthly cash flow based on schedules and billing.</p>
              <div class="grid grid-2 mt-3" style="gap: 20px;">
                <div class="card" style="margin: 0;">
                  <div class="card-header">
                    <h4 class="card-title">Cash Flow Plan</h4>
                    <button class="btn btn-secondary" id="cflow-add-new" type="button">+ New</button>
                  </div>

                  <form id="cflow-form" class="form-grid" style="margin-bottom: 16px;">
                    <input type="hidden" id="cflow-edit-index" value="">
                    <div class="form-group">
                      <label for="cflow-project">Project</label>
                      <select id="cflow-project" class="form-select" required>
                        <option value="Apollo Towers">Apollo Towers</option>
                        <option value="Metro Plaza">Metro Plaza</option>
                        <option value="Riverfront Mall">Riverfront Mall</option>
                        <option value="Skyline Residency">Skyline Residency</option>
                      </select>
                    </div>
                    <div class="form-group">
                      <label for="cflow-month">Month</label>
                      <input type="text" id="cflow-month" required placeholder="Mar 2026">
                    </div>
                    <div class="form-group">
                      <label for="cflow-opening">Opening Balance (‚Çπ)</label>
                      <input type="number" id="cflow-opening" required min="0" step="0.01" placeholder="1200000">
                    </div>
                    <div class="form-group">
                      <label for="cflow-receipts">Receipts (‚Çπ)</label>
                      <input type="number" id="cflow-receipts" required min="0" step="0.01" placeholder="4200000">
                    </div>
                    <div class="form-group">
                      <label for="cflow-payments">Payments (‚Çπ)</label>
                      <input type="number" id="cflow-payments" required min="0" step="0.01" placeholder="3800000">
                    </div>
                    <div class="form-group">
                      <label for="cflow-owner">Owner</label>
                      <input type="text" id="cflow-owner" required placeholder="Finance Lead">
                    </div>
                    <div class="form-group">
                      <label for="cflow-status">Status</label>
                      <select id="cflow-status" class="form-select" required>
                        <option value="Balanced">Balanced</option>
                        <option value="Surplus">Surplus</option>
                        <option value="Deficit">Deficit</option>
                      </select>
                    </div>
                    <div style="display: flex; gap: 8px; align-items: flex-end;">
                      <button class="btn btn-primary" type="submit">Save</button>
                      <button class="btn btn-secondary" type="button" id="cflow-cancel" style="display: none;">Cancel</button>
                    </div>
                  </form>

                  <div class="table-container">
                    <table>
                      <thead>
                        <tr>
                          <th>Project</th>
                          <th>Month</th>
                          <th>Opening</th>
                          <th>Receipts</th>
                          <th>Payments</th>
                          <th>Closing</th>
                          <th>Status</th>
                          <th>Actions</th>
                        </tr>
                      </thead>
                      <tbody id="cflow-table-body"></tbody>
                    </table>
                  </div>

                  <div style="margin-top: 12px; display: flex; justify-content: space-between; align-items: center;">
                    <div style="display: flex; gap: 12px; font-size: 12px; color: var(--text-secondary);">
                      <span>Surplus: <strong id="cflow-surplus-count">0</strong></span>
                      <span>Balanced: <strong id="cflow-balanced-count">0</strong></span>
                      <span>Deficit: <strong id="cflow-deficit-count">0</strong></span>
                    </div>
                    <button class="btn btn-secondary" id="cflow-export" type="button">Export Cash Flow</button>
                  </div>
                </div>

                <div class="card" style="margin: 0;">
                  <h4 style="margin-bottom: 12px;">Working Capital</h4>
                  <div style="display: grid; gap: 12px;">
                    <div style="display: flex; justify-content: space-between;">
                      <span style="color: var(--text-secondary); font-size: 13px;">Total Receipts</span>
                      <strong id="cflow-total-receipts">‚Çπ0</strong>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                      <span style="color: var(--text-secondary); font-size: 13px;">Total Payments</span>
                      <strong id="cflow-total-payments">‚Çπ0</strong>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                      <span style="color: var(--text-secondary); font-size: 13px;">Net Movement</span>
                      <strong id="cflow-total-net">‚Çπ0</strong>
                    </div>
                  </div>

                  <div style="margin-top: 16px;" class="table-container">
                    <table>
                      <thead>
                        <tr>
                          <th>Project</th>
                          <th>Owner</th>
                          <th>Status</th>
                        </tr>
                      </thead>
                      <tbody id="cflow-summary-body"></tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Retention & Mobilization Tab -->
          <div id="retention" class="tab-content">
            <div style="padding-top: 20px;">
              <h3 style="margin-bottom: 16px;">Retention & Mobilization</h3>
              <p style="font-size: 13px; color: var(--text-secondary);">Track retention money, advances, and recoveries.</p>
              <div class="grid grid-2 mt-3" style="gap: 20px;">
                <div class="card" style="margin: 0;">
                  <div class="card-header">
                    <h4 class="card-title">Retention Ledger</h4>
                    <button class="btn btn-secondary" id="ret-add-new" type="button">+ New</button>
                  </div>

                  <form id="ret-form" class="form-grid" style="margin-bottom: 16px;">
                    <input type="hidden" id="ret-edit-index" value="">
                    <div class="form-group">
                      <label for="ret-contract">Contract</label>
                      <input type="text" id="ret-contract" required placeholder="CN-2026-041">
                    </div>
                    <div class="form-group">
                      <label for="ret-project">Project</label>
                      <select id="ret-project" class="form-select" required>
                        <option value="Apollo Towers">Apollo Towers</option>
                        <option value="Metro Plaza">Metro Plaza</option>
                        <option value="Riverfront Mall">Riverfront Mall</option>
                        <option value="Skyline Residency">Skyline Residency</option>
                      </select>
                    </div>
                    <div class="form-group">
                      <label for="ret-ra">RA Bill</label>
                      <input type="text" id="ret-ra" required placeholder="RA-2026-011">
                    </div>
                    <div class="form-group">
                      <label for="ret-amount">Retention Amount (‚Çπ)</label>
                      <input type="number" id="ret-amount" required min="0" step="0.01" placeholder="92500">
                    </div>
                    <div class="form-group">
                      <label for="ret-release">Release Date</label>
                      <input type="text" id="ret-release" required placeholder="Oct 01, 2026">
                    </div>
                    <div class="form-group">
                      <label for="ret-status">Status</label>
                      <select id="ret-status" class="form-select" required>
                        <option value="Held">Held</option>
                        <option value="Released">Released</option>
                        <option value="Pending">Pending</option>
                      </select>
                    </div>
                    <div style="display: flex; gap: 8px; align-items: flex-end;">
                      <button class="btn btn-primary" type="submit">Save</button>
                      <button class="btn btn-secondary" type="button" id="ret-cancel" style="display: none;">Cancel</button>
                    </div>
                  </form>

                  <div class="table-container">
                    <table>
                      <thead>
                        <tr>
                          <th>Contract</th>
                          <th>Project</th>
                          <th>RA Bill</th>
                          <th>Retention</th>
                          <th>Release</th>
                          <th>Status</th>
                          <th>Actions</th>
                        </tr>
                      </thead>
                      <tbody id="ret-table-body"></tbody>
                    </table>
                  </div>

                  <div style="margin-top: 12px; display: flex; justify-content: space-between; align-items: center;">
                    <div style="display: flex; gap: 12px; font-size: 12px; color: var(--text-secondary);">
                      <span>Held: <strong id="ret-held-count">0</strong></span>
                      <span>Pending: <strong id="ret-pending-count">0</strong></span>
                      <span>Released: <strong id="ret-released-count">0</strong></span>
                    </div>
                    <button class="btn btn-secondary" id="ret-export" type="button">Export Retention</button>
                  </div>
                </div>

                <div class="card" style="margin: 0;">
                  <div class="card-header">
                    <h4 class="card-title">Mobilization Advances</h4>
                    <button class="btn btn-secondary" id="mob-add-new" type="button">+ New</button>
                  </div>

                  <form id="mob-form" class="form-grid" style="margin-bottom: 16px;">
                    <input type="hidden" id="mob-edit-index" value="">
                    <div class="form-group">
                      <label for="mob-advance">Advance No</label>
                      <input type="text" id="mob-advance" required placeholder="ADV-2026-006">
                    </div>
                    <div class="form-group">
                      <label for="mob-project">Project</label>
                      <select id="mob-project" class="form-select" required>
                        <option value="Apollo Towers">Apollo Towers</option>
                        <option value="Metro Plaza">Metro Plaza</option>
                        <option value="Riverfront Mall">Riverfront Mall</option>
                        <option value="Skyline Residency">Skyline Residency</option>
                      </select>
                    </div>
                    <div class="form-group">
                      <label for="mob-vendor">Vendor</label>
                      <select id="mob-vendor" class="form-select" required>
                        <option value="BuildMate Services">BuildMate Services</option>
                        <option value="ABC Supplies">ABC Supplies</option>
                        <option value="BuildMart">BuildMart</option>
                        <option value="Prime Steel">Prime Steel</option>
                      </select>
                    </div>
                    <div class="form-group">
                      <label for="mob-amount">Advance Amount (‚Çπ)</label>
                      <input type="number" id="mob-amount" required min="0" step="0.01" placeholder="450000">
                    </div>
                    <div class="form-group">
                      <label for="mob-recovered">Recovered (‚Çπ)</label>
                      <input type="number" id="mob-recovered" required min="0" step="0.01" placeholder="150000">
                    </div>
                    <div class="form-group">
                      <label for="mob-method">Recovery Method</label>
                      <select id="mob-method" class="form-select" required>
                        <option value="Bill Deduction">Bill Deduction</option>
                        <option value="Milestone">Milestone</option>
                        <option value="Lumpsum">Lumpsum</option>
                      </select>
                    </div>
                    <div class="form-group">
                      <label for="mob-status">Status</label>
                      <select id="mob-status" class="form-select" required>
                        <option value="Active">Active</option>
                        <option value="Recovered">Recovered</option>
                        <option value="Overdue">Overdue</option>
                      </select>
                    </div>
                    <div style="display: flex; gap: 8px; align-items: flex-end;">
                      <button class="btn btn-primary" type="submit">Save</button>
                      <button class="btn btn-secondary" type="button" id="mob-cancel" style="display: none;">Cancel</button>
                    </div>
                  </form>

                  <div class="table-container">
                    <table>
                      <thead>
                        <tr>
                          <th>Advance</th>
                          <th>Project</th>
                          <th>Vendor</th>
                          <th>Advance</th>
                          <th>Recovered</th>
                          <th>Outstanding</th>
                          <th>Status</th>
                          <th>Actions</th>
                        </tr>
                      </thead>
                      <tbody id="mob-table-body"></tbody>
                    </table>
                  </div>

                  <div style="margin-top: 12px; display: flex; justify-content: space-between; align-items: center;">
                    <div style="display: flex; gap: 12px; font-size: 12px; color: var(--text-secondary);">
                      <span>Active: <strong id="mob-active-count">0</strong></span>
                      <span>Recovered: <strong id="mob-recovered-count">0</strong></span>
                      <span>Overdue: <strong id="mob-overdue-count">0</strong></span>
                    </div>
                    <button class="btn btn-secondary" id="mob-export" type="button">Export Advances</button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Certification & Approvals Tab -->
          <div id="certifications" class="tab-content">
            <div style="padding-top: 20px;">
              <h3 style="margin-bottom: 16px;">Certification & Approvals</h3>
              <p style="font-size: 13px; color: var(--text-secondary);">Manage certifications for bills, milestones, and compliance.</p>
              <div class="grid grid-2 mt-3" style="gap: 20px;">
                <div class="card" style="margin: 0;">
                  <div class="card-header">
                    <h4 class="card-title">Certification Register</h4>
                    <button class="btn btn-secondary" id="cert-add-new" type="button">+ New</button>
                  </div>

                  <form id="cert-form" class="form-grid" style="margin-bottom: 16px;">
                    <input type="hidden" id="cert-edit-index" value="">
                    <div class="form-group">
                      <label for="cert-ref">Reference</label>
                      <input type="text" id="cert-ref" required placeholder="CERT-2026-018">
                    </div>
                    <div class="form-group">
                      <label for="cert-project">Project</label>
                      <select id="cert-project" class="form-select" required>
                        <option value="Apollo Towers">Apollo Towers</option>
                        <option value="Metro Plaza">Metro Plaza</option>
                        <option value="Riverfront Mall">Riverfront Mall</option>
                        <option value="Skyline Residency">Skyline Residency</option>
                      </select>
                    </div>
                    <div class="form-group">
                      <label for="cert-type">Type</label>
                      <select id="cert-type" class="form-select" required>
                        <option value="RA Bill">RA Bill</option>
                        <option value="Milestone">Milestone</option>
                        <option value="Compliance">Compliance</option>
                      </select>
                    </div>
                    <div class="form-group">
                      <label for="cert-stage">Stage</label>
                      <select id="cert-stage" class="form-select" required>
                        <option value="Engineer">Engineer</option>
                        <option value="Consultant">Consultant</option>
                        <option value="Client">Client</option>
                      </select>
                    </div>
                    <div class="form-group">
                      <label for="cert-owner">Owner</label>
                      <input type="text" id="cert-owner" required placeholder="QS Lead">
                    </div>
                    <div class="form-group">
                      <label for="cert-date">Date</label>
                      <input type="text" id="cert-date" required placeholder="Feb 03, 2026">
                    </div>
                    <div class="form-group">
                      <label for="cert-status">Status</label>
                      <select id="cert-status" class="form-select" required>
                        <option value="Pending">Pending</option>
                        <option value="Approved">Approved</option>
                        <option value="Rejected">Rejected</option>
                      </select>
                    </div>
                    <div style="display: flex; gap: 8px; align-items: flex-end;">
                      <button class="btn btn-primary" type="submit">Save</button>
                      <button class="btn btn-secondary" type="button" id="cert-cancel" style="display: none;">Cancel</button>
                    </div>
                  </form>

                  <div class="table-container">
                    <table>
                      <thead>
                        <tr>
                          <th>Reference</th>
                          <th>Project</th>
                          <th>Type</th>
                          <th>Stage</th>
                          <th>Date</th>
                          <th>Status</th>
                          <th>Actions</th>
                        </tr>
                      </thead>
                      <tbody id="cert-table-body"></tbody>
                    </table>
                  </div>

                  <div style="margin-top: 12px; display: flex; justify-content: space-between; align-items: center;">
                    <div style="display: flex; gap: 12px; font-size: 12px; color: var(--text-secondary);">
                      <span>Pending: <strong id="cert-pending-count">0</strong></span>
                      <span>Approved: <strong id="cert-approved-count">0</strong></span>
                      <span>Rejected: <strong id="cert-rejected-count">0</strong></span>
                    </div>
                    <button class="btn btn-secondary" id="cert-export" type="button">Export Certifications</button>
                  </div>
                </div>

                <div class="card" style="margin: 0;">
                  <h4 style="margin-bottom: 12px;">Approval Trails</h4>
                  <div style="display: grid; gap: 12px;">
                    <div style="display: flex; justify-content: space-between;">
                      <span style="color: var(--text-secondary); font-size: 13px;">Engineer</span>
                      <strong id="cert-engineer-count">0</strong>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                      <span style="color: var(--text-secondary); font-size: 13px;">Consultant</span>
                      <strong id="cert-consultant-count">0</strong>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                      <span style="color: var(--text-secondary); font-size: 13px;">Client</span>
                      <strong id="cert-client-count">0</strong>
                    </div>
                  </div>

                  <div style="margin-top: 16px;" class="table-container">
                    <table>
                      <thead>
                        <tr>
                          <th>Reference</th>
                          <th>Stage</th>
                          <th>Status</th>
                          <th>Owner</th>
                        </tr>
                      </thead>
                      <tbody id="cert-summary-body"></tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <script src="logout.js"></script>
  <script src="ui-actions.js"></script>
  <script>
    function switchPlanningTab(event, tabName) {
      const tabContents = document.querySelectorAll('.tab-content');
      tabContents.forEach(content => content.classList.remove('active'));

      const sublinks = document.querySelectorAll('.nav-submenu .nav-sublink');
      sublinks.forEach(link => link.classList.remove('active'));

      document.getElementById(tabName).classList.add('active');
      event.target.classList.add('active');
      if (window.applyAllTableFilters) {
        window.applyAllTableFilters();
      }
    }

    const wbsItems = [
      { code: 'WBS-01', name: 'Site Preparation', level: 'L1', budget: 850000, owner: 'Planning Lead', status: 'Active' },
      { code: 'WBS-01.02', name: 'Foundation Works', level: 'L2', budget: 1200000, owner: 'Civil Lead', status: 'Active' },
      { code: 'WBS-02', name: 'Superstructure', level: 'L1', budget: 2200000, owner: 'Project Manager', status: 'Planned' },
      { code: 'WBS-03', name: 'MEP Systems', level: 'L1', budget: 1750000, owner: 'MEP Lead', status: 'Closed' }
    ];

    const workPackages = [
      { id: 'WP-2026-031', wbs: 'WBS-01.02', scope: 'Pile cap excavation', qty: 120, unit: 'Cum', budget: 350000, start: 'Feb 06, 2026', end: 'Feb 18, 2026', status: 'Active' },
      { id: 'WP-2026-032', wbs: 'WBS-01.02', scope: 'Rebar fixing', qty: 75, unit: 'Ton', budget: 480000, start: 'Feb 12, 2026', end: 'Feb 28, 2026', status: 'Planned' },
      { id: 'WP-2026-028', wbs: 'WBS-01', scope: 'Site fencing & signage', qty: 1, unit: 'Lot', budget: 150000, start: 'Jan 15, 2026', end: 'Jan 22, 2026', status: 'Completed' },
      { id: 'WP-2026-033', wbs: 'WBS-02', scope: 'Column shuttering', qty: 90, unit: 'Sets', budget: 520000, start: 'Feb 20, 2026', end: 'Mar 05, 2026', status: 'Planned' }
    ];

    const scheduleActivities = [
      { id: 'ACT-2026-040', task: 'Site Clearing', wbs: 'WBS-01', start: 'Feb 01, 2026', end: 'Feb 05, 2026', duration: 5, dependency: '-', owner: 'Planning Lead', progress: 100, status: 'Completed' },
      { id: 'ACT-2026-041', task: 'Foundation Excavation', wbs: 'WBS-01.02', start: 'Feb 06, 2026', end: 'Feb 18, 2026', duration: 12, dependency: 'ACT-2026-040', owner: 'Civil Lead', progress: 35, status: 'In Progress' },
      { id: 'ACT-2026-042', task: 'Rebar Fixing', wbs: 'WBS-01.02', start: 'Feb 12, 2026', end: 'Feb 28, 2026', duration: 16, dependency: 'ACT-2026-041', owner: 'Site Engineer', progress: 10, status: 'Planned' },
      { id: 'ACT-2026-043', task: 'Column Shuttering', wbs: 'WBS-02', start: 'Feb 20, 2026', end: 'Mar 05, 2026', duration: 14, dependency: 'ACT-2026-042', owner: 'Formwork Lead', progress: 0, status: 'Delayed' }
    ];

    const boqItems = [
      { item: 'Cement (OPC 53)', category: 'Raw Materials', qty: 250, uom: 'Bags', rate: 450, waste: 2, status: 'Approved' },
      { item: 'TMT Steel Bars', category: 'Raw Materials', qty: 18, uom: 'Tons', rate: 48500, waste: 1, status: 'Reviewed' },
      { item: 'Formwork Shuttering', category: 'Services', qty: 90, uom: 'Sets', rate: 1200, waste: 0, status: 'Draft' },
      { item: 'Excavation', category: 'Services', qty: 300, uom: 'Cum', rate: 220, waste: 3, status: 'Approved' }
    ];

    const estimateVersions = [
      { version: 'EST-2026-V3', project: 'Apollo Towers', prepared: 'QS Lead', date: 'Feb 03, 2026', base: 6200000, contingency: 5, status: 'Draft' },
      { version: 'EST-2026-V2', project: 'Metro Plaza', prepared: 'QS Lead', date: 'Jan 20, 2026', base: 5800000, contingency: 4, status: 'Submitted' },
      { version: 'EST-2026-V1', project: 'Apollo Towers', prepared: 'Commercial', date: 'Jan 05, 2026', base: 5400000, contingency: 3, status: 'Approved' }
    ];

    const measurementSheets = [
      { sheet: 'MS-2026-018', project: 'Apollo Towers', work: 'Rebar Fixing', qty: 75, uom: 'Ton', rate: 48500, date: 'Feb 03, 2026', status: 'Submitted' },
      { sheet: 'MS-2026-017', project: 'Metro Plaza', work: 'Excavation', qty: 300, uom: 'Cum', rate: 220, date: 'Feb 01, 2026', status: 'Certified' },
      { sheet: 'MS-2026-016', project: 'Apollo Towers', work: 'Formwork Shuttering', qty: 90, uom: 'Sets', rate: 1200, date: 'Jan 28, 2026', status: 'Draft' },
      { sheet: 'MS-2026-015', project: 'Green Valley', work: 'Concreting', qty: 110, uom: 'Cum', rate: 3200, date: 'Jan 25, 2026', status: 'Certified' }
    ];

    const raBills = [
      { bill: 'RA-2026-011', project: 'Apollo Towers', period: 'Jan 2026', gross: 1850000, deductions: 120000, retention: 5, status: 'Under Review' },
      { bill: 'RA-2026-010', project: 'Metro Plaza', period: 'Jan 2026', gross: 1420000, deductions: 80000, retention: 5, status: 'Approved' },
      { bill: 'RA-2026-009', project: 'Green Valley', period: 'Dec 2025', gross: 980000, deductions: 45000, retention: 5, status: 'Paid' },
      { bill: 'RA-2026-008', project: 'Apollo Towers', period: 'Dec 2025', gross: 1250000, deductions: 95000, retention: 5, status: 'Submitted' }
    ];

    const changeOrders = [
      { no: 'CO-2026-014', project: 'Apollo Towers', category: 'Scope Change', description: 'Add basement waterproofing', cost: 275000, days: 5, raised: 'Feb 02, 2026', owner: 'Planning Lead', status: 'Submitted' },
      { no: 'CO-2026-013', project: 'Metro Plaza', category: 'Design Revision', description: 'Facade glazing update', cost: 420000, days: 8, raised: 'Jan 28, 2026', owner: 'Project Manager', status: 'Approved' },
      { no: 'CO-2026-012', project: 'Green Valley', category: 'Client Request', description: 'Additional landscaping', cost: 150000, days: 3, raised: 'Jan 22, 2026', owner: 'QS Lead', status: 'Draft' },
      { no: 'CO-2026-011', project: 'Apollo Towers', category: 'Material Change', description: 'Switch to higher grade steel', cost: 310000, days: 0, raised: 'Jan 18, 2026', owner: 'Procurement', status: 'Rejected' }
    ];

    const contractManagementData = [
      { no: 'CN-2026-041', client: 'Apollo Infra', project: 'Apollo Towers', value: 18500000, start: 'Jan 01, 2026', end: 'Dec 31, 2026', retention: 5, ld: 1, owner: 'Contracts Lead', status: 'Active' },
      { no: 'CN-2026-040', client: 'Metro City Dev', project: 'Metro Plaza', value: 14200000, start: 'Feb 01, 2026', end: 'Jan 31, 2027', retention: 5, ld: 1.5, owner: 'Commercial', status: 'Pending' },
      { no: 'CN-2025-118', client: 'Green Valley Holdings', project: 'Green Valley', value: 9800000, start: 'Jul 01, 2025', end: 'Dec 31, 2025', retention: 3, ld: 1, owner: 'Contracts Lead', status: 'Closed' },
      { no: 'CN-2026-039', client: 'River Bridge Corp', project: 'River Bridge', value: 11200000, start: 'Jan 15, 2026', end: 'Dec 15, 2026', retention: 4, ld: 1, owner: 'Project Manager', status: 'Active' }
    ];

    const attendanceRecords = [
      { date: 'Feb 03, 2026', site: 'Apollo Towers', worker: 'Ravi Kumar', role: 'Mason', hours: 8, overtime: 2, status: 'Present' },
      { date: 'Feb 03, 2026', site: 'Apollo Towers', worker: 'Sandeep Yadav', role: 'Electrician', hours: 8, overtime: 0, status: 'Present' },
      { date: 'Feb 03, 2026', site: 'Metro Plaza', worker: 'Amit Sharma', role: 'Carpenter', hours: 0, overtime: 0, status: 'Absent' },
      { date: 'Feb 03, 2026', site: 'Green Valley', worker: 'Vijay Singh', role: 'Plumber', hours: 0, overtime: 0, status: 'On Leave' }
    ];

    const overtimeApprovals = [
      { worker: 'Ravi Kumar', site: 'Apollo Towers', date: 'Feb 03, 2026', hours: 2, rate: 120, approver: 'Site Manager', status: 'Approved' },
      { worker: 'Sandeep Yadav', site: 'Apollo Towers', date: 'Feb 03, 2026', hours: 1.5, rate: 110, approver: 'Site Manager', status: 'Pending' },
      { worker: 'Vijay Singh', site: 'Green Valley', date: 'Feb 02, 2026', hours: 2, rate: 130, approver: 'Supervisor', status: 'Rejected' },
      { worker: 'Amit Sharma', site: 'Metro Plaza', date: 'Feb 01, 2026', hours: 1, rate: 115, approver: 'Site Engineer', status: 'Approved' }
    ];

    const subcontractorBills = [
      { bill: 'SB-2026-015', wo: 'WO-2026-042', name: 'BuildMate Services', scope: 'Masonry Works', qty: 120, rate: 850, retention: 5, deduction: 25000, status: 'Submitted' },
      { bill: 'SB-2026-014', wo: 'WO-2026-043', name: 'PrimeBuild Co', scope: 'Electrical & MEP', qty: 65, rate: 1200, retention: 5, deduction: 15000, status: 'Certified' },
      { bill: 'SB-2026-013', wo: 'WO-2026-041', name: 'GroundWorks Ltd', scope: 'Excavation', qty: 180, rate: 700, retention: 5, deduction: 12000, status: 'Paid' },
      { bill: 'SB-2026-012', wo: 'WO-2026-044', name: 'Skyline Interiors', scope: 'Finishing Works', qty: 40, rate: 1500, retention: 5, deduction: 18000, status: 'Submitted' }
    ];

    const eacForecasts = [
      { project: 'Apollo Towers', budget: 18500000, actual: 6200000, etc: 9800000, period: 'Feb 2026', status: 'On Track' },
      { project: 'Metro Plaza', budget: 14200000, actual: 5900000, etc: 9100000, period: 'Feb 2026', status: 'At Risk' },
      { project: 'Green Valley', budget: 9800000, actual: 7200000, etc: 3300000, period: 'Feb 2026', status: 'Over Budget' },
      { project: 'River Bridge', budget: 11200000, actual: 4100000, etc: 6800000, period: 'Feb 2026', status: 'On Track' }
    ];

    const cashForecasts = [
      { project: 'Apollo Towers', month: 'Feb 2026', inflow: 4200000, outflow: 3800000, owner: 'Finance Lead', status: 'Surplus' },
      { project: 'Metro Plaza', month: 'Feb 2026', inflow: 3200000, outflow: 3400000, owner: 'Finance Lead', status: 'Deficit' },
      { project: 'Green Valley', month: 'Feb 2026', inflow: 2100000, outflow: 2100000, owner: 'QS Lead', status: 'Balanced' },
      { project: 'River Bridge', month: 'Feb 2026', inflow: 2900000, outflow: 2500000, owner: 'Finance Lead', status: 'Surplus' }
    ];

    const cashFlowPlans = [
      { project: 'Apollo Towers', month: 'Mar 2026', opening: 1200000, receipts: 4200000, payments: 3800000, owner: 'Finance Lead', status: 'Surplus' },
      { project: 'Metro Plaza', month: 'Mar 2026', opening: 900000, receipts: 2800000, payments: 3200000, owner: 'Finance Lead', status: 'Deficit' },
      { project: 'Green Valley', month: 'Mar 2026', opening: 600000, receipts: 1800000, payments: 1800000, owner: 'QS Lead', status: 'Balanced' },
      { project: 'River Bridge', month: 'Mar 2026', opening: 750000, receipts: 2400000, payments: 2100000, owner: 'Finance Lead', status: 'Surplus' }
    ];

    const retentionLedger = [
      { contract: 'CN-2026-041', project: 'Apollo Towers', ra: 'RA-2026-011', amount: 92500, release: 'Oct 01, 2026', status: 'Held' },
      { contract: 'CN-2026-039', project: 'River Bridge', ra: 'RA-2026-010', amount: 71000, release: 'Sep 15, 2026', status: 'Pending' },
      { contract: 'CN-2025-118', project: 'Green Valley', ra: 'RA-2026-009', amount: 52000, release: 'Jan 20, 2026', status: 'Released' },
      { contract: 'CN-2026-040', project: 'Metro Plaza', ra: 'RA-2026-008', amount: 65000, release: 'Nov 01, 2026', status: 'Held' }
    ];

    const mobilizationAdvances = [
      { advance: 'ADV-2026-006', project: 'Apollo Towers', vendor: 'BuildMate Services', amount: 450000, recovered: 150000, method: 'Bill Deduction', status: 'Active' },
      { advance: 'ADV-2026-005', project: 'Metro Plaza', vendor: 'PrimeBuild Co', amount: 350000, recovered: 350000, method: 'Milestone', status: 'Recovered' },
      { advance: 'ADV-2026-004', project: 'Green Valley', vendor: 'GroundWorks Ltd', amount: 300000, recovered: 120000, method: 'Bill Deduction', status: 'Overdue' },
      { advance: 'ADV-2026-003', project: 'River Bridge', vendor: 'Skyline Interiors', amount: 280000, recovered: 90000, method: 'Lumpsum', status: 'Active' }
    ];

    const certificationApprovals = [
      { ref: 'CERT-2026-018', project: 'Apollo Towers', type: 'RA Bill', stage: 'Engineer', owner: 'QS Lead', date: 'Feb 03, 2026', status: 'Pending' },
      { ref: 'CERT-2026-017', project: 'Metro Plaza', type: 'Milestone', stage: 'Consultant', owner: 'Project Manager', date: 'Feb 01, 2026', status: 'Approved' },
      { ref: 'CERT-2026-016', project: 'Green Valley', type: 'Compliance', stage: 'Client', owner: 'Compliance', date: 'Jan 29, 2026', status: 'Rejected' },
      { ref: 'CERT-2026-015', project: 'River Bridge', type: 'RA Bill', stage: 'Engineer', owner: 'QS Lead', date: 'Jan 27, 2026', status: 'Approved' }
    ];

    const initWBSWorkPackages = () => {
      const wbsBody = document.getElementById('wbs-table-body');
      const wbsForm = document.getElementById('wbs-form');
      const wbsEditIndex = document.getElementById('wbs-edit-index');
      const wbsCancel = document.getElementById('wbs-cancel');
      const wbsAddNew = document.getElementById('wbs-add-new');
      const wbsExport = document.getElementById('wbs-export');

      const wpBody = document.getElementById('wp-table-body');
      const wpSummaryBody = document.getElementById('wp-summary-body');
      const wpForm = document.getElementById('wp-form');
      const wpEditIndex = document.getElementById('wp-edit-index');
      const wpCancel = document.getElementById('wp-cancel');
      const wpAddNew = document.getElementById('wp-add-new');
      const wpExport = document.getElementById('wp-export');

      if (!wbsBody || !wbsForm || !wpBody || !wpForm) {
        return;
      }

      const wbsActiveEl = document.getElementById('wbs-active-count');
      const wbsPlannedEl = document.getElementById('wbs-planned-count');
      const wbsClosedEl = document.getElementById('wbs-closed-count');

      const wpActiveEl = document.getElementById('wp-active-count');
      const wpPlannedEl = document.getElementById('wp-planned-count');
      const wpCompletedEl = document.getElementById('wp-completed-count');

      const updateWbsSummary = () => {
        const activeCount = wbsItems.filter((row) => row.status === 'Active').length;
        const plannedCount = wbsItems.filter((row) => row.status === 'Planned').length;
        const closedCount = wbsItems.filter((row) => row.status === 'Closed').length;

        if (wbsActiveEl) wbsActiveEl.textContent = activeCount.toString();
        if (wbsPlannedEl) wbsPlannedEl.textContent = plannedCount.toString();
        if (wbsClosedEl) wbsClosedEl.textContent = closedCount.toString();
      };

      const updateWpSummary = () => {
        const activeCount = workPackages.filter((row) => row.status === 'Active').length;
        const plannedCount = workPackages.filter((row) => row.status === 'Planned').length;
        const completedCount = workPackages.filter((row) => row.status === 'Completed').length;

        if (wpActiveEl) wpActiveEl.textContent = activeCount.toString();
        if (wpPlannedEl) wpPlannedEl.textContent = plannedCount.toString();
        if (wpCompletedEl) wpCompletedEl.textContent = completedCount.toString();
      };

      const renderWbs = () => {
        wbsBody.innerHTML = wbsItems.map((row, index) => `
          <tr>
            <td>${row.code}</td>
            <td>${row.name}</td>
            <td>${row.level}</td>
            <td>‚Çπ${row.budget.toLocaleString('en-IN')}</td>
            <td>${row.owner}</td>
            <td><span class="badge ${row.status === 'Active' ? 'badge-success' : row.status === 'Planned' ? 'badge-warning' : 'badge-danger'}">${row.status}</span></td>
            <td>
              <button class="btn btn-secondary btn-icon" style="padding: 6px;" data-row-action="edit" data-row-index="${index}">üìù</button>
              <button class="btn btn-secondary btn-icon" style="padding: 6px;" data-row-action="delete" data-row-index="${index}">üóëÔ∏è</button>
            </td>
          </tr>
        `).join('') || '<tr><td colspan="7" style="text-align:center; padding: 16px;">No WBS items found.</td></tr>';

        updateWbsSummary();
      };

      const renderWp = () => {
        wpBody.innerHTML = workPackages.map((row, index) => `
          <tr>
            <td>${row.id}</td>
            <td>${row.wbs}</td>
            <td>${row.scope}</td>
            <td>${row.qty}</td>
            <td>${row.unit}</td>
            <td>‚Çπ${row.budget.toLocaleString('en-IN')}</td>
            <td><span class="badge ${row.status === 'Completed' ? 'badge-success' : row.status === 'Planned' ? 'badge-warning' : 'badge-info'}">${row.status}</span></td>
            <td>
              <button class="btn btn-secondary btn-icon" style="padding: 6px;" data-row-action="edit" data-row-index="${index}">üìù</button>
              <button class="btn btn-secondary btn-icon" style="padding: 6px;" data-row-action="delete" data-row-index="${index}">üóëÔ∏è</button>
            </td>
          </tr>
        `).join('') || '<tr><td colspan="8" style="text-align:center; padding: 16px;">No work packages found.</td></tr>';

        if (wpSummaryBody) {
          wpSummaryBody.innerHTML = workPackages.map((row) => `
            <tr>
              <td>${row.id}</td>
              <td><span class="badge ${row.status === 'Completed' ? 'badge-success' : row.status === 'Planned' ? 'badge-warning' : 'badge-info'}">${row.status}</span></td>
              <td>‚Çπ${row.budget.toLocaleString('en-IN')}</td>
            </tr>
          `).join('') || '<tr><td colspan="3" style="text-align:center; padding: 16px;">No summary available.</td></tr>';
        }

        updateWpSummary();
      };

      const resetWbsForm = () => {
        wbsForm.reset();
        wbsEditIndex.value = '';
        wbsCancel.style.display = 'none';
      };

      const resetWpForm = () => {
        wpForm.reset();
        wpEditIndex.value = '';
        wpCancel.style.display = 'none';
      };

      wbsForm.addEventListener('submit', (event) => {
        event.preventDefault();
        const row = {
          code: document.getElementById('wbs-code').value.trim(),
          name: document.getElementById('wbs-name').value.trim(),
          level: document.getElementById('wbs-level').value,
          budget: parseFloat(document.getElementById('wbs-budget').value || '0'),
          owner: document.getElementById('wbs-owner').value.trim(),
          status: document.getElementById('wbs-status').value
        };

        if (wbsEditIndex.value !== '') {
          wbsItems[parseInt(wbsEditIndex.value, 10)] = row;
        } else {
          wbsItems.unshift(row);
        }

        renderWbs();
        resetWbsForm();
      });

      wbsCancel.addEventListener('click', resetWbsForm);
      wbsAddNew.addEventListener('click', resetWbsForm);

      wbsBody.addEventListener('click', (event) => {
        const actionButton = event.target.closest('button[data-row-action]');
        if (!actionButton) return;
        const index = parseInt(actionButton.dataset.rowIndex, 10);
        const action = actionButton.dataset.rowAction;
        const row = wbsItems[index];
        if (!row) return;

        if (action === 'edit') {
          wbsEditIndex.value = index.toString();
          document.getElementById('wbs-code').value = row.code;
          document.getElementById('wbs-name').value = row.name;
          document.getElementById('wbs-level').value = row.level;
          document.getElementById('wbs-budget').value = row.budget;
          document.getElementById('wbs-owner').value = row.owner;
          document.getElementById('wbs-status').value = row.status;
          wbsCancel.style.display = 'inline-flex';
        }

        if (action === 'delete') {
          if (!confirm('Delete this WBS item?')) return;
          wbsItems.splice(index, 1);
          renderWbs();
        }
      });

      wpForm.addEventListener('submit', (event) => {
        event.preventDefault();
        const row = {
          id: document.getElementById('wp-id').value.trim(),
          wbs: document.getElementById('wp-wbs').value.trim(),
          scope: document.getElementById('wp-scope').value.trim(),
          qty: parseFloat(document.getElementById('wp-qty').value || '0'),
          unit: document.getElementById('wp-unit').value.trim(),
          budget: parseFloat(document.getElementById('wp-budget').value || '0'),
          start: document.getElementById('wp-start').value.trim(),
          end: document.getElementById('wp-end').value.trim(),
          status: document.getElementById('wp-status').value
        };

        if (wpEditIndex.value !== '') {
          workPackages[parseInt(wpEditIndex.value, 10)] = row;
        } else {
          workPackages.unshift(row);
        }

        renderWp();
        resetWpForm();
      });

      wpCancel.addEventListener('click', resetWpForm);
      wpAddNew.addEventListener('click', resetWpForm);

      wpBody.addEventListener('click', (event) => {
        const actionButton = event.target.closest('button[data-row-action]');
        if (!actionButton) return;
        const index = parseInt(actionButton.dataset.rowIndex, 10);
        const action = actionButton.dataset.rowAction;
        const row = workPackages[index];
        if (!row) return;

        if (action === 'edit') {
          wpEditIndex.value = index.toString();
          document.getElementById('wp-id').value = row.id;
          document.getElementById('wp-wbs').value = row.wbs;
          document.getElementById('wp-scope').value = row.scope;
          document.getElementById('wp-qty').value = row.qty;
          document.getElementById('wp-unit').value = row.unit;
          document.getElementById('wp-budget').value = row.budget;
          document.getElementById('wp-start').value = row.start;
          document.getElementById('wp-end').value = row.end;
          document.getElementById('wp-status').value = row.status;
          wpCancel.style.display = 'inline-flex';
        }

        if (action === 'delete') {
          if (!confirm('Delete this work package?')) return;
          workPackages.splice(index, 1);
          renderWp();
        }
      });

      wbsExport.addEventListener('click', () => {
        const header = ['WBS Code', 'Deliverable', 'Level', 'Budget', 'Owner', 'Status'];
        const rows = wbsItems.map((row) => [row.code, row.name, row.level, row.budget, row.owner, row.status]);
        const csvContent = [header, ...rows].map(row => row.map(value => `"${value}"`).join(',')).join('\n');
        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = 'wbs-items.csv';
        link.click();
        URL.revokeObjectURL(url);
      });

      wpExport.addEventListener('click', () => {
        const header = ['Package', 'WBS', 'Scope', 'Qty', 'Unit', 'Budget', 'Start', 'End', 'Status'];
        const rows = workPackages.map((row) => [row.id, row.wbs, row.scope, row.qty, row.unit, row.budget, row.start, row.end, row.status]);
        const csvContent = [header, ...rows].map(row => row.map(value => `"${value}"`).join(',')).join('\n');
        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = 'work-packages.csv';
        link.click();
        URL.revokeObjectURL(url);
      });

      renderWbs();
      renderWp();
    };

    const initSchedulingGantt = () => {
      const tbody = document.getElementById('schedule-table-body');
      const summaryBody = document.getElementById('schedule-summary-body');
      const form = document.getElementById('schedule-form');
      const editIndex = document.getElementById('schedule-edit-index');
      const cancel = document.getElementById('schedule-cancel');
      const addNew = document.getElementById('schedule-add-new');
      const exportBtn = document.getElementById('schedule-export');

      if (!tbody || !form) {
        return;
      }

      const plannedCountEl = document.getElementById('schedule-planned-count');
      const inProgressCountEl = document.getElementById('schedule-progress-count');
      const delayedCountEl = document.getElementById('schedule-delayed-count');

      const updateSummary = () => {
        const plannedCount = scheduleActivities.filter((row) => row.status === 'Planned').length;
        const progressCount = scheduleActivities.filter((row) => row.status === 'In Progress').length;
        const delayedCount = scheduleActivities.filter((row) => row.status === 'Delayed').length;

        if (plannedCountEl) plannedCountEl.textContent = plannedCount.toString();
        if (inProgressCountEl) inProgressCountEl.textContent = progressCount.toString();
        if (delayedCountEl) delayedCountEl.textContent = delayedCount.toString();
      };

      const render = () => {
        tbody.innerHTML = scheduleActivities.map((row, index) => `
          <tr>
            <td>${row.id}</td>
            <td>${row.task}</td>
            <td>${row.wbs}</td>
            <td>${row.start}</td>
            <td>${row.end}</td>
            <td>${row.duration}</td>
            <td>${row.dependency}</td>
            <td>${row.progress}%</td>
            <td><span class="badge ${row.status === 'Completed' ? 'badge-success' : row.status === 'In Progress' ? 'badge-info' : row.status === 'Delayed' ? 'badge-danger' : 'badge-warning'}">${row.status}</span></td>
            <td>
              <button class="btn btn-secondary btn-icon" style="padding: 6px;" data-row-action="edit" data-row-index="${index}">üìù</button>
              <button class="btn btn-secondary btn-icon" style="padding: 6px;" data-row-action="delete" data-row-index="${index}">üóëÔ∏è</button>
            </td>
          </tr>
        `).join('') || '<tr><td colspan="10" style="text-align:center; padding: 16px;">No schedule activities found.</td></tr>';

        if (summaryBody) {
          summaryBody.innerHTML = scheduleActivities.map((row) => `
            <tr>
              <td>${row.id}</td>
              <td>${row.owner}</td>
              <td><span class="badge ${row.status === 'Completed' ? 'badge-success' : row.status === 'In Progress' ? 'badge-info' : row.status === 'Delayed' ? 'badge-danger' : 'badge-warning'}">${row.status}</span></td>
            </tr>
          `).join('') || '<tr><td colspan="3" style="text-align:center; padding: 16px;">No summary available.</td></tr>';
        }

        updateSummary();
      };

      const resetForm = () => {
        form.reset();
        editIndex.value = '';
        cancel.style.display = 'none';
      };

      form.addEventListener('submit', (event) => {
        event.preventDefault();
        const row = {
          id: document.getElementById('schedule-id').value.trim(),
          task: document.getElementById('schedule-task').value.trim(),
          wbs: document.getElementById('schedule-wbs').value.trim(),
          start: document.getElementById('schedule-start').value.trim(),
          end: document.getElementById('schedule-end').value.trim(),
          duration: parseFloat(document.getElementById('schedule-duration').value || '0'),
          dependency: document.getElementById('schedule-dependency').value.trim(),
          owner: document.getElementById('schedule-owner').value.trim(),
          progress: parseFloat(document.getElementById('schedule-progress').value || '0'),
          status: document.getElementById('schedule-status').value
        };

        if (editIndex.value !== '') {
          scheduleActivities[parseInt(editIndex.value, 10)] = row;
        } else {
          scheduleActivities.unshift(row);
        }

        render();
        resetForm();
      });

      cancel.addEventListener('click', resetForm);
      addNew.addEventListener('click', resetForm);

      tbody.addEventListener('click', (event) => {
        const actionButton = event.target.closest('button[data-row-action]');
        if (!actionButton) return;
        const index = parseInt(actionButton.dataset.rowIndex, 10);
        const action = actionButton.dataset.rowAction;
        const row = scheduleActivities[index];
        if (!row) return;

        if (action === 'edit') {
          editIndex.value = index.toString();
          document.getElementById('schedule-id').value = row.id;
          document.getElementById('schedule-task').value = row.task;
          document.getElementById('schedule-wbs').value = row.wbs;
          document.getElementById('schedule-start').value = row.start;
          document.getElementById('schedule-end').value = row.end;
          document.getElementById('schedule-duration').value = row.duration;
          document.getElementById('schedule-dependency').value = row.dependency;
          document.getElementById('schedule-owner').value = row.owner;
          document.getElementById('schedule-progress').value = row.progress;
          document.getElementById('schedule-status').value = row.status;
          cancel.style.display = 'inline-flex';
        }

        if (action === 'delete') {
          if (!confirm('Delete this activity?')) return;
          scheduleActivities.splice(index, 1);
          render();
        }
      });

      exportBtn.addEventListener('click', () => {
        const header = ['Activity', 'Task', 'WBS', 'Start', 'End', 'Duration', 'Dependency', 'Owner', 'Progress', 'Status'];
        const rows = scheduleActivities.map((row) => [row.id, row.task, row.wbs, row.start, row.end, row.duration, row.dependency, row.owner, row.progress, row.status]);
        const csvContent = [header, ...rows].map(row => row.map(value => `"${value}"`).join(',')).join('\n');
        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = 'schedule-activities.csv';
        link.click();
        URL.revokeObjectURL(url);
      });

      render();
    };

    const initCostEstimationBoq = () => {
      const boqBody = document.getElementById('boq-table-body');
      const boqForm = document.getElementById('boq-form');
      const boqEditIndex = document.getElementById('boq-edit-index');
      const boqCancel = document.getElementById('boq-cancel');
      const boqAddNew = document.getElementById('boq-add-new');
      const boqExport = document.getElementById('boq-export');

      const estBody = document.getElementById('est-table-body');
      const estForm = document.getElementById('est-form');
      const estEditIndex = document.getElementById('est-edit-index');
      const estCancel = document.getElementById('est-cancel');
      const estAddNew = document.getElementById('est-add-new');
      const estExport = document.getElementById('est-export');

      const costLibBody = document.getElementById('cost-lib-body');

      if (!boqBody || !boqForm || !estBody || !estForm) {
        return;
      }

      const boqItemCountEl = document.getElementById('boq-item-count');
      const boqTotalCostEl = document.getElementById('boq-total-cost');
      const boqApprovedCountEl = document.getElementById('boq-approved-count');

      const estDraftCountEl = document.getElementById('est-draft-count');
      const estSubmittedCountEl = document.getElementById('est-submitted-count');
      const estApprovedCountEl = document.getElementById('est-approved-count');

      const boqTotal = (row) => row.qty * row.rate * (1 + (row.waste / 100));
      const estTotal = (row) => row.base * (1 + (row.contingency / 100));

      const updateSummary = () => {
        const totalItems = boqItems.length;
        const totalCost = boqItems.reduce((sum, row) => sum + boqTotal(row), 0);
        const approvedCount = boqItems.filter((row) => row.status === 'Approved').length;

        if (boqItemCountEl) boqItemCountEl.textContent = totalItems.toString();
        if (boqTotalCostEl) boqTotalCostEl.textContent = `‚Çπ${totalCost.toLocaleString('en-IN')}`;
        if (boqApprovedCountEl) boqApprovedCountEl.textContent = approvedCount.toString();

        const draftCount = estimateVersions.filter((row) => row.status === 'Draft').length;
        const submittedCount = estimateVersions.filter((row) => row.status === 'Submitted').length;
        const approvedCountEst = estimateVersions.filter((row) => row.status === 'Approved').length;

        if (estDraftCountEl) estDraftCountEl.textContent = draftCount.toString();
        if (estSubmittedCountEl) estSubmittedCountEl.textContent = submittedCount.toString();
        if (estApprovedCountEl) estApprovedCountEl.textContent = approvedCountEst.toString();
      };

      const renderCostLibrary = () => {
        if (!costLibBody) return;
        const grouped = boqItems.reduce((acc, row) => {
          if (!acc[row.category]) {
            acc[row.category] = { totalRate: 0, count: 0 };
          }
          acc[row.category].totalRate += row.rate;
          acc[row.category].count += 1;
          return acc;
        }, {});

        costLibBody.innerHTML = Object.entries(grouped).map(([category, data]) => {
          const avgRate = data.totalRate / data.count;
          return `
            <tr>
              <td>${category}</td>
              <td>‚Çπ${avgRate.toLocaleString('en-IN')}</td>
              <td>${data.count}</td>
              <td>Feb 03, 2026</td>
            </tr>
          `;
        }).join('') || '<tr><td colspan="4" style="text-align:center; padding: 16px;">No library data.</td></tr>';
      };

      const renderBoq = () => {
        boqBody.innerHTML = boqItems.map((row, index) => `
          <tr>
            <td>${row.item}</td>
            <td>${row.category}</td>
            <td>${row.qty}</td>
            <td>${row.uom}</td>
            <td>‚Çπ${row.rate.toLocaleString('en-IN')}</td>
            <td>${row.waste}%</td>
            <td>‚Çπ${boqTotal(row).toLocaleString('en-IN')}</td>
            <td><span class="badge ${row.status === 'Approved' ? 'badge-success' : row.status === 'Reviewed' ? 'badge-warning' : 'badge-info'}">${row.status}</span></td>
            <td>
              <button class="btn btn-secondary btn-icon" style="padding: 6px;" data-row-action="edit" data-row-index="${index}">üìù</button>
              <button class="btn btn-secondary btn-icon" style="padding: 6px;" data-row-action="delete" data-row-index="${index}">üóëÔ∏è</button>
            </td>
          </tr>
        `).join('') || '<tr><td colspan="9" style="text-align:center; padding: 16px;">No BOQ items found.</td></tr>';

        renderCostLibrary();
        updateSummary();
      };

      const renderEstimates = () => {
        estBody.innerHTML = estimateVersions.map((row, index) => `
          <tr>
            <td>${row.version}</td>
            <td>${row.project}</td>
            <td>${row.prepared}</td>
            <td>${row.date}</td>
            <td>‚Çπ${row.base.toLocaleString('en-IN')}</td>
            <td>${row.contingency}%</td>
            <td>‚Çπ${estTotal(row).toLocaleString('en-IN')}</td>
            <td><span class="badge ${row.status === 'Approved' ? 'badge-success' : row.status === 'Submitted' ? 'badge-warning' : 'badge-info'}">${row.status}</span></td>
            <td>
              <button class="btn btn-secondary btn-icon" style="padding: 6px;" data-row-action="edit" data-row-index="${index}">üìù</button>
              <button class="btn btn-secondary btn-icon" style="padding: 6px;" data-row-action="delete" data-row-index="${index}">üóëÔ∏è</button>
            </td>
          </tr>
        `).join('') || '<tr><td colspan="9" style="text-align:center; padding: 16px;">No estimates found.</td></tr>';

        updateSummary();
      };

      const resetBoqForm = () => {
        boqForm.reset();
        boqEditIndex.value = '';
        boqCancel.style.display = 'none';
      };

      const resetEstForm = () => {
        estForm.reset();
        estEditIndex.value = '';
        estCancel.style.display = 'none';
      };

      boqForm.addEventListener('submit', (event) => {
        event.preventDefault();
        const row = {
          item: document.getElementById('boq-item').value.trim(),
          category: document.getElementById('boq-category').value.trim(),
          qty: parseFloat(document.getElementById('boq-qty').value || '0'),
          uom: document.getElementById('boq-uom').value.trim(),
          rate: parseFloat(document.getElementById('boq-rate').value || '0'),
          waste: parseFloat(document.getElementById('boq-waste').value || '0'),
          status: document.getElementById('boq-status').value
        };

        if (boqEditIndex.value !== '') {
          boqItems[parseInt(boqEditIndex.value, 10)] = row;
        } else {
          boqItems.unshift(row);
        }

        renderBoq();
        resetBoqForm();
      });

      boqCancel.addEventListener('click', resetBoqForm);
      boqAddNew.addEventListener('click', resetBoqForm);

      boqBody.addEventListener('click', (event) => {
        const actionButton = event.target.closest('button[data-row-action]');
        if (!actionButton) return;
        const index = parseInt(actionButton.dataset.rowIndex, 10);
        const action = actionButton.dataset.rowAction;
        const row = boqItems[index];
        if (!row) return;

        if (action === 'edit') {
          boqEditIndex.value = index.toString();
          document.getElementById('boq-item').value = row.item;
          document.getElementById('boq-category').value = row.category;
          document.getElementById('boq-qty').value = row.qty;
          document.getElementById('boq-uom').value = row.uom;
          document.getElementById('boq-rate').value = row.rate;
          document.getElementById('boq-waste').value = row.waste;
          document.getElementById('boq-status').value = row.status;
          boqCancel.style.display = 'inline-flex';
        }

        if (action === 'delete') {
          if (!confirm('Delete this BOQ item?')) return;
          boqItems.splice(index, 1);
          renderBoq();
        }
      });

      estForm.addEventListener('submit', (event) => {
        event.preventDefault();
        const row = {
          version: document.getElementById('est-version').value.trim(),
          project: document.getElementById('est-project').value.trim(),
          prepared: document.getElementById('est-prepared').value.trim(),
          date: document.getElementById('est-date').value.trim(),
          base: parseFloat(document.getElementById('est-base').value || '0'),
          contingency: parseFloat(document.getElementById('est-contingency').value || '0'),
          status: document.getElementById('est-status').value
        };

        if (estEditIndex.value !== '') {
          estimateVersions[parseInt(estEditIndex.value, 10)] = row;
        } else {
          estimateVersions.unshift(row);
        }

        renderEstimates();
        resetEstForm();
      });

      estCancel.addEventListener('click', resetEstForm);
      estAddNew.addEventListener('click', resetEstForm);

      estBody.addEventListener('click', (event) => {
        const actionButton = event.target.closest('button[data-row-action]');
        if (!actionButton) return;
        const index = parseInt(actionButton.dataset.rowIndex, 10);
        const action = actionButton.dataset.rowAction;
        const row = estimateVersions[index];
        if (!row) return;

        if (action === 'edit') {
          estEditIndex.value = index.toString();
          document.getElementById('est-version').value = row.version;
          document.getElementById('est-project').value = row.project;
          document.getElementById('est-prepared').value = row.prepared;
          document.getElementById('est-date').value = row.date;
          document.getElementById('est-base').value = row.base;
          document.getElementById('est-contingency').value = row.contingency;
          document.getElementById('est-status').value = row.status;
          estCancel.style.display = 'inline-flex';
        }

        if (action === 'delete') {
          if (!confirm('Delete this estimate version?')) return;
          estimateVersions.splice(index, 1);
          renderEstimates();
        }
      });

      boqExport.addEventListener('click', () => {
        const header = ['Item', 'Category', 'Qty', 'UOM', 'Rate', 'Waste', 'Total', 'Status'];
        const rows = boqItems.map((row) => [row.item, row.category, row.qty, row.uom, row.rate, row.waste, boqTotal(row), row.status]);
        const csvContent = [header, ...rows].map(row => row.map(value => `"${value}"`).join(',')).join('\n');
        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = 'boq-items.csv';
        link.click();
        URL.revokeObjectURL(url);
      });

      estExport.addEventListener('click', () => {
        const header = ['Version', 'Project', 'Prepared By', 'Date', 'Base', 'Contingency', 'Total', 'Status'];
        const rows = estimateVersions.map((row) => [row.version, row.project, row.prepared, row.date, row.base, row.contingency, estTotal(row), row.status]);
        const csvContent = [header, ...rows].map(row => row.map(value => `"${value}"`).join(',')).join('\n');
        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = 'estimate-versions.csv';
        link.click();
        URL.revokeObjectURL(url);
      });

      renderBoq();
      renderEstimates();
    };

    const initProgressBilling = () => {
      const msBody = document.getElementById('ms-table-body');
      const msForm = document.getElementById('ms-form');
      const msEditIndex = document.getElementById('ms-edit-index');
      const msCancel = document.getElementById('ms-cancel');
      const msAddNew = document.getElementById('ms-add-new');
      const msExport = document.getElementById('ms-export');

      const raBody = document.getElementById('ra-table-body');
      const raSummaryBody = document.getElementById('ra-summary-body');
      const raForm = document.getElementById('ra-form');
      const raEditIndex = document.getElementById('ra-edit-index');
      const raCancel = document.getElementById('ra-cancel');
      const raAddNew = document.getElementById('ra-add-new');
      const raExport = document.getElementById('ra-export');

      if (!msBody || !msForm || !raBody || !raForm) {
        return;
      }

      const msDraftEl = document.getElementById('ms-draft-count');
      const msSubmittedEl = document.getElementById('ms-submitted-count');
      const msCertifiedEl = document.getElementById('ms-certified-count');

      const raSubmittedEl = document.getElementById('ra-submitted-count');
      const raApprovedEl = document.getElementById('ra-approved-count');
      const raPaidEl = document.getElementById('ra-paid-count');

      const sheetAmount = (row) => row.qty * row.rate;
      const raNet = (row) => row.gross - row.deductions - (row.gross * (row.retention / 100));

      const updateSummary = () => {
        const draftCount = measurementSheets.filter((row) => row.status === 'Draft').length;
        const submittedCount = measurementSheets.filter((row) => row.status === 'Submitted').length;
        const certifiedCount = measurementSheets.filter((row) => row.status === 'Certified').length;

        if (msDraftEl) msDraftEl.textContent = draftCount.toString();
        if (msSubmittedEl) msSubmittedEl.textContent = submittedCount.toString();
        if (msCertifiedEl) msCertifiedEl.textContent = certifiedCount.toString();

        const raSubmittedCount = raBills.filter((row) => row.status === 'Submitted').length;
        const raApprovedCount = raBills.filter((row) => row.status === 'Approved').length;
        const raPaidCount = raBills.filter((row) => row.status === 'Paid').length;

        if (raSubmittedEl) raSubmittedEl.textContent = raSubmittedCount.toString();
        if (raApprovedEl) raApprovedEl.textContent = raApprovedCount.toString();
        if (raPaidEl) raPaidEl.textContent = raPaidCount.toString();
      };

      const renderMs = () => {
        msBody.innerHTML = measurementSheets.map((row, index) => `
          <tr>
            <td>${row.sheet}</td>
            <td>${row.project}</td>
            <td>${row.work}</td>
            <td>${row.qty}</td>
            <td>${row.uom}</td>
            <td>‚Çπ${sheetAmount(row).toLocaleString('en-IN')}</td>
            <td>${row.date}</td>
            <td><span class="badge ${row.status === 'Certified' ? 'badge-success' : row.status === 'Submitted' ? 'badge-warning' : 'badge-info'}">${row.status}</span></td>
            <td>
              <button class="btn btn-secondary btn-icon" style="padding: 6px;" data-row-action="edit" data-row-index="${index}">üìù</button>
              <button class="btn btn-secondary btn-icon" style="padding: 6px;" data-row-action="delete" data-row-index="${index}">üóëÔ∏è</button>
            </td>
          </tr>
        `).join('') || '<tr><td colspan="9" style="text-align:center; padding: 16px;">No measurement sheets found.</td></tr>';

        updateSummary();
      };

      const renderRa = () => {
        raBody.innerHTML = raBills.map((row, index) => `
          <tr>
            <td>${row.bill}</td>
            <td>${row.project}</td>
            <td>${row.period}</td>
            <td>‚Çπ${row.gross.toLocaleString('en-IN')}</td>
            <td>‚Çπ${row.deductions.toLocaleString('en-IN')}</td>
            <td>‚Çπ${raNet(row).toLocaleString('en-IN')}</td>
            <td><span class="badge ${row.status === 'Paid' ? 'badge-success' : row.status === 'Approved' ? 'badge-info' : row.status === 'Under Review' ? 'badge-warning' : 'badge-secondary'}">${row.status}</span></td>
            <td>
              <button class="btn btn-secondary btn-icon" style="padding: 6px;" data-row-action="edit" data-row-index="${index}">üìù</button>
              <button class="btn btn-secondary btn-icon" style="padding: 6px;" data-row-action="delete" data-row-index="${index}">üóëÔ∏è</button>
            </td>
          </tr>
        `).join('') || '<tr><td colspan="8" style="text-align:center; padding: 16px;">No RA bills found.</td></tr>';

        if (raSummaryBody) {
          raSummaryBody.innerHTML = raBills.map((row) => `
            <tr>
              <td>${row.bill}</td>
              <td><span class="badge ${row.status === 'Paid' ? 'badge-success' : row.status === 'Approved' ? 'badge-info' : row.status === 'Under Review' ? 'badge-warning' : 'badge-secondary'}">${row.status}</span></td>
              <td>‚Çπ${raNet(row).toLocaleString('en-IN')}</td>
            </tr>
          `).join('') || '<tr><td colspan="3" style="text-align:center; padding: 16px;">No summary available.</td></tr>';
        }

        updateSummary();
      };

      const resetMsForm = () => {
        msForm.reset();
        msEditIndex.value = '';
        msCancel.style.display = 'none';
      };

      const resetRaForm = () => {
        raForm.reset();
        raEditIndex.value = '';
        raCancel.style.display = 'none';
      };

      msForm.addEventListener('submit', (event) => {
        event.preventDefault();
        const row = {
          sheet: document.getElementById('ms-no').value.trim(),
          project: document.getElementById('ms-project').value.trim(),
          work: document.getElementById('ms-work').value.trim(),
          qty: parseFloat(document.getElementById('ms-qty').value || '0'),
          uom: document.getElementById('ms-uom').value.trim(),
          rate: parseFloat(document.getElementById('ms-rate').value || '0'),
          date: document.getElementById('ms-date').value.trim(),
          status: document.getElementById('ms-status').value
        };

        if (msEditIndex.value !== '') {
          measurementSheets[parseInt(msEditIndex.value, 10)] = row;
        } else {
          measurementSheets.unshift(row);
        }

        renderMs();
        resetMsForm();
      });

      msCancel.addEventListener('click', resetMsForm);
      msAddNew.addEventListener('click', resetMsForm);

      msBody.addEventListener('click', (event) => {
        const actionButton = event.target.closest('button[data-row-action]');
        if (!actionButton) return;
        const index = parseInt(actionButton.dataset.rowIndex, 10);
        const action = actionButton.dataset.rowAction;
        const row = measurementSheets[index];
        if (!row) return;

        if (action === 'edit') {
          msEditIndex.value = index.toString();
          document.getElementById('ms-no').value = row.sheet;
          document.getElementById('ms-project').value = row.project;
          document.getElementById('ms-work').value = row.work;
          document.getElementById('ms-qty').value = row.qty;
          document.getElementById('ms-uom').value = row.uom;
          document.getElementById('ms-rate').value = row.rate;
          document.getElementById('ms-date').value = row.date;
          document.getElementById('ms-status').value = row.status;
          msCancel.style.display = 'inline-flex';
        }

        if (action === 'delete') {
          if (!confirm('Delete this measurement sheet?')) return;
          measurementSheets.splice(index, 1);
          renderMs();
        }
      });

      raForm.addEventListener('submit', (event) => {
        event.preventDefault();
        const row = {
          bill: document.getElementById('ra-no').value.trim(),
          project: document.getElementById('ra-project').value.trim(),
          period: document.getElementById('ra-period').value.trim(),
          gross: parseFloat(document.getElementById('ra-gross').value || '0'),
          deductions: parseFloat(document.getElementById('ra-deductions').value || '0'),
          retention: parseFloat(document.getElementById('ra-retention').value || '0'),
          status: document.getElementById('ra-status').value
        };

        if (raEditIndex.value !== '') {
          raBills[parseInt(raEditIndex.value, 10)] = row;
        } else {
          raBills.unshift(row);
        }

        renderRa();
        resetRaForm();
      });

      raCancel.addEventListener('click', resetRaForm);
      raAddNew.addEventListener('click', resetRaForm);

      raBody.addEventListener('click', (event) => {
        const actionButton = event.target.closest('button[data-row-action]');
        if (!actionButton) return;
        const index = parseInt(actionButton.dataset.rowIndex, 10);
        const action = actionButton.dataset.rowAction;
        const row = raBills[index];
        if (!row) return;

        if (action === 'edit') {
          raEditIndex.value = index.toString();
          document.getElementById('ra-no').value = row.bill;
          document.getElementById('ra-project').value = row.project;
          document.getElementById('ra-period').value = row.period;
          document.getElementById('ra-gross').value = row.gross;
          document.getElementById('ra-deductions').value = row.deductions;
          document.getElementById('ra-retention').value = row.retention;
          document.getElementById('ra-status').value = row.status;
          raCancel.style.display = 'inline-flex';
        }

        if (action === 'delete') {
          if (!confirm('Delete this RA bill?')) return;
          raBills.splice(index, 1);
          renderRa();
        }
      });

      msExport.addEventListener('click', () => {
        const header = ['Sheet', 'Project', 'Work Item', 'Qty', 'UOM', 'Rate', 'Amount', 'Date', 'Status'];
        const rows = measurementSheets.map((row) => [row.sheet, row.project, row.work, row.qty, row.uom, row.rate, sheetAmount(row), row.date, row.status]);
        const csvContent = [header, ...rows].map(row => row.map(value => `"${value}"`).join(',')).join('\n');
        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = 'measurement-sheets.csv';
        link.click();
        URL.revokeObjectURL(url);
      });

      raExport.addEventListener('click', () => {
        const header = ['RA Bill', 'Project', 'Period', 'Gross', 'Deductions', 'Retention', 'Net', 'Status'];
        const rows = raBills.map((row) => [row.bill, row.project, row.period, row.gross, row.deductions, row.retention, raNet(row), row.status]);
        const csvContent = [header, ...rows].map(row => row.map(value => `"${value}"`).join(',')).join('\n');
        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = 'ra-bills.csv';
        link.click();
        URL.revokeObjectURL(url);
      });

      renderMs();
      renderRa();
    };

    const initChangeOrders = () => {
      const tbody = document.getElementById('co-table-body');
      const summaryBody = document.getElementById('co-summary-body');
      const form = document.getElementById('co-form');
      const editIndex = document.getElementById('co-edit-index');
      const cancel = document.getElementById('co-cancel');
      const addNew = document.getElementById('co-add-new');
      const exportBtn = document.getElementById('co-export');

      if (!tbody || !form) {
        return;
      }

      const draftCountEl = document.getElementById('co-draft-count');
      const submittedCountEl = document.getElementById('co-submitted-count');
      const approvedCountEl = document.getElementById('co-approved-count');
      const totalCostEl = document.getElementById('co-total-cost');
      const totalDaysEl = document.getElementById('co-total-days');
      const approvedValueEl = document.getElementById('co-approved-value');

      const updateSummary = () => {
        const draftCount = changeOrders.filter((row) => row.status === 'Draft').length;
        const submittedCount = changeOrders.filter((row) => row.status === 'Submitted').length;
        const approvedCount = changeOrders.filter((row) => row.status === 'Approved').length;

        if (draftCountEl) draftCountEl.textContent = draftCount.toString();
        if (submittedCountEl) submittedCountEl.textContent = submittedCount.toString();
        if (approvedCountEl) approvedCountEl.textContent = approvedCount.toString();

        const totalCost = changeOrders.reduce((sum, row) => sum + row.cost, 0);
        const totalDays = changeOrders.reduce((sum, row) => sum + row.days, 0);
        const approvedValue = changeOrders.filter((row) => row.status === 'Approved').reduce((sum, row) => sum + row.cost, 0);

        if (totalCostEl) totalCostEl.textContent = `‚Çπ${totalCost.toLocaleString('en-IN')}`;
        if (totalDaysEl) totalDaysEl.textContent = totalDays.toString();
        if (approvedValueEl) approvedValueEl.textContent = `‚Çπ${approvedValue.toLocaleString('en-IN')}`;
      };

      const render = () => {
        tbody.innerHTML = changeOrders.map((row, index) => `
          <tr>
            <td>${row.no}</td>
            <td>${row.project}</td>
            <td>${row.category}</td>
            <td>‚Çπ${row.cost.toLocaleString('en-IN')}</td>
            <td>${row.days}</td>
            <td><span class="badge ${row.status === 'Approved' ? 'badge-success' : row.status === 'Submitted' ? 'badge-warning' : row.status === 'Rejected' ? 'badge-danger' : 'badge-info'}">${row.status}</span></td>
            <td>
              <button class="btn btn-secondary btn-icon" style="padding: 6px;" data-row-action="edit" data-row-index="${index}">üìù</button>
              <button class="btn btn-secondary btn-icon" style="padding: 6px;" data-row-action="delete" data-row-index="${index}">üóëÔ∏è</button>
            </td>
          </tr>
        `).join('') || '<tr><td colspan="7" style="text-align:center; padding: 16px;">No change orders found.</td></tr>';

        if (summaryBody) {
          summaryBody.innerHTML = changeOrders.map((row) => `
            <tr>
              <td>${row.no}</td>
              <td>${row.owner}</td>
              <td><span class="badge ${row.status === 'Approved' ? 'badge-success' : row.status === 'Submitted' ? 'badge-warning' : row.status === 'Rejected' ? 'badge-danger' : 'badge-info'}">${row.status}</span></td>
            </tr>
          `).join('') || '<tr><td colspan="3" style="text-align:center; padding: 16px;">No summary available.</td></tr>';
        }

        updateSummary();
      };

      const resetForm = () => {
        form.reset();
        editIndex.value = '';
        cancel.style.display = 'none';
      };

      form.addEventListener('submit', (event) => {
        event.preventDefault();
        const row = {
          no: document.getElementById('co-no').value.trim(),
          project: document.getElementById('co-project').value.trim(),
          category: document.getElementById('co-category').value.trim(),
          description: document.getElementById('co-description').value.trim(),
          cost: parseFloat(document.getElementById('co-cost').value || '0'),
          days: parseFloat(document.getElementById('co-days').value || '0'),
          raised: document.getElementById('co-raised').value.trim(),
          owner: document.getElementById('co-owner').value.trim(),
          status: document.getElementById('co-status').value
        };

        if (editIndex.value !== '') {
          changeOrders[parseInt(editIndex.value, 10)] = row;
        } else {
          changeOrders.unshift(row);
        }

        render();
        resetForm();
      });

      cancel.addEventListener('click', resetForm);
      addNew.addEventListener('click', resetForm);

      tbody.addEventListener('click', (event) => {
        const actionButton = event.target.closest('button[data-row-action]');
        if (!actionButton) return;
        const index = parseInt(actionButton.dataset.rowIndex, 10);
        const action = actionButton.dataset.rowAction;
        const row = changeOrders[index];
        if (!row) return;

        if (action === 'edit') {
          editIndex.value = index.toString();
          document.getElementById('co-no').value = row.no;
          document.getElementById('co-project').value = row.project;
          document.getElementById('co-category').value = row.category;
          document.getElementById('co-description').value = row.description;
          document.getElementById('co-cost').value = row.cost;
          document.getElementById('co-days').value = row.days;
          document.getElementById('co-raised').value = row.raised;
          document.getElementById('co-owner').value = row.owner;
          document.getElementById('co-status').value = row.status;
          cancel.style.display = 'inline-flex';
        }

        if (action === 'delete') {
          if (!confirm('Delete this change order?')) return;
          changeOrders.splice(index, 1);
          render();
        }
      });

      exportBtn.addEventListener('click', () => {
        const header = ['Change Order', 'Project', 'Category', 'Description', 'Cost Impact', 'Schedule Days', 'Raised On', 'Owner', 'Status'];
        const rows = changeOrders.map((row) => [row.no, row.project, row.category, row.description, row.cost, row.days, row.raised, row.owner, row.status]);
        const csvContent = [header, ...rows].map(row => row.map(value => `"${value}"`).join(',')).join('\n');
        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = 'change-orders.csv';
        link.click();
        URL.revokeObjectURL(url);
      });

      render();
    };

    const initContractManagement = () => {
      const tbody = document.getElementById('contract-mgmt-body');
      const termsBody = document.getElementById('contract-terms-body');
      const form = document.getElementById('contract-mgmt-form');
      const editIndex = document.getElementById('contract-mgmt-edit-index');
      const cancel = document.getElementById('contract-cancel');
      const addNew = document.getElementById('contract-add-new');
      const exportBtn = document.getElementById('contract-export');

      if (!tbody || !form) {
        return;
      }

      const activeCountEl = document.getElementById('contract-active-count');
      const pendingCountEl = document.getElementById('contract-pending-count');
      const closedCountEl = document.getElementById('contract-closed-count');
      const retentionAvgEl = document.getElementById('contract-retention-avg');
      const ldAvgEl = document.getElementById('contract-ld-avg');
      const totalValueEl = document.getElementById('contract-total-value');

      const updateSummary = () => {
        const activeCount = contractManagementData.filter((row) => row.status === 'Active').length;
        const pendingCount = contractManagementData.filter((row) => row.status === 'Pending').length;
        const closedCount = contractManagementData.filter((row) => row.status === 'Closed').length;

        if (activeCountEl) activeCountEl.textContent = activeCount.toString();
        if (pendingCountEl) pendingCountEl.textContent = pendingCount.toString();
        if (closedCountEl) closedCountEl.textContent = closedCount.toString();

        const totalValue = contractManagementData.reduce((sum, row) => sum + row.value, 0);
        const retentionAvg = contractManagementData.length ? (contractManagementData.reduce((sum, row) => sum + row.retention, 0) / contractManagementData.length) : 0;
        const ldAvg = contractManagementData.length ? (contractManagementData.reduce((sum, row) => sum + row.ld, 0) / contractManagementData.length) : 0;

        if (totalValueEl) totalValueEl.textContent = `‚Çπ${totalValue.toLocaleString('en-IN')}`;
        if (retentionAvgEl) retentionAvgEl.textContent = `${retentionAvg.toFixed(1)}%`;
        if (ldAvgEl) ldAvgEl.textContent = `${ldAvg.toFixed(1)}%`;
      };

      const render = () => {
        tbody.innerHTML = contractManagementData.map((row, index) => `
          <tr>
            <td>${row.no}</td>
            <td>${row.client}</td>
            <td>${row.project}</td>
            <td>‚Çπ${row.value.toLocaleString('en-IN')}</td>
            <td>${row.start}</td>
            <td>${row.end}</td>
            <td><span class="badge ${row.status === 'Active' ? 'badge-success' : row.status === 'Pending' ? 'badge-warning' : 'badge-danger'}">${row.status}</span></td>
            <td>
              <button class="btn btn-secondary btn-icon" style="padding: 6px;" data-row-action="edit" data-row-index="${index}">üìù</button>
              <button class="btn btn-secondary btn-icon" style="padding: 6px;" data-row-action="delete" data-row-index="${index}">üóëÔ∏è</button>
            </td>
          </tr>
        `).join('') || '<tr><td colspan="8" style="text-align:center; padding: 16px;">No contracts found.</td></tr>';

        if (termsBody) {
          termsBody.innerHTML = contractManagementData.map((row) => `
            <tr>
              <td>${row.no}</td>
              <td>${row.retention}%</td>
              <td>${row.ld}%</td>
              <td>${row.owner}</td>
            </tr>
          `).join('') || '<tr><td colspan="4" style="text-align:center; padding: 16px;">No terms available.</td></tr>';
        }

        updateSummary();
      };

      const resetForm = () => {
        form.reset();
        editIndex.value = '';
        cancel.style.display = 'none';
      };

      form.addEventListener('submit', (event) => {
        event.preventDefault();
        const row = {
          no: document.getElementById('contract-no').value.trim(),
          client: document.getElementById('contract-client').value.trim(),
          project: document.getElementById('contract-project').value.trim(),
          value: parseFloat(document.getElementById('contract-value').value || '0'),
          start: document.getElementById('contract-start').value.trim(),
          end: document.getElementById('contract-end').value.trim(),
          retention: parseFloat(document.getElementById('contract-retention').value || '0'),
          ld: parseFloat(document.getElementById('contract-ld').value || '0'),
          owner: document.getElementById('contract-owner').value.trim(),
          status: document.getElementById('contract-status').value
        };

        if (editIndex.value !== '') {
          contractManagementData[parseInt(editIndex.value, 10)] = row;
        } else {
          contractManagementData.unshift(row);
        }

        render();
        resetForm();
      });

      cancel.addEventListener('click', resetForm);
      addNew.addEventListener('click', resetForm);

      tbody.addEventListener('click', (event) => {
        const actionButton = event.target.closest('button[data-row-action]');
        if (!actionButton) return;
        const index = parseInt(actionButton.dataset.rowIndex, 10);
        const action = actionButton.dataset.rowAction;
        const row = contractManagementData[index];
        if (!row) return;

        if (action === 'edit') {
          editIndex.value = index.toString();
          document.getElementById('contract-no').value = row.no;
          document.getElementById('contract-client').value = row.client;
          document.getElementById('contract-project').value = row.project;
          document.getElementById('contract-value').value = row.value;
          document.getElementById('contract-start').value = row.start;
          document.getElementById('contract-end').value = row.end;
          document.getElementById('contract-retention').value = row.retention;
          document.getElementById('contract-ld').value = row.ld;
          document.getElementById('contract-owner').value = row.owner;
          document.getElementById('contract-status').value = row.status;
          cancel.style.display = 'inline-flex';
        }

        if (action === 'delete') {
          if (!confirm('Delete this contract?')) return;
          contractManagementData.splice(index, 1);
          render();
        }
      });

      exportBtn.addEventListener('click', () => {
        const header = ['Contract', 'Client', 'Project', 'Value', 'Start', 'End', 'Retention', 'LD', 'Owner', 'Status'];
        const rows = contractManagementData.map((row) => [row.no, row.client, row.project, row.value, row.start, row.end, row.retention, row.ld, row.owner, row.status]);
        const csvContent = [header, ...rows].map(row => row.map(value => `"${value}"`).join(',')).join('\n');
        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = 'contracts-management.csv';
        link.click();
        URL.revokeObjectURL(url);
      });

      render();
    };

    const initTimeAttendance = () => {
      const attBody = document.getElementById('att-table-body');
      const attForm = document.getElementById('att-form');
      const attEditIndex = document.getElementById('att-edit-index');
      const attCancel = document.getElementById('att-cancel');
      const attAddNew = document.getElementById('att-add-new');
      const attExport = document.getElementById('att-export');

      const otBody = document.getElementById('ot-table-body');
      const otForm = document.getElementById('ot-form');
      const otEditIndex = document.getElementById('ot-edit-index');
      const otCancel = document.getElementById('ot-cancel');
      const otAddNew = document.getElementById('ot-add-new');
      const otExport = document.getElementById('ot-export');

      if (!attBody || !attForm || !otBody || !otForm) {
        return;
      }

      const presentCountEl = document.getElementById('att-present-count');
      const absentCountEl = document.getElementById('att-absent-count');
      const leaveCountEl = document.getElementById('att-leave-count');

      const otPendingEl = document.getElementById('ot-pending-count');
      const otApprovedEl = document.getElementById('ot-approved-count');
      const otRejectedEl = document.getElementById('ot-rejected-count');

      const otAmount = (row) => row.hours * row.rate;

      const updateSummary = () => {
        const presentCount = attendanceRecords.filter((row) => row.status === 'Present').length;
        const absentCount = attendanceRecords.filter((row) => row.status === 'Absent').length;
        const leaveCount = attendanceRecords.filter((row) => row.status === 'On Leave').length;

        if (presentCountEl) presentCountEl.textContent = presentCount.toString();
        if (absentCountEl) absentCountEl.textContent = absentCount.toString();
        if (leaveCountEl) leaveCountEl.textContent = leaveCount.toString();

        const pendingCount = overtimeApprovals.filter((row) => row.status === 'Pending').length;
        const approvedCount = overtimeApprovals.filter((row) => row.status === 'Approved').length;
        const rejectedCount = overtimeApprovals.filter((row) => row.status === 'Rejected').length;

        if (otPendingEl) otPendingEl.textContent = pendingCount.toString();
        if (otApprovedEl) otApprovedEl.textContent = approvedCount.toString();
        if (otRejectedEl) otRejectedEl.textContent = rejectedCount.toString();
      };

      const renderAttendance = () => {
        attBody.innerHTML = attendanceRecords.map((row, index) => `
          <tr>
            <td>${row.date}</td>
            <td>${row.site}</td>
            <td>${row.worker}</td>
            <td>${row.role}</td>
            <td>${row.hours}</td>
            <td>${row.overtime}</td>
            <td><span class="badge ${row.status === 'Present' ? 'badge-success' : row.status === 'Absent' ? 'badge-danger' : 'badge-warning'}">${row.status}</span></td>
            <td>
              <button class="btn btn-secondary btn-icon" style="padding: 6px;" data-row-action="edit" data-row-index="${index}">üìù</button>
              <button class="btn btn-secondary btn-icon" style="padding: 6px;" data-row-action="delete" data-row-index="${index}">üóëÔ∏è</button>
            </td>
          </tr>
        `).join('') || '<tr><td colspan="8" style="text-align:center; padding: 16px;">No attendance records found.</td></tr>';

        updateSummary();
      };

      const renderOvertime = () => {
        otBody.innerHTML = overtimeApprovals.map((row, index) => `
          <tr>
            <td>${row.worker}</td>
            <td>${row.site}</td>
            <td>${row.date}</td>
            <td>${row.hours}</td>
            <td>‚Çπ${otAmount(row).toLocaleString('en-IN')}</td>
            <td><span class="badge ${row.status === 'Approved' ? 'badge-success' : row.status === 'Rejected' ? 'badge-danger' : 'badge-warning'}">${row.status}</span></td>
            <td>
              <button class="btn btn-secondary btn-icon" style="padding: 6px;" data-row-action="edit" data-row-index="${index}">üìù</button>
              <button class="btn btn-secondary btn-icon" style="padding: 6px;" data-row-action="delete" data-row-index="${index}">üóëÔ∏è</button>
            </td>
          </tr>
        `).join('') || '<tr><td colspan="7" style="text-align:center; padding: 16px;">No overtime approvals found.</td></tr>';

        updateSummary();
      };

      const resetAttForm = () => {
        attForm.reset();
        attEditIndex.value = '';
        attCancel.style.display = 'none';
      };

      const resetOtForm = () => {
        otForm.reset();
        otEditIndex.value = '';
        otCancel.style.display = 'none';
      };

      attForm.addEventListener('submit', (event) => {
        event.preventDefault();
        const row = {
          date: document.getElementById('att-date').value.trim(),
          site: document.getElementById('att-site').value.trim(),
          worker: document.getElementById('att-worker').value.trim(),
          role: document.getElementById('att-role').value.trim(),
          hours: parseFloat(document.getElementById('att-hours').value || '0'),
          overtime: parseFloat(document.getElementById('att-overtime').value || '0'),
          status: document.getElementById('att-status').value
        };

        if (attEditIndex.value !== '') {
          attendanceRecords[parseInt(attEditIndex.value, 10)] = row;
        } else {
          attendanceRecords.unshift(row);
        }

        renderAttendance();
        resetAttForm();
      });

      attCancel.addEventListener('click', resetAttForm);
      attAddNew.addEventListener('click', resetAttForm);

      attBody.addEventListener('click', (event) => {
        const actionButton = event.target.closest('button[data-row-action]');
        if (!actionButton) return;
        const index = parseInt(actionButton.dataset.rowIndex, 10);
        const action = actionButton.dataset.rowAction;
        const row = attendanceRecords[index];
        if (!row) return;

        if (action === 'edit') {
          attEditIndex.value = index.toString();
          document.getElementById('att-date').value = row.date;
          document.getElementById('att-site').value = row.site;
          document.getElementById('att-worker').value = row.worker;
          document.getElementById('att-role').value = row.role;
          document.getElementById('att-hours').value = row.hours;
          document.getElementById('att-overtime').value = row.overtime;
          document.getElementById('att-status').value = row.status;
          attCancel.style.display = 'inline-flex';
        }

        if (action === 'delete') {
          if (!confirm('Delete this attendance record?')) return;
          attendanceRecords.splice(index, 1);
          renderAttendance();
        }
      });

      otForm.addEventListener('submit', (event) => {
        event.preventDefault();
        const row = {
          worker: document.getElementById('ot-worker').value.trim(),
          site: document.getElementById('ot-site').value.trim(),
          date: document.getElementById('ot-date').value.trim(),
          hours: parseFloat(document.getElementById('ot-hours').value || '0'),
          rate: parseFloat(document.getElementById('ot-rate').value || '0'),
          approver: document.getElementById('ot-approver').value.trim(),
          status: document.getElementById('ot-status').value
        };

        if (otEditIndex.value !== '') {
          overtimeApprovals[parseInt(otEditIndex.value, 10)] = row;
        } else {
          overtimeApprovals.unshift(row);
        }

        renderOvertime();
        resetOtForm();
      });

      otCancel.addEventListener('click', resetOtForm);
      otAddNew.addEventListener('click', resetOtForm);

      otBody.addEventListener('click', (event) => {
        const actionButton = event.target.closest('button[data-row-action]');
        if (!actionButton) return;
        const index = parseInt(actionButton.dataset.rowIndex, 10);
        const action = actionButton.dataset.rowAction;
        const row = overtimeApprovals[index];
        if (!row) return;

        if (action === 'edit') {
          otEditIndex.value = index.toString();
          document.getElementById('ot-worker').value = row.worker;
          document.getElementById('ot-site').value = row.site;
          document.getElementById('ot-date').value = row.date;
          document.getElementById('ot-hours').value = row.hours;
          document.getElementById('ot-rate').value = row.rate;
          document.getElementById('ot-approver').value = row.approver;
          document.getElementById('ot-status').value = row.status;
          otCancel.style.display = 'inline-flex';
        }

        if (action === 'delete') {
          if (!confirm('Delete this overtime approval?')) return;
          overtimeApprovals.splice(index, 1);
          renderOvertime();
        }
      });

      attExport.addEventListener('click', () => {
        const header = ['Date', 'Site', 'Worker', 'Role', 'Hours', 'Overtime', 'Status'];
        const rows = attendanceRecords.map((row) => [row.date, row.site, row.worker, row.role, row.hours, row.overtime, row.status]);
        const csvContent = [header, ...rows].map(row => row.map(value => `"${value}"`).join(',')).join('\n');
        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = 'attendance-records.csv';
        link.click();
        URL.revokeObjectURL(url);
      });

      otExport.addEventListener('click', () => {
        const header = ['Worker', 'Site', 'Date', 'Hours', 'Rate', 'Amount', 'Approver', 'Status'];
        const rows = overtimeApprovals.map((row) => [row.worker, row.site, row.date, row.hours, row.rate, otAmount(row), row.approver, row.status]);
        const csvContent = [header, ...rows].map(row => row.map(value => `"${value}"`).join(',')).join('\n');
        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = 'overtime-approvals.csv';
        link.click();
        URL.revokeObjectURL(url);
      });

      renderAttendance();
      renderOvertime();
    };

    const initSubcontractorBilling = () => {
      const tbody = document.getElementById('subc-table-body');
      const summaryBody = document.getElementById('subc-summary-body');
      const form = document.getElementById('subc-form');
      const editIndex = document.getElementById('subc-edit-index');
      const cancel = document.getElementById('subc-cancel');
      const addNew = document.getElementById('subc-add-new');
      const exportBtn = document.getElementById('subc-export');

      if (!tbody || !form) {
        return;
      }

      const submittedCountEl = document.getElementById('subc-submitted-count');
      const certifiedCountEl = document.getElementById('subc-certified-count');
      const paidCountEl = document.getElementById('subc-paid-count');
      const totalGrossEl = document.getElementById('subc-total-gross');
      const totalRetentionEl = document.getElementById('subc-total-retention');
      const totalNetEl = document.getElementById('subc-total-net');

      const grossAmount = (row) => row.qty * row.rate;
      const retentionAmount = (row) => grossAmount(row) * (row.retention / 100);
      const netAmount = (row) => grossAmount(row) - retentionAmount(row) - row.deduction;

      const updateSummary = () => {
        const submittedCount = subcontractorBills.filter((row) => row.status === 'Submitted').length;
        const certifiedCount = subcontractorBills.filter((row) => row.status === 'Certified').length;
        const paidCount = subcontractorBills.filter((row) => row.status === 'Paid').length;

        if (submittedCountEl) submittedCountEl.textContent = submittedCount.toString();
        if (certifiedCountEl) certifiedCountEl.textContent = certifiedCount.toString();
        if (paidCountEl) paidCountEl.textContent = paidCount.toString();

        const totalGross = subcontractorBills.reduce((sum, row) => sum + grossAmount(row), 0);
        const totalRetention = subcontractorBills.reduce((sum, row) => sum + retentionAmount(row), 0);
        const totalNet = subcontractorBills.reduce((sum, row) => sum + netAmount(row), 0);

        if (totalGrossEl) totalGrossEl.textContent = `‚Çπ${totalGross.toLocaleString('en-IN')}`;
        if (totalRetentionEl) totalRetentionEl.textContent = `‚Çπ${totalRetention.toLocaleString('en-IN')}`;
        if (totalNetEl) totalNetEl.textContent = `‚Çπ${totalNet.toLocaleString('en-IN')}`;
      };

      const render = () => {
        tbody.innerHTML = subcontractorBills.map((row, index) => `
          <tr>
            <td>${row.bill}</td>
            <td>${row.wo}</td>
            <td>${row.name}</td>
            <td>${row.scope}</td>
            <td>‚Çπ${grossAmount(row).toLocaleString('en-IN')}</td>
            <td>‚Çπ${netAmount(row).toLocaleString('en-IN')}</td>
            <td><span class="badge ${row.status === 'Paid' ? 'badge-success' : row.status === 'Certified' ? 'badge-info' : 'badge-warning'}">${row.status}</span></td>
            <td>
              <button class="btn btn-secondary btn-icon" style="padding: 6px;" data-row-action="edit" data-row-index="${index}">üìù</button>
              <button class="btn btn-secondary btn-icon" style="padding: 6px;" data-row-action="delete" data-row-index="${index}">üóëÔ∏è</button>
            </td>
          </tr>
        `).join('') || '<tr><td colspan="8" style="text-align:center; padding: 16px;">No subcontractor bills found.</td></tr>';

        if (summaryBody) {
          summaryBody.innerHTML = subcontractorBills.map((row) => `
            <tr>
              <td>${row.bill}</td>
              <td>‚Çπ${retentionAmount(row).toLocaleString('en-IN')}</td>
              <td>‚Çπ${row.deduction.toLocaleString('en-IN')}</td>
              <td>‚Çπ${netAmount(row).toLocaleString('en-IN')}</td>
            </tr>
          `).join('') || '<tr><td colspan="4" style="text-align:center; padding: 16px;">No summary available.</td></tr>';
        }

        updateSummary();
      };

      const resetForm = () => {
        form.reset();
        editIndex.value = '';
        cancel.style.display = 'none';
      };

      form.addEventListener('submit', (event) => {
        event.preventDefault();
        const row = {
          bill: document.getElementById('subc-bill-no').value.trim(),
          wo: document.getElementById('subc-wo').value.trim(),
          name: document.getElementById('subc-name').value.trim(),
          scope: document.getElementById('subc-scope').value.trim(),
          qty: parseFloat(document.getElementById('subc-qty').value || '0'),
          rate: parseFloat(document.getElementById('subc-rate').value || '0'),
          retention: parseFloat(document.getElementById('subc-retention').value || '0'),
          deduction: parseFloat(document.getElementById('subc-deduction').value || '0'),
          status: document.getElementById('subc-status').value
        };

        if (editIndex.value !== '') {
          subcontractorBills[parseInt(editIndex.value, 10)] = row;
        } else {
          subcontractorBills.unshift(row);
        }

        render();
        resetForm();
      });

      cancel.addEventListener('click', resetForm);
      addNew.addEventListener('click', resetForm);

      tbody.addEventListener('click', (event) => {
        const actionButton = event.target.closest('button[data-row-action]');
        if (!actionButton) return;
        const index = parseInt(actionButton.dataset.rowIndex, 10);
        const action = actionButton.dataset.rowAction;
        const row = subcontractorBills[index];
        if (!row) return;

        if (action === 'edit') {
          editIndex.value = index.toString();
          document.getElementById('subc-bill-no').value = row.bill;
          document.getElementById('subc-wo').value = row.wo;
          document.getElementById('subc-name').value = row.name;
          document.getElementById('subc-scope').value = row.scope;
          document.getElementById('subc-qty').value = row.qty;
          document.getElementById('subc-rate').value = row.rate;
          document.getElementById('subc-retention').value = row.retention;
          document.getElementById('subc-deduction').value = row.deduction;
          document.getElementById('subc-status').value = row.status;
          cancel.style.display = 'inline-flex';
        }

        if (action === 'delete') {
          if (!confirm('Delete this subcontractor bill?')) return;
          subcontractorBills.splice(index, 1);
          render();
        }
      });

      exportBtn.addEventListener('click', () => {
        const header = ['Bill', 'WO', 'Subcontractor', 'Scope', 'Qty', 'Rate', 'Gross', 'Retention', 'Deductions', 'Net', 'Status'];
        const rows = subcontractorBills.map((row) => [row.bill, row.wo, row.name, row.scope, row.qty, row.rate, grossAmount(row), row.retention, row.deduction, netAmount(row), row.status]);
        const csvContent = [header, ...rows].map(row => row.map(value => `"${value}"`).join(',')).join('\n');
        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = 'subcontractor-bills.csv';
        link.click();
        URL.revokeObjectURL(url);
      });

      render();
    };

    const initProjectForecasting = () => {
      const eacBody = document.getElementById('eac-table-body');
      const eacForm = document.getElementById('eac-form');
      const eacEditIndex = document.getElementById('eac-edit-index');
      const eacCancel = document.getElementById('eac-cancel');
      const eacAddNew = document.getElementById('eac-add-new');
      const eacExport = document.getElementById('eac-export');

      const cashBody = document.getElementById('cash-table-body');
      const cashSummaryBody = document.getElementById('cash-summary-body');
      const cashForm = document.getElementById('cash-form');
      const cashEditIndex = document.getElementById('cash-edit-index');
      const cashCancel = document.getElementById('cash-cancel');
      const cashAddNew = document.getElementById('cash-add-new');
      const cashExport = document.getElementById('cash-export');

      if (!eacBody || !eacForm || !cashBody || !cashForm) {
        return;
      }

      const onTrackEl = document.getElementById('eac-ontrack-count');
      const atRiskEl = document.getElementById('eac-atrisk-count');
      const overEl = document.getElementById('eac-over-count');

      const surplusEl = document.getElementById('cash-surplus-count');
      const balancedEl = document.getElementById('cash-balanced-count');
      const deficitEl = document.getElementById('cash-deficit-count');

      const eacValue = (row) => row.actual + row.etc;
      const varianceValue = (row) => eacValue(row) - row.budget;
      const netCash = (row) => row.inflow - row.outflow;

      const updateSummary = () => {
        const onTrackCount = eacForecasts.filter((row) => row.status === 'On Track').length;
        const atRiskCount = eacForecasts.filter((row) => row.status === 'At Risk').length;
        const overCount = eacForecasts.filter((row) => row.status === 'Over Budget').length;

        if (onTrackEl) onTrackEl.textContent = onTrackCount.toString();
        if (atRiskEl) atRiskEl.textContent = atRiskCount.toString();
        if (overEl) overEl.textContent = overCount.toString();

        const surplusCount = cashForecasts.filter((row) => row.status === 'Surplus').length;
        const balancedCount = cashForecasts.filter((row) => row.status === 'Balanced').length;
        const deficitCount = cashForecasts.filter((row) => row.status === 'Deficit').length;

        if (surplusEl) surplusEl.textContent = surplusCount.toString();
        if (balancedEl) balancedEl.textContent = balancedCount.toString();
        if (deficitEl) deficitEl.textContent = deficitCount.toString();
      };

      const renderEac = () => {
        eacBody.innerHTML = eacForecasts.map((row, index) => `
          <tr>
            <td>${row.project}</td>
            <td>‚Çπ${row.budget.toLocaleString('en-IN')}</td>
            <td>‚Çπ${row.actual.toLocaleString('en-IN')}</td>
            <td>‚Çπ${row.etc.toLocaleString('en-IN')}</td>
            <td>‚Çπ${eacValue(row).toLocaleString('en-IN')}</td>
            <td>‚Çπ${varianceValue(row).toLocaleString('en-IN')}</td>
            <td><span class="badge ${row.status === 'On Track' ? 'badge-success' : row.status === 'At Risk' ? 'badge-warning' : 'badge-danger'}">${row.status}</span></td>
            <td>
              <button class="btn btn-secondary btn-icon" style="padding: 6px;" data-row-action="edit" data-row-index="${index}">üìù</button>
              <button class="btn btn-secondary btn-icon" style="padding: 6px;" data-row-action="delete" data-row-index="${index}">üóëÔ∏è</button>
            </td>
          </tr>
        `).join('') || '<tr><td colspan="8" style="text-align:center; padding: 16px;">No EAC records found.</td></tr>';

        updateSummary();
      };

      const renderCash = () => {
        cashBody.innerHTML = cashForecasts.map((row, index) => `
          <tr>
            <td>${row.project}</td>
            <td>${row.month}</td>
            <td>‚Çπ${row.inflow.toLocaleString('en-IN')}</td>
            <td>‚Çπ${row.outflow.toLocaleString('en-IN')}</td>
            <td>‚Çπ${netCash(row).toLocaleString('en-IN')}</td>
            <td><span class="badge ${row.status === 'Surplus' ? 'badge-success' : row.status === 'Balanced' ? 'badge-info' : 'badge-danger'}">${row.status}</span></td>
            <td>
              <button class="btn btn-secondary btn-icon" style="padding: 6px;" data-row-action="edit" data-row-index="${index}">üìù</button>
              <button class="btn btn-secondary btn-icon" style="padding: 6px;" data-row-action="delete" data-row-index="${index}">üóëÔ∏è</button>
            </td>
          </tr>
        `).join('') || '<tr><td colspan="7" style="text-align:center; padding: 16px;">No cash forecasts found.</td></tr>';

        if (cashSummaryBody) {
          cashSummaryBody.innerHTML = cashForecasts.map((row) => `
            <tr>
              <td>${row.project}</td>
              <td>${row.owner}</td>
              <td><span class="badge ${row.status === 'Surplus' ? 'badge-success' : row.status === 'Balanced' ? 'badge-info' : 'badge-danger'}">${row.status}</span></td>
            </tr>
          `).join('') || '<tr><td colspan="3" style="text-align:center; padding: 16px;">No summary available.</td></tr>';
        }

        updateSummary();
      };

      const resetEacForm = () => {
        eacForm.reset();
        eacEditIndex.value = '';
        eacCancel.style.display = 'none';
      };

      const resetCashForm = () => {
        cashForm.reset();
        cashEditIndex.value = '';
        cashCancel.style.display = 'none';
      };

      eacForm.addEventListener('submit', (event) => {
        event.preventDefault();
        const row = {
          project: document.getElementById('eac-project').value.trim(),
          budget: parseFloat(document.getElementById('eac-budget').value || '0'),
          actual: parseFloat(document.getElementById('eac-actual').value || '0'),
          etc: parseFloat(document.getElementById('eac-etc').value || '0'),
          period: document.getElementById('eac-period').value.trim(),
          status: document.getElementById('eac-status').value
        };

        if (eacEditIndex.value !== '') {
          eacForecasts[parseInt(eacEditIndex.value, 10)] = row;
        } else {
          eacForecasts.unshift(row);
        }

        renderEac();
        resetEacForm();
      });

      eacCancel.addEventListener('click', resetEacForm);
      eacAddNew.addEventListener('click', resetEacForm);

      eacBody.addEventListener('click', (event) => {
        const actionButton = event.target.closest('button[data-row-action]');
        if (!actionButton) return;
        const index = parseInt(actionButton.dataset.rowIndex, 10);
        const action = actionButton.dataset.rowAction;
        const row = eacForecasts[index];
        if (!row) return;

        if (action === 'edit') {
          eacEditIndex.value = index.toString();
          document.getElementById('eac-project').value = row.project;
          document.getElementById('eac-budget').value = row.budget;
          document.getElementById('eac-actual').value = row.actual;
          document.getElementById('eac-etc').value = row.etc;
          document.getElementById('eac-period').value = row.period;
          document.getElementById('eac-status').value = row.status;
          eacCancel.style.display = 'inline-flex';
        }

        if (action === 'delete') {
          if (!confirm('Delete this EAC record?')) return;
          eacForecasts.splice(index, 1);
          renderEac();
        }
      });

      cashForm.addEventListener('submit', (event) => {
        event.preventDefault();
        const row = {
          project: document.getElementById('cash-project').value.trim(),
          month: document.getElementById('cash-month').value.trim(),
          inflow: parseFloat(document.getElementById('cash-inflow').value || '0'),
          outflow: parseFloat(document.getElementById('cash-outflow').value || '0'),
          owner: document.getElementById('cash-owner').value.trim(),
          status: document.getElementById('cash-status').value
        };

        if (cashEditIndex.value !== '') {
          cashForecasts[parseInt(cashEditIndex.value, 10)] = row;
        } else {
          cashForecasts.unshift(row);
        }

        renderCash();
        resetCashForm();
      });

      cashCancel.addEventListener('click', resetCashForm);
      cashAddNew.addEventListener('click', resetCashForm);

      cashBody.addEventListener('click', (event) => {
        const actionButton = event.target.closest('button[data-row-action]');
        if (!actionButton) return;
        const index = parseInt(actionButton.dataset.rowIndex, 10);
        const action = actionButton.dataset.rowAction;
        const row = cashForecasts[index];
        if (!row) return;

        if (action === 'edit') {
          cashEditIndex.value = index.toString();
          document.getElementById('cash-project').value = row.project;
          document.getElementById('cash-month').value = row.month;
          document.getElementById('cash-inflow').value = row.inflow;
          document.getElementById('cash-outflow').value = row.outflow;
          document.getElementById('cash-owner').value = row.owner;
          document.getElementById('cash-status').value = row.status;
          cashCancel.style.display = 'inline-flex';
        }

        if (action === 'delete') {
          if (!confirm('Delete this cash forecast?')) return;
          cashForecasts.splice(index, 1);
          renderCash();
        }
      });

      eacExport.addEventListener('click', () => {
        const header = ['Project', 'Budget', 'Actual', 'ETC', 'EAC', 'Variance', 'Period', 'Status'];
        const rows = eacForecasts.map((row) => [row.project, row.budget, row.actual, row.etc, eacValue(row), varianceValue(row), row.period, row.status]);
        const csvContent = [header, ...rows].map(row => row.map(value => `"${value}"`).join(',')).join('\n');
        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = 'eac-forecasts.csv';
        link.click();
        URL.revokeObjectURL(url);
      });

      cashExport.addEventListener('click', () => {
        const header = ['Project', 'Month', 'Inflow', 'Outflow', 'Net', 'Owner', 'Status'];
        const rows = cashForecasts.map((row) => [row.project, row.month, row.inflow, row.outflow, netCash(row), row.owner, row.status]);
        const csvContent = [header, ...rows].map(row => row.map(value => `"${value}"`).join(',')).join('\n');
        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = 'cash-forecasts.csv';
        link.click();
        URL.revokeObjectURL(url);
      });

      renderEac();
      renderCash();
    };

    const initCashFlowPlanning = () => {
      const tbody = document.getElementById('cflow-table-body');
      const summaryBody = document.getElementById('cflow-summary-body');
      const form = document.getElementById('cflow-form');
      const editIndex = document.getElementById('cflow-edit-index');
      const cancel = document.getElementById('cflow-cancel');
      const addNew = document.getElementById('cflow-add-new');
      const exportBtn = document.getElementById('cflow-export');

      if (!tbody || !form) {
        return;
      }

      const surplusEl = document.getElementById('cflow-surplus-count');
      const balancedEl = document.getElementById('cflow-balanced-count');
      const deficitEl = document.getElementById('cflow-deficit-count');
      const totalReceiptsEl = document.getElementById('cflow-total-receipts');
      const totalPaymentsEl = document.getElementById('cflow-total-payments');
      const totalNetEl = document.getElementById('cflow-total-net');

      const closingBalance = (row) => row.opening + row.receipts - row.payments;

      const updateSummary = () => {
        const surplusCount = cashFlowPlans.filter((row) => row.status === 'Surplus').length;
        const balancedCount = cashFlowPlans.filter((row) => row.status === 'Balanced').length;
        const deficitCount = cashFlowPlans.filter((row) => row.status === 'Deficit').length;

        if (surplusEl) surplusEl.textContent = surplusCount.toString();
        if (balancedEl) balancedEl.textContent = balancedCount.toString();
        if (deficitEl) deficitEl.textContent = deficitCount.toString();

        const totalReceipts = cashFlowPlans.reduce((sum, row) => sum + row.receipts, 0);
        const totalPayments = cashFlowPlans.reduce((sum, row) => sum + row.payments, 0);
        const totalNet = cashFlowPlans.reduce((sum, row) => sum + (row.receipts - row.payments), 0);

        if (totalReceiptsEl) totalReceiptsEl.textContent = `‚Çπ${totalReceipts.toLocaleString('en-IN')}`;
        if (totalPaymentsEl) totalPaymentsEl.textContent = `‚Çπ${totalPayments.toLocaleString('en-IN')}`;
        if (totalNetEl) totalNetEl.textContent = `‚Çπ${totalNet.toLocaleString('en-IN')}`;
      };

      const render = () => {
        tbody.innerHTML = cashFlowPlans.map((row, index) => `
          <tr>
            <td>${row.project}</td>
            <td>${row.month}</td>
            <td>‚Çπ${row.opening.toLocaleString('en-IN')}</td>
            <td>‚Çπ${row.receipts.toLocaleString('en-IN')}</td>
            <td>‚Çπ${row.payments.toLocaleString('en-IN')}</td>
            <td>‚Çπ${closingBalance(row).toLocaleString('en-IN')}</td>
            <td><span class="badge ${row.status === 'Surplus' ? 'badge-success' : row.status === 'Balanced' ? 'badge-info' : 'badge-danger'}">${row.status}</span></td>
            <td>
              <button class="btn btn-secondary btn-icon" style="padding: 6px;" data-row-action="edit" data-row-index="${index}">üìù</button>
              <button class="btn btn-secondary btn-icon" style="padding: 6px;" data-row-action="delete" data-row-index="${index}">üóëÔ∏è</button>
            </td>
          </tr>
        `).join('') || '<tr><td colspan="8" style="text-align:center; padding: 16px;">No cash flow plans found.</td></tr>';

        if (summaryBody) {
          summaryBody.innerHTML = cashFlowPlans.map((row) => `
            <tr>
              <td>${row.project}</td>
              <td>${row.owner}</td>
              <td><span class="badge ${row.status === 'Surplus' ? 'badge-success' : row.status === 'Balanced' ? 'badge-info' : 'badge-danger'}">${row.status}</span></td>
            </tr>
          `).join('') || '<tr><td colspan="3" style="text-align:center; padding: 16px;">No summary available.</td></tr>';
        }

        updateSummary();
      };

      const resetForm = () => {
        form.reset();
        editIndex.value = '';
        cancel.style.display = 'none';
      };

      form.addEventListener('submit', (event) => {
        event.preventDefault();
        const row = {
          project: document.getElementById('cflow-project').value.trim(),
          month: document.getElementById('cflow-month').value.trim(),
          opening: parseFloat(document.getElementById('cflow-opening').value || '0'),
          receipts: parseFloat(document.getElementById('cflow-receipts').value || '0'),
          payments: parseFloat(document.getElementById('cflow-payments').value || '0'),
          owner: document.getElementById('cflow-owner').value.trim(),
          status: document.getElementById('cflow-status').value
        };

        if (editIndex.value !== '') {
          cashFlowPlans[parseInt(editIndex.value, 10)] = row;
        } else {
          cashFlowPlans.unshift(row);
        }

        render();
        resetForm();
      });

      cancel.addEventListener('click', resetForm);
      addNew.addEventListener('click', resetForm);

      tbody.addEventListener('click', (event) => {
        const actionButton = event.target.closest('button[data-row-action]');
        if (!actionButton) return;
        const index = parseInt(actionButton.dataset.rowIndex, 10);
        const action = actionButton.dataset.rowAction;
        const row = cashFlowPlans[index];
        if (!row) return;

        if (action === 'edit') {
          editIndex.value = index.toString();
          document.getElementById('cflow-project').value = row.project;
          document.getElementById('cflow-month').value = row.month;
          document.getElementById('cflow-opening').value = row.opening;
          document.getElementById('cflow-receipts').value = row.receipts;
          document.getElementById('cflow-payments').value = row.payments;
          document.getElementById('cflow-owner').value = row.owner;
          document.getElementById('cflow-status').value = row.status;
          cancel.style.display = 'inline-flex';
        }

        if (action === 'delete') {
          if (!confirm('Delete this cash flow plan?')) return;
          cashFlowPlans.splice(index, 1);
          render();
        }
      });

      exportBtn.addEventListener('click', () => {
        const header = ['Project', 'Month', 'Opening', 'Receipts', 'Payments', 'Closing', 'Owner', 'Status'];
        const rows = cashFlowPlans.map((row) => [row.project, row.month, row.opening, row.receipts, row.payments, closingBalance(row), row.owner, row.status]);
        const csvContent = [header, ...rows].map(row => row.map(value => `"${value}"`).join(',')).join('\n');
        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = 'cash-flow-plans.csv';
        link.click();
        URL.revokeObjectURL(url);
      });

      render();
    };

    const initRetentionMobilization = () => {
      const retBody = document.getElementById('ret-table-body');
      const retForm = document.getElementById('ret-form');
      const retEditIndex = document.getElementById('ret-edit-index');
      const retCancel = document.getElementById('ret-cancel');
      const retAddNew = document.getElementById('ret-add-new');
      const retExport = document.getElementById('ret-export');

      const mobBody = document.getElementById('mob-table-body');
      const mobForm = document.getElementById('mob-form');
      const mobEditIndex = document.getElementById('mob-edit-index');
      const mobCancel = document.getElementById('mob-cancel');
      const mobAddNew = document.getElementById('mob-add-new');
      const mobExport = document.getElementById('mob-export');

      if (!retBody || !retForm || !mobBody || !mobForm) {
        return;
      }

      const retHeldEl = document.getElementById('ret-held-count');
      const retPendingEl = document.getElementById('ret-pending-count');
      const retReleasedEl = document.getElementById('ret-released-count');

      const mobActiveEl = document.getElementById('mob-active-count');
      const mobRecoveredEl = document.getElementById('mob-recovered-count');
      const mobOverdueEl = document.getElementById('mob-overdue-count');

      const outstandingAmount = (row) => Math.max(row.amount - row.recovered, 0);

      const updateSummary = () => {
        const heldCount = retentionLedger.filter((row) => row.status === 'Held').length;
        const pendingCount = retentionLedger.filter((row) => row.status === 'Pending').length;
        const releasedCount = retentionLedger.filter((row) => row.status === 'Released').length;

        if (retHeldEl) retHeldEl.textContent = heldCount.toString();
        if (retPendingEl) retPendingEl.textContent = pendingCount.toString();
        if (retReleasedEl) retReleasedEl.textContent = releasedCount.toString();

        const activeCount = mobilizationAdvances.filter((row) => row.status === 'Active').length;
        const recoveredCount = mobilizationAdvances.filter((row) => row.status === 'Recovered').length;
        const overdueCount = mobilizationAdvances.filter((row) => row.status === 'Overdue').length;

        if (mobActiveEl) mobActiveEl.textContent = activeCount.toString();
        if (mobRecoveredEl) mobRecoveredEl.textContent = recoveredCount.toString();
        if (mobOverdueEl) mobOverdueEl.textContent = overdueCount.toString();
      };

      const renderRetention = () => {
        retBody.innerHTML = retentionLedger.map((row, index) => `
          <tr>
            <td>${row.contract}</td>
            <td>${row.project}</td>
            <td>${row.ra}</td>
            <td>‚Çπ${row.amount.toLocaleString('en-IN')}</td>
            <td>${row.release}</td>
            <td><span class="badge ${row.status === 'Released' ? 'badge-success' : row.status === 'Pending' ? 'badge-warning' : 'badge-info'}">${row.status}</span></td>
            <td>
              <button class="btn btn-secondary btn-icon" style="padding: 6px;" data-row-action="edit" data-row-index="${index}">üìù</button>
              <button class="btn btn-secondary btn-icon" style="padding: 6px;" data-row-action="delete" data-row-index="${index}">üóëÔ∏è</button>
            </td>
          </tr>
        `).join('') || '<tr><td colspan="7" style="text-align:center; padding: 16px;">No retention entries found.</td></tr>';

        updateSummary();
      };

      const renderMobilization = () => {
        mobBody.innerHTML = mobilizationAdvances.map((row, index) => `
          <tr>
            <td>${row.advance}</td>
            <td>${row.project}</td>
            <td>${row.vendor}</td>
            <td>‚Çπ${row.amount.toLocaleString('en-IN')}</td>
            <td>‚Çπ${row.recovered.toLocaleString('en-IN')}</td>
            <td>‚Çπ${outstandingAmount(row).toLocaleString('en-IN')}</td>
            <td><span class="badge ${row.status === 'Recovered' ? 'badge-success' : row.status === 'Overdue' ? 'badge-danger' : 'badge-info'}">${row.status}</span></td>
            <td>
              <button class="btn btn-secondary btn-icon" style="padding: 6px;" data-row-action="edit" data-row-index="${index}">üìù</button>
              <button class="btn btn-secondary btn-icon" style="padding: 6px;" data-row-action="delete" data-row-index="${index}">üóëÔ∏è</button>
            </td>
          </tr>
        `).join('') || '<tr><td colspan="8" style="text-align:center; padding: 16px;">No mobilization advances found.</td></tr>';

        updateSummary();
      };

      const resetRetForm = () => {
        retForm.reset();
        retEditIndex.value = '';
        retCancel.style.display = 'none';
      };

      const resetMobForm = () => {
        mobForm.reset();
        mobEditIndex.value = '';
        mobCancel.style.display = 'none';
      };

      retForm.addEventListener('submit', (event) => {
        event.preventDefault();
        const row = {
          contract: document.getElementById('ret-contract').value.trim(),
          project: document.getElementById('ret-project').value.trim(),
          ra: document.getElementById('ret-ra').value.trim(),
          amount: parseFloat(document.getElementById('ret-amount').value || '0'),
          release: document.getElementById('ret-release').value.trim(),
          status: document.getElementById('ret-status').value
        };

        if (retEditIndex.value !== '') {
          retentionLedger[parseInt(retEditIndex.value, 10)] = row;
        } else {
          retentionLedger.unshift(row);
        }

        renderRetention();
        resetRetForm();
      });

      retCancel.addEventListener('click', resetRetForm);
      retAddNew.addEventListener('click', resetRetForm);

      retBody.addEventListener('click', (event) => {
        const actionButton = event.target.closest('button[data-row-action]');
        if (!actionButton) return;
        const index = parseInt(actionButton.dataset.rowIndex, 10);
        const action = actionButton.dataset.rowAction;
        const row = retentionLedger[index];
        if (!row) return;

        if (action === 'edit') {
          retEditIndex.value = index.toString();
          document.getElementById('ret-contract').value = row.contract;
          document.getElementById('ret-project').value = row.project;
          document.getElementById('ret-ra').value = row.ra;
          document.getElementById('ret-amount').value = row.amount;
          document.getElementById('ret-release').value = row.release;
          document.getElementById('ret-status').value = row.status;
          retCancel.style.display = 'inline-flex';
        }

        if (action === 'delete') {
          if (!confirm('Delete this retention entry?')) return;
          retentionLedger.splice(index, 1);
          renderRetention();
        }
      });

      mobForm.addEventListener('submit', (event) => {
        event.preventDefault();
        const row = {
          advance: document.getElementById('mob-advance').value.trim(),
          project: document.getElementById('mob-project').value.trim(),
          vendor: document.getElementById('mob-vendor').value.trim(),
          amount: parseFloat(document.getElementById('mob-amount').value || '0'),
          recovered: parseFloat(document.getElementById('mob-recovered').value || '0'),
          method: document.getElementById('mob-method').value,
          status: document.getElementById('mob-status').value
        };

        if (mobEditIndex.value !== '') {
          mobilizationAdvances[parseInt(mobEditIndex.value, 10)] = row;
        } else {
          mobilizationAdvances.unshift(row);
        }

        renderMobilization();
        resetMobForm();
      });

      mobCancel.addEventListener('click', resetMobForm);
      mobAddNew.addEventListener('click', resetMobForm);

      mobBody.addEventListener('click', (event) => {
        const actionButton = event.target.closest('button[data-row-action]');
        if (!actionButton) return;
        const index = parseInt(actionButton.dataset.rowIndex, 10);
        const action = actionButton.dataset.rowAction;
        const row = mobilizationAdvances[index];
        if (!row) return;

        if (action === 'edit') {
          mobEditIndex.value = index.toString();
          document.getElementById('mob-advance').value = row.advance;
          document.getElementById('mob-project').value = row.project;
          document.getElementById('mob-vendor').value = row.vendor;
          document.getElementById('mob-amount').value = row.amount;
          document.getElementById('mob-recovered').value = row.recovered;
          document.getElementById('mob-method').value = row.method;
          document.getElementById('mob-status').value = row.status;
          mobCancel.style.display = 'inline-flex';
        }

        if (action === 'delete') {
          if (!confirm('Delete this mobilization advance?')) return;
          mobilizationAdvances.splice(index, 1);
          renderMobilization();
        }
      });

      retExport.addEventListener('click', () => {
        const header = ['Contract', 'Project', 'RA Bill', 'Retention Amount', 'Release Date', 'Status'];
        const rows = retentionLedger.map((row) => [row.contract, row.project, row.ra, row.amount, row.release, row.status]);
        const csvContent = [header, ...rows].map(row => row.map(value => `"${value}"`).join(',')).join('\n');
        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = 'retention-ledger.csv';
        link.click();
        URL.revokeObjectURL(url);
      });

      mobExport.addEventListener('click', () => {
        const header = ['Advance', 'Project', 'Vendor', 'Amount', 'Recovered', 'Outstanding', 'Method', 'Status'];
        const rows = mobilizationAdvances.map((row) => [row.advance, row.project, row.vendor, row.amount, row.recovered, outstandingAmount(row), row.method, row.status]);
        const csvContent = [header, ...rows].map(row => row.map(value => `"${value}"`).join(',')).join('\n');
        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = 'mobilization-advances.csv';
        link.click();
        URL.revokeObjectURL(url);
      });

      renderRetention();
      renderMobilization();
    };

    const initCertificationsApprovals = () => {
      const tbody = document.getElementById('cert-table-body');
      const summaryBody = document.getElementById('cert-summary-body');
      const form = document.getElementById('cert-form');
      const editIndex = document.getElementById('cert-edit-index');
      const cancel = document.getElementById('cert-cancel');
      const addNew = document.getElementById('cert-add-new');
      const exportBtn = document.getElementById('cert-export');

      if (!tbody || !form) {
        return;
      }

      const pendingEl = document.getElementById('cert-pending-count');
      const approvedEl = document.getElementById('cert-approved-count');
      const rejectedEl = document.getElementById('cert-rejected-count');
      const engineerEl = document.getElementById('cert-engineer-count');
      const consultantEl = document.getElementById('cert-consultant-count');
      const clientEl = document.getElementById('cert-client-count');

      const updateSummary = () => {
        const pendingCount = certificationApprovals.filter((row) => row.status === 'Pending').length;
        const approvedCount = certificationApprovals.filter((row) => row.status === 'Approved').length;
        const rejectedCount = certificationApprovals.filter((row) => row.status === 'Rejected').length;

        if (pendingEl) pendingEl.textContent = pendingCount.toString();
        if (approvedEl) approvedEl.textContent = approvedCount.toString();
        if (rejectedEl) rejectedEl.textContent = rejectedCount.toString();

        const engineerCount = certificationApprovals.filter((row) => row.stage === 'Engineer').length;
        const consultantCount = certificationApprovals.filter((row) => row.stage === 'Consultant').length;
        const clientCount = certificationApprovals.filter((row) => row.stage === 'Client').length;

        if (engineerEl) engineerEl.textContent = engineerCount.toString();
        if (consultantEl) consultantEl.textContent = consultantCount.toString();
        if (clientEl) clientEl.textContent = clientCount.toString();
      };

      const render = () => {
        tbody.innerHTML = certificationApprovals.map((row, index) => `
          <tr>
            <td>${row.ref}</td>
            <td>${row.project}</td>
            <td>${row.type}</td>
            <td>${row.stage}</td>
            <td>${row.date}</td>
            <td><span class="badge ${row.status === 'Approved' ? 'badge-success' : row.status === 'Rejected' ? 'badge-danger' : 'badge-warning'}">${row.status}</span></td>
            <td>
              <button class="btn btn-secondary btn-icon" style="padding: 6px;" data-row-action="edit" data-row-index="${index}">üìù</button>
              <button class="btn btn-secondary btn-icon" style="padding: 6px;" data-row-action="delete" data-row-index="${index}">üóëÔ∏è</button>
            </td>
          </tr>
        `).join('') || '<tr><td colspan="7" style="text-align:center; padding: 16px;">No certifications found.</td></tr>';

        if (summaryBody) {
          summaryBody.innerHTML = certificationApprovals.map((row) => `
            <tr>
              <td>${row.ref}</td>
              <td>${row.stage}</td>
              <td><span class="badge ${row.status === 'Approved' ? 'badge-success' : row.status === 'Rejected' ? 'badge-danger' : 'badge-warning'}">${row.status}</span></td>
              <td>${row.owner}</td>
            </tr>
          `).join('') || '<tr><td colspan="4" style="text-align:center; padding: 16px;">No approval trails available.</td></tr>';
        }

        updateSummary();
      };

      const resetForm = () => {
        form.reset();
        editIndex.value = '';
        cancel.style.display = 'none';
      };

      form.addEventListener('submit', (event) => {
        event.preventDefault();
        const row = {
          ref: document.getElementById('cert-ref').value.trim(),
          project: document.getElementById('cert-project').value.trim(),
          type: document.getElementById('cert-type').value,
          stage: document.getElementById('cert-stage').value,
          owner: document.getElementById('cert-owner').value.trim(),
          date: document.getElementById('cert-date').value.trim(),
          status: document.getElementById('cert-status').value
        };

        if (editIndex.value !== '') {
          certificationApprovals[parseInt(editIndex.value, 10)] = row;
        } else {
          certificationApprovals.unshift(row);
        }

        render();
        resetForm();
      });

      cancel.addEventListener('click', resetForm);
      addNew.addEventListener('click', resetForm);

      tbody.addEventListener('click', (event) => {
        const actionButton = event.target.closest('button[data-row-action]');
        if (!actionButton) return;
        const index = parseInt(actionButton.dataset.rowIndex, 10);
        const action = actionButton.dataset.rowAction;
        const row = certificationApprovals[index];
        if (!row) return;

        if (action === 'edit') {
          editIndex.value = index.toString();
          document.getElementById('cert-ref').value = row.ref;
          document.getElementById('cert-project').value = row.project;
          document.getElementById('cert-type').value = row.type;
          document.getElementById('cert-stage').value = row.stage;
          document.getElementById('cert-owner').value = row.owner;
          document.getElementById('cert-date').value = row.date;
          document.getElementById('cert-status').value = row.status;
          cancel.style.display = 'inline-flex';
        }

        if (action === 'delete') {
          if (!confirm('Delete this certification?')) return;
          certificationApprovals.splice(index, 1);
          render();
        }
      });

      exportBtn.addEventListener('click', () => {
        const header = ['Reference', 'Project', 'Type', 'Stage', 'Owner', 'Date', 'Status'];
        const rows = certificationApprovals.map((row) => [row.ref, row.project, row.type, row.stage, row.owner, row.date, row.status]);
        const csvContent = [header, ...rows].map(row => row.map(value => `"${value}"`).join(',')).join('\n');
        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = 'certifications-approvals.csv';
        link.click();
        URL.revokeObjectURL(url);
      });

      render();
    };

    // Project Progress Chart
    const projectProgressCtx = document.getElementById('projectProgressChart').getContext('2d');
    new Chart(projectProgressCtx, {
      type: 'bar',
      data: {
        labels: ['Apollo Towers', 'Metro Plaza', 'Green Valley', 'Smart City', 'Sky Heights'],
        datasets: [{
          label: 'Progress (%)',
          data: [75, 45, 15, 58, 92],
          backgroundColor: [
            'rgba(16, 185, 129, 0.8)',
            'rgba(245, 158, 11, 0.8)',
            'rgba(239, 68, 68, 0.8)',
            'rgba(245, 158, 11, 0.8)',
            'rgba(16, 185, 129, 0.8)'
          ],
          borderWidth: 0
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            display: false
          }
        },
        scales: {
          y: {
            beginAtZero: true,
            max: 100
          }
        }
      }
    });

    // Resource Utilization Chart
    const resourceUtilizationCtx = document.getElementById('resourceUtilizationChart').getContext('2d');
    new Chart(resourceUtilizationCtx, {
      type: 'doughnut',
      data: {
        labels: ['Labour', 'Equipment', 'Materials', 'Subcontractors'],
        datasets: [{
          data: [35, 25, 30, 10],
          backgroundColor: [
            'rgba(37, 99, 235, 0.8)',
            'rgba(16, 185, 129, 0.8)',
            'rgba(245, 158, 11, 0.8)',
            'rgba(139, 92, 246, 0.8)'
          ],
          borderWidth: 2,
          borderColor: '#ffffff'
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            position: 'bottom',
            labels: {
              padding: 15,
              font: {
                size: 12
              }
            }
          }
        }
      }
    });

    window.addEventListener('DOMContentLoaded', () => {
      initWBSWorkPackages();
      initSchedulingGantt();
      initCostEstimationBoq();
      initProgressBilling();
      initChangeOrders();
      initContractManagement();
      initTimeAttendance();
      initSubcontractorBilling();
      initProjectForecasting();
      initCashFlowPlanning();
      initRetentionMobilization();
      initCertificationsApprovals();
    });
  </script>
</body>
</html>